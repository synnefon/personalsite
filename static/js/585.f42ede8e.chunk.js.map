{"version":3,"file":"static/js/585.f42ede8e.chunk.js","mappings":"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","sources":["assets/lavaLamp/power.svg","util/audioAmplitude.ts","lava_lamp/utils/deviceDetection.ts","lava_lamp/utils/constants.ts","lava_lamp/utils/colorUtils.ts","lava_lamp/utils/spatialGrid.ts","lava_lamp/utils/physics.ts","lava_lamp/utils/rendering.ts","lava_lamp/utils/speedUtils.ts","lava_lamp/LavaLamp.tsx","lava_lamp/utils/storage.ts","util/Audio.js"],"sourcesContent":["var _g;\nconst _excluded = [\"title\", \"titleId\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport * as React from \"react\";\nfunction SvgPower(_ref, svgRef) {\n  let {\n      title,\n      titleId\n    } = _ref,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    id: \"Capa_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512.292 512.292\",\n    style: {\n      enableBackground: \"new 0 0 512.292 512.292\"\n    },\n    xmlSpace: \"preserve\",\n    width: 512,\n    height: 512,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M256.061,0L256.061,0c17.673,0,32,14.327,32,32v106.667c0,17.673-14.327,32-32,32l0,0c-17.673,0-32-14.327-32-32V32   C224.061,14.327,238.387,0,256.061,0z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M330.727,105.387L330.727,105.387c-0.157,10.742,5.259,20.8,14.315,26.581c80.432,49.143,105.796,154.185,56.652,234.616   S247.51,472.38,167.078,423.237S61.282,269.052,110.426,188.62c14.042-22.982,33.324-42.315,56.269-56.418   c9.211-5.781,14.773-15.92,14.699-26.795l0,0c0.049-17.673-14.238-32.039-31.911-32.088c-6.07-0.017-12.02,1.693-17.155,4.931   C22.233,146.634-11.58,291.318,56.803,401.412s213.067,143.907,323.161,75.524s143.907-213.067,75.524-323.161   c-19.035-30.645-44.879-56.489-75.524-75.524c-14.997-9.461-34.824-4.973-44.285,10.024   C332.447,93.397,330.731,99.33,330.727,105.387z\"\n  }))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgPower);\nexport default __webpack_public_path__ + \"static/media/power.632cc1e66922cf3fa35d93370ea84178.svg\";\nexport { ForwardRef as ReactComponent };","/**\n * Audio amplitude analysis for visualizing music playback.\n * Uses Web Audio API's AnalyserNode to extract real-time amplitude data.\n */\n\nexport class AudioAmplitudeAnalyzer {\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private dataArray: Uint8Array | null = null;\n  private connected = false;\n\n  /**\n   * Initialize and connect the analyser to an audio element.\n   * Must be called after user interaction to avoid autoplay restrictions.\n   */\n  connect(audioElement: HTMLAudioElement): boolean {\n    if (this.connected) return true;\n\n    try {\n      this.audioContext = new AudioContext();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256; // Small size for performance\n      this.analyser.smoothingTimeConstant = 0.95; // Higher = smoother (0-1 range)\n\n      const source = this.audioContext.createMediaElementSource(audioElement);\n      source.connect(this.analyser).connect(this.audioContext.destination);\n\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n      this.connected = true;\n\n      return true;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Failed to connect analyser:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Get current amplitude as a value between 0 and 1.\n   * Uses RMS (root mean square) for smooth, accurate amplitude measurement.\n   */\n  getAmplitude(): number {\n    if (!this.analyser || !this.dataArray) return 0;\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      // Calculate RMS amplitude\n      let sum = 0;\n      for (let i = 0; i < this.dataArray.length; i++) {\n        const normalized = (this.dataArray[i] - 128) / 128;\n        sum += normalized * normalized;\n      }\n\n      const rms = Math.sqrt(sum / this.dataArray.length);\n\n      // Boost the signal for better visualization (typical music is quiet)\n      return Math.min(1, rms * 3);\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading amplitude:', err);\n      return 0;\n    }\n  }\n\n  /**\n   * Get waveform values for multiple bars (e.g., 4 bars for visualization).\n   * Samples different points in the waveform and returns normalized values [0-1].\n   */\n  getWaveformBars(barCount: number): number[] {\n    if (!this.analyser || !this.dataArray) {\n      return new Array(barCount).fill(0);\n    }\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      const bars: number[] = [];\n      const step = Math.floor(this.dataArray.length / barCount);\n\n      for (let i = 0; i < barCount; i++) {\n        const index = i * step;\n        // Convert byte value (0-255, centered at 128) to 0-1 range\n        const normalized = Math.abs((this.dataArray[index] - 128) / 128);\n        // Very gentle boost for smooth, calm visualization\n        bars.push(Math.min(1, normalized * 1.2));\n      }\n\n      return bars;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading waveform:', err);\n      return new Array(barCount).fill(0);\n    }\n  }\n\n  /**\n   * Resume audio context if suspended (required on some browsers after page load).\n   */\n  resume(): void {\n    if (this.audioContext && this.audioContext.state === 'suspended') {\n      this.audioContext.resume().catch((err) => {\n        console.warn('[AudioAmplitude] Failed to resume audio context:', err);\n      });\n    }\n  }\n\n  /**\n   * Clean up resources.\n   */\n  disconnect(): void {\n    if (this.audioContext) {\n      this.audioContext.close().catch(() => {\n        // ignore\n      });\n      this.audioContext = null;\n    }\n    this.analyser = null;\n    this.dataArray = null;\n    this.connected = false;\n  }\n\n  isConnected(): boolean {\n    return this.connected;\n  }\n}\n","/**\n * Device detection utilities\n */\n\nexport const detectMobile = (): boolean => {\n  const userAgent =\n    navigator.userAgent ||\n    navigator.vendor ||\n    (window as Window & { opera?: string }).opera ||\n    \"\";\n\n  // Check for mobile user agents\n  const mobileRegex =\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  const isMobileUA = mobileRegex.test(userAgent);\n\n  // Check for touch capability\n  const hasTouch = \"ontouchstart\" in window || navigator.maxTouchPoints > 0;\n\n  // Check screen size (fallback)\n  const isSmallScreen = window.innerWidth <= 500;\n\n  // Consider it mobile if it has mobile UA OR (has touch AND small screen)\n  return isMobileUA || (hasTouch && isSmallScreen);\n};\n","/**\n * Configuration constants for the Lava Lamp simulation\n */\n\nimport { detectMobile } from \"./deviceDetection.ts\";\n\nconst isMobile = detectMobile();\n\n// Audio source configuration\nexport const AUDIO_SOURCES = {\n  REDWOOD: \"redwood\",\n  KEXP: \"kexp\",\n} as const;\n\n// Default color configuration\nexport const DEFAULT_HIGH = \"#ffdd00\";\nexport const DEFAULT_LOW = \"#ff5500\";\n\n// Physics simulation constants\nexport const SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\n// Rendering constants\nexport const RENDER = {\n  PARTICLE_RADIUS: 10,\n  PIXEL_SIZE: 6,\n  THRESHOLD: 0.8,\n} as const;\n\n// Particle clustering configuration\nexport const CLUMPS = {\n  COUNT: 15,\n  RADIUS: isMobile ? 30 : 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n/**\n * The density of the lava lamp simulation (particles per pixel).\n * Higher values produce a greater number of particles (higher density).\n * Increase this number to make the lava lamp more dense.\n */\nexport const PARTICLES_PER_PIXEL = isMobile ? 0.00054 : 0.00061;\n\n// Speed control configuration\nexport const SPEED = {\n  MIN: 0.0,\n  MAX: 5,\n  DEFAULT: 0.25,\n  STEPS: 10, // number of discrete positions\n} as const;\n\n// Fixed update rate (independent of render cost / screen size)\nexport const FIXED_FPS = 60;\nexport const FIXED_MS = 1000 / FIXED_FPS;\nexport const MAX_CATCHUP_STEPS = 5;\n\n// LocalStorage keys\nexport const MUSIC_TIME_KEY = \"lava-lamp-music-time\";\n","/**\n * Color manipulation and conversion utilities\n */\n\nexport function hexToRgb(hex: string): { r: number; g: number; b: number } {\n  const h = hex.trim().replace(\"#\", \"\");\n  if (h.length === 3) {\n    const r = parseInt(h[0] + h[0], 16);\n    const g = parseInt(h[1] + h[1], 16);\n    const b = parseInt(h[2] + h[2], 16);\n    return { r, g, b };\n  }\n  if (h.length === 6) {\n    const r = parseInt(h.slice(0, 2), 16);\n    const g = parseInt(h.slice(2, 4), 16);\n    const b = parseInt(h.slice(4, 6), 16);\n    return { r, g, b };\n  }\n  return { r: 255, g: 221, b: 0 };\n}\n\nexport function hslToHex(h: number, s: number, l: number): string {\n  const a = s * Math.min(l, 1 - l);\n  const f = (n: number) => {\n    const k = (n + h / 30) % 12;\n    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n    return Math.round(255 * color)\n      .toString(16)\n      .padStart(2, \"0\");\n  };\n  return `#${f(0)}${f(8)}${f(4)}`;\n}\n\nexport function hexToHue(hex: string): number {\n  const rgb = hexToRgb(hex);\n  const r = rgb.r / 255;\n  const g = rgb.g / 255;\n  const b = rgb.b / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const delta = max - min;\n\n  if (delta === 0) return 0;\n\n  let hue = 0;\n  if (max === r) {\n    hue = ((g - b) / delta) % 6;\n  } else if (max === g) {\n    hue = (b - r) / delta + 2;\n  } else {\n    hue = (r - g) / delta + 4;\n  }\n\n  hue = Math.round(hue * 60);\n  if (hue < 0) hue += 360;\n\n  return hue;\n}\n\nexport function lerpInt(a: number, b: number, t: number): number {\n  const v = a + (b - a) * t;\n  return v < 0 ? 0 : v > 255 ? 255 : Math.round(v);\n}\n\nexport function packRgba(r: number, g: number, b: number, a: number): number {\n  return (a << 24) | (b << 16) | (g << 8) | r;\n}\n\nexport function buildHeatLut256(lowHex: string, highHex: string): Uint32Array {\n  const lo = hexToRgb(lowHex);\n  const hi = hexToRgb(highHex);\n\n  const lut = new Uint32Array(256);\n  for (let i = 0; i < 256; i++) {\n    const t = i / 255;\n    const r = lerpInt(lo.r, hi.r, t);\n    const g = lerpInt(lo.g, hi.g, t);\n    const b = lerpInt(lo.b, hi.b, t);\n    lut[i] = packRgba(r, g, b, 255);\n  }\n  return lut;\n}\n","/**\n * Spatial grid utilities for efficient neighbor queries\n */\n\nimport type { SpatialGrid } from \"./types.ts\";\nimport type React from \"react\";\n\nexport function ensureGrid(\n  gridRef: React.MutableRefObject<SpatialGrid | null>,\n  width: number,\n  height: number,\n  count: number,\n  cellSize: number\n): void {\n  const cols = Math.max(1, Math.ceil(width / cellSize));\n  const rows = Math.max(1, Math.ceil(height / cellSize));\n  const cells = cols * rows;\n\n  const g = gridRef.current;\n  if (\n    !g ||\n    g.cols !== cols ||\n    g.rows !== rows ||\n    g.cellSize !== cellSize ||\n    g.next.length !== count ||\n    g.heads.length !== cells\n  ) {\n    gridRef.current = {\n      cellSize,\n      cols,\n      rows,\n      heads: new Int32Array(cells),\n      next: new Int32Array(count),\n    };\n  }\n}\n\nexport function gridIndex(g: SpatialGrid, cx: number, cy: number): number {\n  return cy * g.cols + cx;\n}\n","/**\n * Physics simulation and particle behavior\n */\n\nimport type { Particle, Vec2, SpatialGrid } from \"./types.ts\";\nimport { SIM, CLUMPS, PARTICLES_PER_PIXEL } from \"./constants.ts\";\nimport { gridIndex } from \"./spatialGrid.ts\";\n\n// Math utilities\nexport function clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\nexport function randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\n// Particle bounds checking\nexport function bounceInBounds(\n  p: Particle,\n  width: number,\n  height: number\n): void {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nexport function clampAllToBounds(\n  particles: Particle[],\n  width: number,\n  height: number\n): void {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\n// Particle count calculation\nexport function computeParticleCount(width: number, height: number): number {\n  const area = width * height;\n  return Math.round(area * PARTICLES_PER_PIXEL);\n}\n\n// Particle creation\nexport function createParticles(\n  width: number,\n  height: number,\n  count: number\n): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// Physics forces\nexport function applyBuoyancyAndGravity(p: Particle, dt: number): void {\n  const buoyancy = p.heat * p.heat * SIM.BUOYANCY;\n  p.vy += (SIM.GRAVITY - buoyancy) * dt;\n}\n\nexport function applyFriction(p: Particle, dt: number): void {\n  const f = Math.pow(SIM.FRICTION, dt);\n  p.vx *= f;\n  p.vy *= f;\n}\n\nexport function integrate(p: Particle, dt: number): void {\n  p.x += p.vx * dt;\n  p.y += p.vy * dt;\n}\n\nexport function applyPointerHeat(\n  p: Particle,\n  pointerPos: Vec2,\n  dt: number\n): void {\n  const dx = p.x - pointerPos.x;\n  const dy = p.y - pointerPos.y;\n  const d2 = dx * dx + dy * dy;\n  const r = SIM.MOUSE_HEAT_RADIUS;\n  const r2 = r * r;\n\n  if (d2 < r2) {\n    const d = Math.sqrt(d2);\n    const intensity = 1 - d * (1 / r);\n    p.heat += SIM.HEAT_RATE * 2 * intensity * dt;\n  }\n}\n\nexport function applyCohesionImpulse(\n  p1: Particle,\n  p2: Particle,\n  dx: number,\n  dy: number,\n  d: number,\n  dt: number\n): void {\n  const force = SIM.COHESION_STRENGTH * (1 - d * (1 / SIM.COHESION_RADIUS));\n  const invD = 1 / d;\n  const fx = dx * invD * force * dt;\n  const fy = dy * invD * force * dt;\n\n  p1.vx += fx;\n  p1.vy += fy;\n  p2.vx -= fx;\n  p2.vy -= fy;\n}\n\nexport function applyHeatConduction(\n  p1: Particle,\n  p2: Particle,\n  dt: number\n): void {\n  const heatDiff = p1.heat - p2.heat;\n  const conduction = heatDiff * SIM.HEAT_CONDUCTION * dt;\n  p1.heat -= conduction;\n  p2.heat += conduction;\n}\n\nexport function applyBottomHeatOrAirCooling(\n  p: Particle,\n  height: number,\n  neighborCount: number,\n  dt: number\n): void {\n  const distanceFromBottom = height - p.y;\n\n  if (distanceFromBottom < SIM.HEAT_SOURCE_DISTANCE) {\n    const intensity = 1 - distanceFromBottom * (1 / SIM.HEAT_SOURCE_DISTANCE);\n    p.heat += SIM.HEAT_RATE * intensity * dt;\n    return;\n  }\n\n  const maxNeighbors = 8;\n  const neighbors = neighborCount < maxNeighbors ? neighborCount : maxNeighbors;\n  const airExposure = 1 - neighbors / maxNeighbors;\n\n  p.heat -= SIM.COOL_RATE * (0.2 + airExposure * 0.8) * dt;\n}\n\n// Main simulation step\nexport function stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array,\n  timeScale: number,\n  grid: SpatialGrid\n): void {\n  const dt = Math.max(0, Math.min(4.0, timeScale));\n\n  // Pass 1: integrate + pointer heat + reset neighbors + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    applyBuoyancyAndGravity(p, dt);\n    applyFriction(p, dt);\n    integrate(p, dt);\n\n    if (pointerDown) applyPointerHeat(p, pointerPos, dt);\n\n    neighborCounts[i] = 0;\n    bounceInBounds(p, width, height);\n  }\n\n  // dt=0 => frozen (no cohesion/conduction/cooling), but still clamp\n  if (dt === 0) {\n    for (let i = 0; i < particles.length; i++) {\n      particles[i].heat = clamp01(particles[i].heat);\n    }\n    clampAllToBounds(particles, width, height);\n    return;\n  }\n\n  // Build spatial hash\n  grid.heads.fill(-1);\n  const invCell = 1 / grid.cellSize;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    let cx = (p.x * invCell) | 0;\n    let cy = (p.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const cell = gridIndex(grid, cx, cy);\n    grid.next[i] = grid.heads[cell];\n    grid.heads[cell] = i;\n  }\n\n  // Pass 2: local neighbor forces + conduction\n  const r = SIM.COHESION_RADIUS;\n  const r2 = r * r;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p1 = particles[i];\n\n    let cx = (p1.x * invCell) | 0;\n    let cy = (p1.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const x0 = cx > 0 ? cx - 1 : cx;\n    const x1 = cx + 1 < grid.cols ? cx + 1 : cx;\n    const y0 = cy > 0 ? cy - 1 : cy;\n    const y1 = cy + 1 < grid.rows ? cy + 1 : cy;\n\n    for (let ny = y0; ny <= y1; ny++) {\n      for (let nx = x0; nx <= x1; nx++) {\n        let j = grid.heads[gridIndex(grid, nx, ny)];\n        while (j !== -1) {\n          if (j > i) {\n            const p2 = particles[j];\n            const dx = p2.x - p1.x;\n            const dy = p2.y - p1.y;\n            const d2 = dx * dx + dy * dy;\n\n            if (d2 > 0 && d2 < r2) {\n              neighborCounts[i]++;\n              neighborCounts[j]++;\n\n              const d = Math.sqrt(d2);\n              applyCohesionImpulse(p1, p2, dx, dy, d, dt);\n              applyHeatConduction(p1, p2, dt);\n            }\n          }\n          j = grid.next[j];\n        }\n      }\n    }\n  }\n\n  // Pass 3: bottom heat / air cooling + clamp heat + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n    applyBottomHeatOrAirCooling(p, height, neighborCounts[i], dt);\n    p.heat = clamp01(p.heat);\n  }\n\n  clampAllToBounds(particles, width, height);\n}\n","/**\n * Canvas rendering utilities for metaball effect\n */\n\nimport type React from \"react\";\nimport type { Particle, SpatialGrid } from \"./types.ts\";\nimport { RENDER } from \"./constants.ts\";\nimport { packRgba } from \"./colorUtils.ts\";\nimport { gridIndex } from \"./spatialGrid.ts\";\n\nexport function ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\n/**\n * Optimized metaball rendering using spatial grid\n * Only checks particles near each pixel instead of all particles\n */\nexport function drawMetaballsWithGrid(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number,\n  heatLut256: Uint32Array,\n  grid: SpatialGrid\n): void {\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  // Max distance a particle can influence (3x radius for practical cutoff)\n  const maxInfluenceDist = RENDER.PARTICLE_RADIUS * 3;\n  const maxDistSq = maxInfluenceDist * maxInfluenceDist;\n\n  const data32 = new Uint32Array(imageData.data.buffer);\n\n  // Clear canvas to opaque black\n  const black = packRgba(0, 0, 0, 255);\n  data32.fill(black);\n\n  const w = canvasWidth;\n  const invCell = 1 / grid.cellSize;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      // Calculate which grid cells to check\n      const cx = Math.floor(x * invCell);\n      const cy = Math.floor(y * invCell);\n\n      // Check 3x3 grid around pixel\n      const x0 = Math.max(0, cx - 1);\n      const x1 = Math.min(grid.cols - 1, cx + 1);\n      const y0 = Math.max(0, cy - 1);\n      const y1 = Math.min(grid.rows - 1, cy + 1);\n\n      // Only iterate through particles in nearby cells\n      for (let gy = y0; gy <= y1; gy++) {\n        for (let gx = x0; gx <= x1; gx++) {\n          let particleIdx = grid.heads[gridIndex(grid, gx, gy)];\n\n          while (particleIdx !== -1) {\n            const p = particles[particleIdx];\n            const dx = x - p.x;\n            const dy = y - p.y;\n            const distSq = dx * dx + dy * dy;\n\n            // Skip if particle is too far to have meaningful influence\n            if (distSq < maxDistSq) {\n              const influence = r2 / (distSq + 1);\n              influenceSum += influence;\n              heatWeightedSum += influence * p.heat;\n            }\n\n            particleIdx = grid.next[particleIdx];\n          }\n        }\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const lutIdx = heat <= 0 ? 0 : heat >= 1 ? 255 : (heat * 255) | 0;\n      const rgba = heatLut256[lutIdx];\n\n      // Fill pixel block\n      for (let py = 0; py < pixelSize; py++) {\n        const yy = y + py;\n        if (yy >= canvasHeight) break;\n\n        let idx = yy * w + x;\n        const rowEnd = Math.min(x + pixelSize, w);\n        for (let xx = x; xx < rowEnd; xx++) {\n          data32[idx++] = rgba;\n        }\n      }\n    }\n  }\n}\n\n/**\n * Legacy metaball rendering (checks all particles for every pixel)\n * Kept for compatibility/fallback\n */\nexport function drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number,\n  heatLut256: Uint32Array\n): void {\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  const data32 = new Uint32Array(imageData.data.buffer);\n\n  // Clear canvas to opaque black\n  const black = packRgba(0, 0, 0, 255);\n  data32.fill(black);\n\n  const w = canvasWidth;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      for (let i = 0; i < particles.length; i++) {\n        const p = particles[i];\n        const dx = x - p.x;\n        const dy = y - p.y;\n        const distSq = dx * dx + dy * dy;\n        const influence = r2 / (distSq + 1);\n\n        influenceSum += influence;\n        heatWeightedSum += influence * p.heat;\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const lutIdx = heat <= 0 ? 0 : heat >= 1 ? 255 : (heat * 255) | 0;\n      const rgba = heatLut256[lutIdx];\n\n      for (let py = 0; py < pixelSize; py++) {\n        const yy = y + py;\n        if (yy >= canvasHeight) break;\n\n        let idx = yy * w + x;\n        const rowEnd = Math.min(x + pixelSize, w);\n        for (let xx = x; xx < rowEnd; xx++) {\n          data32[idx++] = rgba;\n        }\n      }\n    }\n  }\n}\n\nexport function renderFrame(\n  ctx: CanvasRenderingContext2D,\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>,\n  heatLut256: Uint32Array,\n  grid?: SpatialGrid\n): void {\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n\n  if (grid) {\n    drawMetaballsWithGrid(imageData, particles, canvas.width, canvas.height, heatLut256, grid);\n  } else {\n    drawMetaballs(imageData, particles, canvas.width, canvas.height, heatLut256);\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n}\n","/**\n * Speed control utilities for the simulation\n */\n\nimport { SPEED } from \"./constants.ts\";\nimport { lerp } from \"./physics.ts\";\n\nexport function clampInt(v: number, lo: number, hi: number): number {\n  return v < lo ? lo : v > hi ? hi : v;\n}\n\n/**\n * Convert slider index to simulation speed value\n * Note: MIN=0 is special; idx 0 => frozen. idx 1..(STEPS-1) => (0..MAX] in log space.\n */\nexport function indexToSpeed(idx: number): number {\n  if (idx <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  if (idx >= steps) return SPEED.MAX;\n\n  // normalized position excluding 0\n  const t = idx / steps; // idx=steps/2 => midpoint\n\n  // calibrated so midpoint  0.5\n  const targetMidSpeed = 0.5;\n  const minPositive = (targetMidSpeed * targetMidSpeed) / SPEED.MAX;\n\n  const minLog = Math.log(minPositive);\n  const maxLog = Math.log(SPEED.MAX);\n\n  return Math.exp(lerp(minLog, maxLog, t));\n}\n\n/**\n * Find the slider index closest to the given speed value\n */\nexport function speedToNearestIndex(speed: number): number {\n  if (speed <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  const last = steps - 1;\n\n  let best = 1;\n  let bestErr = Infinity;\n  const target = Math.log(speed);\n\n  for (let i = 1; i <= last; i++) {\n    const s = indexToSpeed(i);\n    const err = Math.abs(Math.log(s) - target);\n    if (err < bestErr) {\n      bestErr = err;\n      best = i;\n    }\n  }\n  return best;\n}\n","import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\nimport musicAudioNoise from \"../assets/lavaLamp/guitar.mp3\";\nimport clickAudioNoise from \"../assets/lavaLamp/click.mp3\";\nimport powerIcon from \"../assets/lavaLamp/power.svg\";\n\nimport { PersonalAudio } from \"../util/Audio\";\nimport { AudioAmplitudeAnalyzer } from \"../util/audioAmplitude.ts\";\n\n// Utility imports\nimport type { Particle, Vec2, SpatialGrid, AudioSource } from \"./utils/types.ts\";\nimport { AUDIO_SOURCES, DEFAULT_HIGH, DEFAULT_LOW, SIM, SPEED, FIXED_MS, MAX_CATCHUP_STEPS } from \"./utils/constants.ts\";\nimport { hslToHex, hexToHue, buildHeatLut256 } from \"./utils/colorUtils.ts\";\nimport { clampAllToBounds, computeParticleCount, createParticles, stepSimulationOnePairPass } from \"./utils/physics.ts\";\nimport { ensureGrid } from \"./utils/spatialGrid.ts\";\nimport { renderFrame } from \"./utils/rendering.ts\";\nimport { readSavedMusicTimeSeconds, writeSavedMusicTimeSeconds } from \"./utils/storage.ts\";\nimport { clampInt, indexToSpeed, speedToNearestIndex } from \"./utils/speedUtils.ts\";\n\n// Audio source configuration (needs access to audio asset imports)\nconst AUDIO_SOURCE_CONFIG = {\n  [AUDIO_SOURCES.REDWOOD]: {\n    label: \"redwood meditation\",\n    url: musicAudioNoise,\n  },\n  [AUDIO_SOURCES.KEXP]: {\n    label: \"kexp\",\n    url: \"https://kexp.streamguys1.com/kexp160.aac\",\n  },\n} as const;\n\n\n// Component\nexport default function LavaLamp(): ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const ctxRef = useRef<CanvasRenderingContext2D | null>(null);\n\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n  const particleCountRef = useRef<number | null>(null);\n\n  const gridRef = useRef<SpatialGrid | null>(null);\n\n  // 5) Cache dimensions ONCE (read only on page load)\n  const sizeRef = useRef<{ w: number; h: number }>({ w: 1, h: 1 });\n\n  const [audioSource, setAudioSource] = useState<AudioSource>(\n    AUDIO_SOURCES.KEXP\n  );\n\n  const gameMusic = useMemo(() => {\n    // Initialize directly with KEXP stream\n    const audio = new PersonalAudio(\n      AUDIO_SOURCE_CONFIG[AUDIO_SOURCES.KEXP].url,\n      true\n    );\n    audio.preload = \"auto\";\n    return audio;\n  }, []);\n  const clickSound = useMemo(\n    () => new PersonalAudio(clickAudioNoise, false),\n    []\n  );\n\n  const [hasStarted, setHasStarted] = useState(false);\n\n  const pointerDownRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  // Audio amplitude analysis\n  const amplitudeAnalyzerRef = useRef<AudioAmplitudeAnalyzer | null>(null);\n  const currentWaveformRef = useRef<number[]>(new Array(10).fill(0));\n  const [displayWaveform, setDisplayWaveform] = useState<number[]>(\n    new Array(10).fill(0)\n  );\n  const waveformUpdateCounterRef = useRef(0);\n\n  // Speed slider state\n  const defaultSpeedIdx = useMemo(() => speedToNearestIndex(SPEED.DEFAULT), []);\n  const [speedIdx, setSpeedIdx] = useState<number>(defaultSpeedIdx);\n  const speedRef = useRef<number>(SPEED.DEFAULT);\n\n  useEffect(() => {\n    speedRef.current = indexToSpeed(speedIdx);\n  }, [speedIdx]);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n  const toggleMenu = useCallback(() => setMenuOpen((v) => !v), []);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const [isFullscreen, setIsFullscreen] = useState<boolean>(false);\n\n  // Handle fullscreen changes\n  useEffect(() => {\n    const handleFullscreenChange = (): void => {\n      const inFullscreen = !!document.fullscreenElement;\n      setIsFullscreen(inFullscreen);\n\n      // Add/remove body class for CSS targeting\n      if (inFullscreen) {\n        document.body.classList.add(\"lava-lamp-fullscreen\");\n      } else {\n        document.body.classList.remove(\"lava-lamp-fullscreen\");\n      }\n\n      // Resize canvas to match new screen size\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      const w = window.innerWidth;\n      const h = window.innerHeight;\n\n      canvas.width = w;\n      canvas.height = h;\n\n      // Update cached size\n      sizeRef.current = { w, h };\n\n      // Reset image data to force recalculation\n      imageRef.current = null;\n\n      // Clamp existing particles to new bounds\n      if (particlesRef.current) {\n        clampAllToBounds(particlesRef.current, w, h);\n      }\n    };\n    document.addEventListener(\"fullscreenchange\", handleFullscreenChange);\n    return () => {\n      document.removeEventListener(\"fullscreenchange\", handleFullscreenChange);\n      document.body.classList.remove(\"lava-lamp-fullscreen\");\n    };\n  }, []);\n\n  const toggleFullscreen = useCallback((): void => {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen().catch((err) => {\n        console.error(\"Error attempting to enable fullscreen:\", err);\n      });\n    } else {\n      document.exitFullscreen();\n    }\n  }, []);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!menuOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setMenuOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [menuOpen]);\n\n  const [volume, setVolume] = useState(1.0);\n  useEffect(() => {\n    gameMusic.volume = volume;\n  }, [volume, gameMusic]);\n  const [nowPlaying, setNowPlaying] = useState<{\n    song: string;\n    artist: string;\n    album: string;\n    isAirbreak: boolean;\n  } | null>(null);\n  const [nowPlayingExpanded, setNowPlayingExpanded] = useState(true);\n  const nowPlayingSongRef = useRef<HTMLDivElement>(null);\n  const nowPlayingArtistRef = useRef<HTMLDivElement>(null);\n  const nowPlayingAlbumRef = useRef<HTMLDivElement>(null);\n  const [songOverflowing, setSongOverflowing] = useState(false);\n  const [artistOverflowing, setArtistOverflowing] = useState(false);\n  const [albumOverflowing, setAlbumOverflowing] = useState(false);\n\n  const isFirstRender = useRef(true);\n\n  useEffect(() => {\n    // Skip on first render - audio is already initialized with KEXP\n    if (isFirstRender.current) {\n      isFirstRender.current = false;\n      return;\n    }\n\n    const config = AUDIO_SOURCE_CONFIG[audioSource];\n    const wasPlaying = gameMusic.isPlaying();\n\n    // Pause current audio before switching\n    if (wasPlaying) {\n      gameMusic.pause();\n    }\n\n    gameMusic.src = config.url;\n    gameMusic.load();\n\n    if (wasPlaying) {\n      const onCanPlay = () => {\n        gameMusic.play().catch(() => {\n          // ignore autoplay errors\n        });\n        gameMusic.removeEventListener(\"canplaythrough\", onCanPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onCanPlay, { once: true });\n    }\n  }, [audioSource, gameMusic]);\n\n  // Fetch KEXP now playing info\n  useEffect(() => {\n    if (!hasStarted || audioSource !== AUDIO_SOURCES.KEXP) {\n      setNowPlaying(null);\n      return;\n    }\n\n    const fetchNowPlaying = async () => {\n      try {\n        const response = await fetch(\"https://api.kexp.org/v2/plays/?limit=5\");\n        const data = await response.json();\n\n        // Get the most recent play regardless of type\n        const mostRecentPlay = data.results?.[0];\n\n        if (!mostRecentPlay) {\n          console.log(\"[KEXP] No plays found\");\n          return;\n        }\n\n        // Check if it's an airbreak\n        if (mostRecentPlay.play_type === \"airbreak\") {\n          setNowPlaying({\n            song: \"airbreak\",\n            artist: \"\",\n            album: \"\",\n            isAirbreak: true,\n          });\n        } else if (mostRecentPlay.play_type === \"trackplay\") {\n          const newTrack = {\n            song: (mostRecentPlay.song || \"unknown track\").toLowerCase(),\n            artist: (mostRecentPlay.artist || \"unknown artist\").toLowerCase(),\n            album: (mostRecentPlay.album || \"unknown album\").toLowerCase(),\n            isAirbreak: false,\n          };\n          setNowPlaying(newTrack);\n        }\n      } catch (err) {\n        console.log(\"[KEXP] Fetch error:\", err);\n      }\n    };\n\n    fetchNowPlaying();\n    const interval = setInterval(fetchNowPlaying, 5000); // Poll every 5 seconds\n\n    return () => clearInterval(interval);\n  }, [hasStarted, audioSource]);\n\n  // Check for text overflow and apply scrolling class\n  useEffect(() => {\n    const SCROLL_SPEED = 30; // pixels per second (slower = more readable)\n\n    const calculateScrollDuration = (\n      containerWidth: number,\n      textWidth: number\n    ): number => {\n      // Distance = just the text width (text scrolls from 0% to -100%)\n      return textWidth / SCROLL_SPEED;\n    };\n\n    const calculateSecondCopyDelay = (\n      containerWidth: number,\n      textWidth: number,\n      duration: number\n    ): number => {\n      // Wait for Copy 1 to completely scroll off screen before starting Copy 2\n      // At 100% of the animation, Copy 1 is at translateX(-100%) (fully off screen)\n      // Copy 2 starts its animation just as Copy 1 loops back to the beginning\n      return 1.0;\n    };\n\n    const checkOverflow = () => {\n      if (nowPlayingSongRef.current) {\n        const wrapper = nowPlayingSongRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingSongRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setSongOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingSongRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingSongRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingSongRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingSongRef.current.classList.remove(\"overflowing\");\n        }\n      }\n\n      if (nowPlayingArtistRef.current) {\n        const wrapper = nowPlayingArtistRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingArtistRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setArtistOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingArtistRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingArtistRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingArtistRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingArtistRef.current.classList.remove(\"overflowing\");\n        }\n      }\n\n      if (nowPlayingAlbumRef.current) {\n        const wrapper = nowPlayingAlbumRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingAlbumRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setAlbumOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingAlbumRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingAlbumRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingAlbumRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingAlbumRef.current.classList.remove(\"overflowing\");\n        }\n      }\n    };\n\n    checkOverflow();\n    window.addEventListener(\"resize\", checkOverflow);\n\n    return () => window.removeEventListener(\"resize\", checkOverflow);\n  }, [nowPlaying, nowPlayingExpanded]);\n\n  const lavaLowColorRef = useRef(DEFAULT_LOW);\n  const lavaHighColorRef = useRef(DEFAULT_HIGH);\n\n  const [lavaLowColor, setLavaLowColor] = useState(DEFAULT_LOW);\n  const [lavaHighColor, setLavaHighColor] = useState(DEFAULT_HIGH);\n  const [rainbowMode, setRainbowMode] = useState(false);\n  const rainbowLowHueRef = useRef(0);\n  const rainbowHighHueRef = useRef(0);\n\n  const heatLutRef = useRef<Uint32Array>(\n    buildHeatLut256(DEFAULT_LOW, DEFAULT_HIGH)\n  );\n\n  // Rebuild LUT whenever colors change; redraw immediately if running.\n  useEffect(() => {\n    lavaLowColorRef.current = lavaLowColor;\n    lavaHighColorRef.current = lavaHighColor;\n    heatLutRef.current = buildHeatLut256(lavaLowColor, lavaHighColor);\n  }, [lavaLowColor, lavaHighColor, hasStarted]);\n\n  // 5) Cache canvas/context + dimensions (only read on initial mount)\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n    sizeRef.current = { w, h };\n\n    canvas.width = w;\n    canvas.height = h;\n\n    ctxRef.current = canvas.getContext(\"2d\");\n\n    // ensure image data matches cached size\n    imageRef.current = null;\n\n    // no resize listener by request\n  }, []);\n\n  const initializeParticlesOnce = useCallback(() => {\n    const { w, h } = sizeRef.current;\n\n    if (particleCountRef.current === null) {\n      particleCountRef.current = computeParticleCount(w, h);\n    }\n\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n\n    ensureGrid(gridRef, w, h, count, SIM.COHESION_RADIUS);\n  }, []);\n\n  const saveMusicPosition = useCallback(() => {\n    writeSavedMusicTimeSeconds(gameMusic.currentTime ?? 0);\n  }, [gameMusic]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    const tick = () => saveMusicPosition();\n    const id = window.setInterval(tick, 1000);\n\n    const onPageHide = () => saveMusicPosition();\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"hidden\") saveMusicPosition();\n    };\n\n    window.addEventListener(\"pagehide\", onPageHide);\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n\n    return () => {\n      window.clearInterval(id);\n      window.removeEventListener(\"pagehide\", onPageHide);\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    };\n  }, [hasStarted, saveMusicPosition]);\n\n  useEffect(() => {\n    return () => {\n      saveMusicPosition();\n\n      gameMusic.pause();\n      gameMusic.volume = 0;\n      gameMusic.reset();\n\n      clickSound.pause();\n      clickSound.volume = 0;\n      clickSound.reset();\n\n      // Cleanup amplitude analyzer\n      if (amplitudeAnalyzerRef.current) {\n        amplitudeAnalyzerRef.current.disconnect();\n        amplitudeAnalyzerRef.current = null;\n      }\n    };\n  }, [gameMusic, clickSound, saveMusicPosition]);\n\n  const updateOnce = useCallback(() => {\n    const g = gridRef.current;\n    if (!g) return;\n\n    const { w, h } = sizeRef.current;\n\n    stepSimulationOnePairPass(\n      particlesRef.current,\n      w,\n      h,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current,\n      speedRef.current,\n      g\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    const ctx = ctxRef.current;\n    if (!canvas || !ctx) return;\n\n    renderFrame(\n      ctx,\n      canvas,\n      particlesRef.current,\n      imageRef,\n      heatLutRef.current\n    );\n  }, []);\n\n  // 0) Fixed update cadence: updates happen at FIXED_FPS regardless of render speed.\n  const clockRef = useRef<{ last: number; acc: number }>({ last: 0, acc: 0 });\n\n  const animate = useCallback(\n    (now: number) => {\n      const clock = clockRef.current;\n\n      if (clock.last === 0) clock.last = now;\n      const delta = now - clock.last;\n      clock.last = now;\n\n      // Clamp massive deltas (tab-switch etc.)\n      clock.acc += Math.min(250, Math.max(0, delta));\n\n      let steps = 0;\n      while (clock.acc >= FIXED_MS && steps < MAX_CATCHUP_STEPS) {\n        updateOnce();\n        clock.acc -= FIXED_MS;\n        steps++;\n      }\n\n      // Drop extra backlog to avoid death spiral\n      if (clock.acc >= FIXED_MS) clock.acc = 0;\n\n      // Update audio waveform bars (update state every 5 frames for smoother, calmer animation)\n      if (amplitudeAnalyzerRef.current) {\n        currentWaveformRef.current =\n          amplitudeAnalyzerRef.current.getWaveformBars(10);\n        waveformUpdateCounterRef.current++;\n        if (waveformUpdateCounterRef.current >= 5) {\n          setDisplayWaveform(currentWaveformRef.current);\n          waveformUpdateCounterRef.current = 0;\n        }\n      }\n\n      draw();\n      rafRef.current = requestAnimationFrame(animate);\n    },\n    [draw, updateOnce]\n  );\n\n  // Initialize rainbow hues from current colors ONLY when rainbow mode is enabled\n  const prevRainbowModeRef = useRef(false);\n  useEffect(() => {\n    // Only initialize when rainbow mode transitions from false -> true\n    if (rainbowMode && !prevRainbowModeRef.current) {\n      // Start rainbow from the current colors' hues\n      rainbowLowHueRef.current = hexToHue(lavaLowColor);\n      rainbowHighHueRef.current = hexToHue(lavaHighColor);\n    }\n    prevRainbowModeRef.current = rainbowMode;\n  }, [rainbowMode, lavaLowColor, lavaHighColor]);\n\n  // Rainbow mode color cycling\n  useEffect(() => {\n    if (!rainbowMode) return;\n\n    let animationId: number;\n    let lastTime = performance.now();\n\n    const updateRainbowColors = (now: number) => {\n      const deltaTime = now - lastTime;\n      lastTime = now;\n\n      // Speed scales from 0 (frozen) to 5 (max)\n      // Rainbow speed: 0.02 degrees per frame at speed=1, scales linearly\n      const baseSpeed = 0.02;\n      const speed = speedRef.current;\n      const normalizedDelta = deltaTime / 16.67; // normalize to ~60fps\n\n      // Drift hot and cold independently at slightly different rates\n      const lowIncrement = baseSpeed * speed * normalizedDelta;\n      const highIncrement = baseSpeed * speed * normalizedDelta * 1.3; // 30% faster\n\n      rainbowLowHueRef.current =\n        (rainbowLowHueRef.current + lowIncrement) % 360;\n      rainbowHighHueRef.current =\n        (rainbowHighHueRef.current + highIncrement) % 360;\n\n      const lowColor = hslToHex(rainbowLowHueRef.current, 1.0, 0.5);\n      const highColor = hslToHex(rainbowHighHueRef.current, 1.0, 0.5);\n\n      setLavaLowColor(lowColor);\n      setLavaHighColor(highColor);\n\n      animationId = requestAnimationFrame(updateRainbowColors);\n    };\n\n    animationId = requestAnimationFrame(updateRainbowColors);\n\n    return () => cancelAnimationFrame(animationId);\n  }, [rainbowMode]);\n\n  // Pointer handling\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const toLocal = (e: PointerEvent): Vec2 => {\n      const rect = canvas.getBoundingClientRect();\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n    };\n\n    const onDown = (e: PointerEvent) => {\n      pointerDownRef.current = true;\n      pointerPosRef.current = toLocal(e);\n    };\n    const onMove = (e: PointerEvent) => {\n      pointerPosRef.current = toLocal(e);\n    };\n    const onUp = () => {\n      pointerDownRef.current = false;\n    };\n\n    canvas.addEventListener(\"pointerdown\", onDown);\n    window.addEventListener(\"pointermove\", onMove);\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"pointercancel\", onUp);\n\n    return () => {\n      canvas.removeEventListener(\"pointerdown\", onDown);\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"pointercancel\", onUp);\n    };\n  }, []);\n\n  const playClick = useCallback(() => {\n    try {\n      clickSound.volume = 1.0;\n      clickSound.currentTime = 0;\n      clickSound.reset();\n      clickSound.play();\n    } catch {\n      // ignore\n    }\n  }, [clickSound]);\n\n  const resumeMusicFromSavedTime = useCallback(() => {\n    const t = readSavedMusicTimeSeconds();\n    try {\n      const duration = (gameMusic as any).duration as number | undefined;\n      if (\n        typeof duration === \"number\" &&\n        Number.isFinite(duration) &&\n        duration > 0\n      ) {\n        gameMusic.currentTime = t % duration;\n      } else {\n        gameMusic.currentTime = t;\n      }\n    } catch {\n      // ignore\n    }\n  }, [gameMusic]);\n\n  const startLamp = useCallback(async () => {\n    playClick();\n\n    if (!hasStarted) {\n      setHasStarted(true);\n      initializeParticlesOnce();\n\n      // reset fixed-timestep clock\n      clockRef.current = { last: 0, acc: 0 };\n\n      // draw a first frame immediately\n      requestAnimationFrame(() => draw());\n\n      // start RAF loop\n      rafRef.current = requestAnimationFrame(animate);\n\n      // Initialize amplitude analyzer\n      if (!amplitudeAnalyzerRef.current) {\n        const analyzer = new AudioAmplitudeAnalyzer();\n        const connected = analyzer.connect(gameMusic);\n        if (connected) {\n          amplitudeAnalyzerRef.current = analyzer;\n          console.log(\"[LavaLamp] Audio amplitude analyzer connected\");\n        } else {\n          console.warn(\"[LavaLamp] Failed to connect audio amplitude analyzer\");\n        }\n      }\n    }\n\n    // Resume audio context if suspended\n    if (amplitudeAnalyzerRef.current) {\n      amplitudeAnalyzerRef.current.resume();\n    }\n\n    // Only resume from saved time for non-streaming sources (like Redwood)\n    if (audioSource !== AUDIO_SOURCES.KEXP) {\n      resumeMusicFromSavedTime();\n    }\n    gameMusic.volume = 1.0;\n\n    // Ensure audio is loaded before trying to play\n    if (gameMusic.readyState < 3) {\n      // If not enough data loaded, trigger load and wait\n      gameMusic.load();\n\n      const onCanPlay = async () => {\n        try {\n          await gameMusic.play();\n        } catch {\n          // ignore if still fails\n        }\n        gameMusic.removeEventListener(\"canplaythrough\", onCanPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onCanPlay, { once: true });\n    } else {\n      // Audio already loaded, play immediately\n      try {\n        await gameMusic.play();\n      } catch {\n        // ignore autoplay errors\n      }\n    }\n  }, [\n    animate,\n    audioSource,\n    draw,\n    gameMusic,\n    hasStarted,\n    initializeParticlesOnce,\n    playClick,\n    resumeMusicFromSavedTime,\n  ]);\n\n  const initialCanvasSize = useMemo(\n    () => ({ w: window.innerWidth, h: window.innerHeight }),\n    []\n  );\n\n  const lastSpeedIdx = SPEED.STEPS - 1;\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n      />\n\n      {nowPlaying && (\n        <div\n          className={`lava-lamp-now-playing ${\n            nowPlayingExpanded ? \"expanded\" : \"collapsed\"\n          }`}\n        >\n          <button\n            type=\"button\"\n            className=\"lava-lamp-now-playing-toggle\"\n            onClick={() => setNowPlayingExpanded(!nowPlayingExpanded)}\n            aria-label={\n              nowPlayingExpanded ? \"Collapse now playing\" : \"Expand now playing\"\n            }\n          >\n            {nowPlayingExpanded ? \"\" : \"\"}\n          </button>\n          <div className=\"lava-lamp-now-playing-content\">\n            <div className=\"lava-lamp-now-playing-header\">\n              <div className=\"lava-lamp-now-playing-label\">kexp</div>\n              {!nowPlaying.isAirbreak && (\n                <div className=\"lava-lamp-soundwave\">\n                  {displayWaveform.map((height, i) => (\n                    <div\n                      key={i}\n                      className=\"lava-lamp-soundwave-bar\"\n                      style={{ \"--bar-height\": height } as React.CSSProperties}\n                    />\n                  ))}\n                </div>\n              )}\n            </div>\n            <div ref={nowPlayingSongRef} className=\"lava-lamp-now-playing-song\">\n              <span className=\"scroll-wrapper\">{nowPlaying.song}</span>\n              {songOverflowing && (\n                <span className=\"scroll-wrapper second\">{nowPlaying.song}</span>\n              )}\n            </div>\n            {!nowPlaying.isAirbreak && (\n              <>\n                <div\n                  ref={nowPlayingArtistRef}\n                  className=\"lava-lamp-now-playing-artist\"\n                >\n                  <span className=\"scroll-wrapper\">{nowPlaying.artist}</span>\n                  {artistOverflowing && (\n                    <span className=\"scroll-wrapper second\">\n                      {nowPlaying.artist}\n                    </span>\n                  )}\n                </div>\n                <div\n                  ref={nowPlayingAlbumRef}\n                  className=\"lava-lamp-now-playing-album\"\n                >\n                  <span className=\"scroll-wrapper\">{nowPlaying.album}</span>\n                  {albumOverflowing && (\n                    <span className=\"scroll-wrapper second\">\n                      {nowPlaying.album}\n                    </span>\n                  )}\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n\n      {!hasStarted ? (\n        <div className=\"lava-lamp-start-overlay\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-start\"\n            onClick={startLamp}\n            aria-label=\"Start lava lamp radio\"\n          >\n            <img src={powerIcon} alt=\"Power\" className=\"lava-lamp-start-icon\" />\n          </button>\n        </div>\n      ) : (\n        <div className=\"lava-lamp-controls\" ref={menuRef}>\n          <button\n            type=\"button\"\n            className=\"lava-lamp-menu-toggle\"\n            onClick={toggleMenu}\n            aria-label={menuOpen ? \"Hide menu\" : \"Show menu\"}\n            aria-pressed={menuOpen}\n          >\n            {menuOpen ? \"\" : \"\"}\n          </button>\n\n          {menuOpen && (\n            <div className=\"lava-lamp-menu\">\n              {/* Speed */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    speed: {speedIdx}\n                  </div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={lastSpeedIdx}\n                    step={1}\n                    value={speedIdx}\n                    onChange={(e) =>\n                      setSpeedIdx(\n                        clampInt(Number(e.target.value), 0, lastSpeedIdx)\n                      )\n                    }\n                    aria-label=\"Simulation speed\"\n                  />\n                </div>\n              </div>\n\n              {/* Volume */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    volume: {Math.round(volume * 100)}%\n                  </div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={1}\n                    step={0.01}\n                    value={volume}\n                    onChange={(e) => setVolume(Number(e.target.value))}\n                    aria-label=\"Music volume\"\n                  />\n                </div>\n              </div>\n\n              {/* Audio Source */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">audio source</div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <select\n                    className=\"lava-lamp-slider\"\n                    value={audioSource}\n                    onChange={(e) =>\n                      setAudioSource(e.target.value as AudioSource)\n                    }\n                    aria-label=\"Audio source\"\n                  >\n                    {Object.entries(AUDIO_SOURCE_CONFIG).map(\n                      ([key, config]) => (\n                        <option key={key} value={key}>\n                          {config.label}\n                        </option>\n                      )\n                    )}\n                  </select>\n                </div>\n              </div>\n\n              {/* Lava colors */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">lava colors</div>\n                </div>\n\n                {/* Rainbow mode toggle */}\n                <div\n                  className=\"lava-lamp-slider-wrap\"\n                  style={{ marginBottom: \"12px\" }}\n                >\n                  <label\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"8px\",\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      className=\"lava-lamp-checkbox\"\n                      checked={rainbowMode}\n                      onChange={(e) => setRainbowMode(e.target.checked)}\n                    />\n                    <span style={{ fontSize: \"13px\", opacity: 0.9 }}>\n                      rainbow drift mode\n                    </span>\n                  </label>\n                </div>\n\n                <div className=\"lava-lamp-color-row\">\n                  <label className=\"lava-lamp-color-label\">\n                    hot\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaHighColor}\n                      onChange={(e) => {\n                        setLavaHighColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava high color\"\n                    />\n                  </label>\n\n                  <label className=\"lava-lamp-color-label\">\n                    cool\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaLowColor}\n                      onChange={(e) => {\n                        setLavaLowColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava low color\"\n                    />\n                  </label>\n\n                  <button\n                    type=\"button\"\n                    className=\"lava-lamp-color-reset\"\n                    onClick={() => {\n                      setLavaLowColor(DEFAULT_LOW);\n                      setLavaHighColor(DEFAULT_HIGH);\n                      setRainbowMode(false);\n                    }}\n                    disabled={rainbowMode}\n                  >\n                    reset\n                  </button>\n                </div>\n              </div>\n\n              {/* Fullscreen */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-slider-wrap\">\n                  <label\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"8px\",\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      className=\"lava-lamp-checkbox\"\n                      checked={isFullscreen}\n                      onChange={toggleFullscreen}\n                    />\n                    <span style={{ fontSize: \"13px\", opacity: 0.9 }}>\n                      fullscreen mode\n                    </span>\n                  </label>\n                </div>\n              </div>\n\n              {/* Power off */}\n              <div className=\"lava-lamp-control-block\">\n                <button\n                  type=\"button\"\n                  className=\"lava-lamp-power-off\"\n                  onClick={() => window.location.reload()}\n                  aria-label=\"Power off\"\n                >\n                  <img\n                    src={powerIcon}\n                    alt=\"Power off\"\n                    className=\"lava-lamp-power-off-icon\"\n                  />\n                  <span>power off</span>\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * LocalStorage utilities for persisting state\n */\n\nimport { MUSIC_TIME_KEY } from \"./constants.ts\";\n\nexport function readSavedMusicTimeSeconds(): number {\n  try {\n    const raw = localStorage.getItem(MUSIC_TIME_KEY);\n    if (!raw) return 0;\n    const v = Number(raw);\n    return Number.isFinite(v) && v >= 0 ? v : 0;\n  } catch {\n    return 0;\n  }\n}\n\nexport function writeSavedMusicTimeSeconds(seconds: number): void {\n  try {\n    if (!Number.isFinite(seconds) || seconds < 0) return;\n    localStorage.setItem(MUSIC_TIME_KEY, String(seconds));\n  } catch {\n    // ignore\n  }\n}\n","export class PersonalAudio extends Audio {\n  constructor(src, loop=false) {\n    super(src);\n    this.loop = loop;\n    this.crossOrigin = \"anonymous\";\n  };\n\n  isPlayingSrc = (audioSrc) => {\n    return this.src?.includes(audioSrc)\n        && this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  isPlaying = () => {\n    return this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  timeLeft = () => this.duration - this.currentTime;\n\n  reset = () => {\n    this.pause();\n    this.currentTime = 0;\n  };\n}"],"names":["AudioAmplitudeAnalyzer","constructor","audioContext","analyser","dataArray","connected","connect","audioElement","this","AudioContext","createAnalyser","fftSize","smoothingTimeConstant","createMediaElementSource","destination","Uint8Array","frequencyBinCount","err","console","warn","getAmplitude","getByteTimeDomainData","sum","i","length","normalized","rms","Math","sqrt","min","getWaveformBars","barCount","Array","fill","bars","step","floor","index","abs","push","resume","state","catch","disconnect","close","isConnected","isMobile","detectMobile","userAgent","navigator","vendor","window","opera","isMobileUA","test","hasTouch","maxTouchPoints","isSmallScreen","innerWidth","AUDIO_SOURCES","REDWOOD","KEXP","DEFAULT_HIGH","DEFAULT_LOW","SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","PIXEL_SIZE","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","PARTICLES_PER_PIXEL","SPEED","MIN","MAX","DEFAULT","STEPS","FIXED_MS","MAX_CATCHUP_STEPS","MUSIC_TIME_KEY","hexToRgb","hex","h","trim","replace","r","parseInt","g","b","slice","hslToHex","s","l","a","f","n","k","color","max","round","toString","padStart","concat","hexToHue","rgb","delta","hue","lerpInt","t","v","packRgba","buildHeatLut256","lowHex","highHex","lo","hi","lut","Uint32Array","gridIndex","cx","cy","cols","clamp01","randInCircle","radius","angle","random","PI","x","cos","y","sin","bounceInBounds","p","width","height","vx","vy","clampAllToBounds","particles","applyBuoyancyAndGravity","dt","buoyancy","heat","applyFriction","pow","integrate","applyPointerHeat","pointerPos","dx","dy","d2","intensity","applyCohesionImpulse","p1","p2","d","force","invD","fx","fy","applyHeatConduction","conduction","applyBottomHeatOrAirCooling","neighborCount","distanceFromBottom","airExposure","renderFrame","ctx","canvas","imageRef","heatLut256","grid","imageData","img","current","createImageData","ensureImageData","canvasWidth","canvasHeight","pixelSize","threshold","r2","maxInfluenceDist","maxDistSq","data32","data","buffer","black","w","invCell","cellSize","influenceSum","heatWeightedSum","x0","x1","y0","y1","rows","gy","gx","particleIdx","heads","distSq","influence","next","rgba","py","yy","idx","rowEnd","xx","drawMetaballsWithGrid","drawMetaballs","putImageData","indexToSpeed","steps","minPositive","targetMidSpeed","minLog","log","maxLog","exp","lerp","AUDIO_SOURCE_CONFIG","label","url","musicAudioNoise","LavaLamp","canvasRef","useRef","ctxRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","gridRef","sizeRef","audioSource","setAudioSource","useState","gameMusic","useMemo","audio","PersonalAudio","preload","clickSound","clickAudioNoise","hasStarted","setHasStarted","pointerDownRef","pointerPosRef","amplitudeAnalyzerRef","currentWaveformRef","displayWaveform","setDisplayWaveform","waveformUpdateCounterRef","defaultSpeedIdx","speed","last","best","bestErr","Infinity","target","speedToNearestIndex","speedIdx","setSpeedIdx","speedRef","useEffect","menuOpen","setMenuOpen","toggleMenu","useCallback","menuRef","isFullscreen","setIsFullscreen","handleFullscreenChange","inFullscreen","document","fullscreenElement","body","classList","add","remove","innerHeight","addEventListener","removeEventListener","toggleFullscreen","exitFullscreen","documentElement","requestFullscreen","error","handleClickOutside","event","contains","volume","setVolume","nowPlaying","setNowPlaying","nowPlayingExpanded","setNowPlayingExpanded","nowPlayingSongRef","nowPlayingArtistRef","nowPlayingAlbumRef","songOverflowing","setSongOverflowing","artistOverflowing","setArtistOverflowing","albumOverflowing","setAlbumOverflowing","isFirstRender","config","wasPlaying","isPlaying","pause","src","load","onCanPlay","play","once","fetchNowPlaying","async","_data$results","response","fetch","mostRecentPlay","json","results","play_type","song","artist","album","isAirbreak","newTrack","toLowerCase","interval","setInterval","clearInterval","calculateScrollDuration","containerWidth","textWidth","checkOverflow","wrapper","querySelector","clientWidth","isOverflowing","scrollWidth","duration","delayFraction","style","setProperty","lavaLowColorRef","lavaHighColorRef","lavaLowColor","setLavaLowColor","lavaHighColor","setLavaHighColor","rainbowMode","setRainbowMode","rainbowLowHueRef","rainbowHighHueRef","heatLutRef","getContext","initializeParticlesOnce","area","computeParticleCount","count","particlesPerClump","centerX","centerY","clumpHeat","j","offset","createParticles","ceil","cells","Int32Array","ensureGrid","saveMusicPosition","_gameMusic$currentTim","seconds","Number","isFinite","localStorage","setItem","String","_unused2","writeSavedMusicTimeSeconds","currentTime","id","tick","onPageHide","onVisibilityChange","visibilityState","reset","updateOnce","pointerDown","neighborCounts","timeScale","cell","ny","nx","stepSimulationOnePairPass","draw","clockRef","acc","animate","now","clock","requestAnimationFrame","prevRainbowModeRef","animationId","lastTime","performance","updateRainbowColors","deltaTime","normalizedDelta","lowIncrement","highIncrement","lowColor","highColor","cancelAnimationFrame","toLocal","e","rect","getBoundingClientRect","clientX","left","clientY","top","onDown","onMove","onUp","playClick","_unused","resumeMusicFromSavedTime","raw","getItem","readSavedMusicTimeSeconds","startLamp","analyzer","readyState","_unused3","_unused4","initialCanvasSize","lastSpeedIdx","_jsxs","className","children","_jsx","ref","type","onClick","map","_Fragment","value","onChange","Object","entries","_ref","key","marginBottom","display","alignItems","gap","cursor","checked","fontSize","opacity","disabled","location","reload","powerIcon","alt","Audio","loop","arguments","undefined","super","isPlayingSrc","audioSrc","_this$src","includes","paused","ended","timeLeft","crossOrigin"],"sourceRoot":""}