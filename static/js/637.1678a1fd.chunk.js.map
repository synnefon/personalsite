{"version":3,"file":"static/js/637.1678a1fd.chunk.js","mappings":"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","sources":["assets/lavaLamp/power.svg","util/audioAmplitude.ts","lava_lamp/NowPlayingWidget.tsx","lava_lamp/utils/colorUtils.ts","lava_lamp/utils/deviceDetection.ts","lava_lamp/utils/constants.ts","lava_lamp/utils/spatialGrid.ts","lava_lamp/utils/physics.ts","lava_lamp/utils/rendering.ts","lava_lamp/utils/speedUtils.ts","lava_lamp/LavaLamp.tsx","lava_lamp/utils/storage.ts","util/Audio.js"],"sourcesContent":["var _g;\nconst _excluded = [\"title\", \"titleId\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport * as React from \"react\";\nfunction SvgPower(_ref, svgRef) {\n  let {\n      title,\n      titleId\n    } = _ref,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    id: \"Capa_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512.292 512.292\",\n    style: {\n      enableBackground: \"new 0 0 512.292 512.292\"\n    },\n    xmlSpace: \"preserve\",\n    width: 512,\n    height: 512,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M256.061,0L256.061,0c17.673,0,32,14.327,32,32v106.667c0,17.673-14.327,32-32,32l0,0c-17.673,0-32-14.327-32-32V32   C224.061,14.327,238.387,0,256.061,0z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M330.727,105.387L330.727,105.387c-0.157,10.742,5.259,20.8,14.315,26.581c80.432,49.143,105.796,154.185,56.652,234.616   S247.51,472.38,167.078,423.237S61.282,269.052,110.426,188.62c14.042-22.982,33.324-42.315,56.269-56.418   c9.211-5.781,14.773-15.92,14.699-26.795l0,0c0.049-17.673-14.238-32.039-31.911-32.088c-6.07-0.017-12.02,1.693-17.155,4.931   C22.233,146.634-11.58,291.318,56.803,401.412s213.067,143.907,323.161,75.524s143.907-213.067,75.524-323.161   c-19.035-30.645-44.879-56.489-75.524-75.524c-14.997-9.461-34.824-4.973-44.285,10.024   C332.447,93.397,330.731,99.33,330.727,105.387z\"\n  }))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgPower);\nexport default __webpack_public_path__ + \"static/media/power.632cc1e66922cf3fa35d93370ea84178.svg\";\nexport { ForwardRef as ReactComponent };","/**\n * Audio amplitude analysis for visualizing music playback.\n * Uses Web Audio API's AnalyserNode to extract real-time amplitude data.\n */\n\nexport class AudioAmplitudeAnalyzer {\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private dataArray: Uint8Array | null = null;\n  private connected = false;\n\n  /**\n   * Initialize and connect the analyser to an audio element.\n   * Must be called after user interaction to avoid autoplay restrictions.\n   */\n  connect(audioElement: HTMLAudioElement): boolean {\n    if (this.connected) return true;\n\n    try {\n      this.audioContext = new AudioContext();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256; // Small size for performance\n      this.analyser.smoothingTimeConstant = 0.95; // Higher = smoother (0-1 range)\n\n      const source = this.audioContext.createMediaElementSource(audioElement);\n      source.connect(this.analyser).connect(this.audioContext.destination);\n\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n      this.connected = true;\n\n      return true;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Failed to connect analyser:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Get current amplitude as a value between 0 and 1.\n   * Uses RMS (root mean square) for smooth, accurate amplitude measurement.\n   */\n  getAmplitude(): number {\n    if (!this.analyser || !this.dataArray) return 0;\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      // Calculate RMS amplitude\n      let sum = 0;\n      for (let i = 0; i < this.dataArray.length; i++) {\n        const normalized = (this.dataArray[i] - 128) / 128;\n        sum += normalized * normalized;\n      }\n\n      const rms = Math.sqrt(sum / this.dataArray.length);\n\n      // Boost the signal for better visualization (typical music is quiet)\n      return Math.min(1, rms * 3);\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading amplitude:', err);\n      return 0;\n    }\n  }\n\n  /**\n   * Get waveform values for multiple bars (e.g., 4 bars for visualization).\n   * Samples different points in the waveform and returns normalized values [0-1].\n   */\n  getWaveformBars(barCount: number): number[] {\n    if (!this.analyser || !this.dataArray) {\n      return new Array(barCount).fill(0);\n    }\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      const bars: number[] = [];\n      const step = Math.floor(this.dataArray.length / barCount);\n\n      for (let i = 0; i < barCount; i++) {\n        const index = i * step;\n        // Convert byte value (0-255, centered at 128) to 0-1 range\n        const normalized = Math.abs((this.dataArray[index] - 128) / 128);\n        // Very gentle boost for smooth, calm visualization\n        bars.push(Math.min(1, normalized * 1.2));\n      }\n\n      return bars;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading waveform:', err);\n      return new Array(barCount).fill(0);\n    }\n  }\n\n  /**\n   * Resume audio context if suspended (required on some browsers after page load).\n   */\n  resume(): void {\n    if (this.audioContext && this.audioContext.state === 'suspended') {\n      this.audioContext.resume().catch((err) => {\n        console.warn('[AudioAmplitude] Failed to resume audio context:', err);\n      });\n    }\n  }\n\n  /**\n   * Clean up resources.\n   */\n  disconnect(): void {\n    if (this.audioContext) {\n      this.audioContext.close().catch(() => {\n        // ignore\n      });\n      this.audioContext = null;\n    }\n    this.analyser = null;\n    this.dataArray = null;\n    this.connected = false;\n  }\n\n  isConnected(): boolean {\n    return this.connected;\n  }\n}\n","import React, { type ReactElement, useEffect, useRef, useState } from \"react\";\n\ninterface NowPlayingInfo {\n  song: string;\n  artist: string;\n  album: string;\n  isAirbreak: boolean;\n}\n\ninterface NowPlayingWidgetProps {\n  nowPlaying: NowPlayingInfo | null;\n  displayWaveform: number[];\n  expanded: boolean;\n  onToggle: () => void;\n}\n\nexport default function NowPlayingWidget({\n  nowPlaying,\n  displayWaveform,\n  expanded,\n  onToggle,\n}: NowPlayingWidgetProps): ReactElement | null {\n  const nowPlayingSongRef = useRef<HTMLDivElement>(null);\n  const nowPlayingArtistRef = useRef<HTMLDivElement>(null);\n  const nowPlayingAlbumRef = useRef<HTMLDivElement>(null);\n  const [songOverflowing, setSongOverflowing] = useState(false);\n  const [artistOverflowing, setArtistOverflowing] = useState(false);\n  const [albumOverflowing, setAlbumOverflowing] = useState(false);\n\n  // Check for text overflow and apply scrolling class\n  useEffect(() => {\n    const SCROLL_SPEED = 30; // pixels per second (slower = more readable)\n\n    const calculateScrollDuration = (textWidth: number): number => {\n      return textWidth / SCROLL_SPEED;\n    };\n\n    const calculateSecondCopyDelay = (): number => {\n      return 1.0;\n    };\n\n    // Helper for checking overflow on a single ref, calling the correct setter\n    function handleOverflowCheck(\n      elementRef: React.RefObject<HTMLDivElement>,\n      setOverflowing: React.Dispatch<React.SetStateAction<boolean>>\n    ) {\n      if (!elementRef.current) return;\n      const wrapper = elementRef.current.querySelector(\n        \".scroll-wrapper\"\n      ) as HTMLElement;\n      const containerWidth = elementRef.current.clientWidth;\n      const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n      setOverflowing(!!isOverflowing);\n\n      if (isOverflowing && wrapper) {\n        const duration = calculateScrollDuration(wrapper.scrollWidth);\n        const delayFraction = calculateSecondCopyDelay();\n        elementRef.current.style.setProperty(\n          \"--scroll-duration\",\n          `${duration}s`\n        );\n        elementRef.current.style.setProperty(\n          \"--second-copy-delay\",\n          `${delayFraction}`\n        );\n        elementRef.current.classList.add(\"overflowing\");\n      } else {\n        elementRef.current.classList.remove(\"overflowing\");\n      }\n    }\n\n    // Check all overflow states in a single pass\n    function checkAllOverflow() {\n      handleOverflowCheck(\n        nowPlayingSongRef as React.RefObject<HTMLDivElement>,\n        setSongOverflowing\n      );\n      handleOverflowCheck(\n        nowPlayingArtistRef as React.RefObject<HTMLDivElement>,\n        setArtistOverflowing\n      );\n      handleOverflowCheck(\n        nowPlayingAlbumRef as React.RefObject<HTMLDivElement>,\n        setAlbumOverflowing\n      );\n    }\n\n    checkAllOverflow();\n    window.addEventListener(\"resize\", checkAllOverflow);\n\n    return () => window.removeEventListener(\"resize\", checkAllOverflow);\n  }, [nowPlaying, expanded]);\n\n  if (!nowPlaying) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`lava-lamp-now-playing ${expanded ? \"expanded\" : \"collapsed\"}`}\n    >\n      <button\n        type=\"button\"\n        className=\"lava-lamp-now-playing-toggle\"\n        onClick={onToggle}\n        aria-label={expanded ? \"Collapse now playing\" : \"Expand now playing\"}\n      >\n        {expanded ? \">\" : \"<\"}\n      </button>\n      <div className=\"lava-lamp-now-playing-content\">\n        <div className=\"lava-lamp-now-playing-header\">\n          <div className=\"lava-lamp-now-playing-label\">kexp</div>\n          {!nowPlaying.isAirbreak && (\n            <div className=\"lava-lamp-soundwave\">\n              {displayWaveform.map((height, i) => (\n                <div\n                  key={i}\n                  className=\"lava-lamp-soundwave-bar\"\n                  style={{ \"--bar-height\": height } as React.CSSProperties}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n        <div ref={nowPlayingSongRef} className=\"lava-lamp-now-playing-song\">\n          <span className=\"scroll-wrapper\">{nowPlaying.song}</span>\n          {songOverflowing && (\n            <span className=\"scroll-wrapper second\">{nowPlaying.song}</span>\n          )}\n        </div>\n        {!nowPlaying.isAirbreak && (\n          <>\n            <div\n              ref={nowPlayingArtistRef}\n              className=\"lava-lamp-now-playing-artist\"\n            >\n              <span className=\"scroll-wrapper\">{nowPlaying.artist}</span>\n              {artistOverflowing && (\n                <span className=\"scroll-wrapper second\">\n                  {nowPlaying.artist}\n                </span>\n              )}\n            </div>\n            <div\n              ref={nowPlayingAlbumRef}\n              className=\"lava-lamp-now-playing-album\"\n            >\n              <span className=\"scroll-wrapper\">{nowPlaying.album}</span>\n              {albumOverflowing && (\n                <span className=\"scroll-wrapper second\">\n                  {nowPlaying.album}\n                </span>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n","/**\n * Optimized color manipulation and conversion utilities\n */\n\n// Fast hex -> rgb, avoids parseInt for fixed-length common cases\nexport function hexToRgb(hex: string): { r: number; g: number; b: number } {\n  let h = hex;\n  if (h[0] === \"#\") h = h.slice(1);\n  // Common 6-char HEX, skip parseInt loops for common case\n  if (h.length === 6) {\n    return {\n      r: (16 * hexCharToNibble(h[0]) + hexCharToNibble(h[1])),\n      g: (16 * hexCharToNibble(h[2]) + hexCharToNibble(h[3])),\n      b: (16 * hexCharToNibble(h[4]) + hexCharToNibble(h[5])),\n    };\n  }\n  // 3-character shorthand e.g. #fc1\n  if (h.length === 3) {\n    return {\n      r: 17 * hexCharToNibble(h[0]),\n      g: 17 * hexCharToNibble(h[1]),\n      b: 17 * hexCharToNibble(h[2]),\n    };\n  }\n  // fallback\n  return { r: 255, g: 221, b: 0 };\n}\n\n// Much faster than parseInt for single hex digit\nfunction hexCharToNibble(c: string): number {\n  const code = c.charCodeAt(0);\n  if (code >= 48 && code <= 57) return code - 48;\n  if (code >= 65 && code <= 70) return code - 55;\n  if (code >= 97 && code <= 102) return code - 87;\n  return 0;\n}\n\n// h, s, l in [0,1] for s/l\nexport function hslToHex(h: number, s: number, l: number): string {\n  // Fast HSL to RGB, inline float ops; avoid Math.min inside loop\n  const a = s * Math.min(l, 1 - l);\n  function f(n: number) {\n    const k = (n + h / 30) % 12;\n    const x = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n    // Clamp, no toString(16) padStart call if possible:\n    let val = Math.round(255 * x);\n    val = val < 0 ? 0 : val > 255 ? 255 : val;\n    // Branch-free 2-digit HEX\n    return hex2(val);\n  }\n  return `#${f(0)}${f(8)}${f(4)}`;\n}\n\n// Fast int->2 digit lowercase hex string\nfunction hex2(n: number): string {\n  if (n < 16) return \"0\" + n.toString(16);\n  return n.toString(16);\n}\n\nexport function hexToHue(hex: string): number {\n  // Use inlined logic for rgb decomposition; slightly reduces allocations\n  const { r, g, b } = hexToRgb(hex);\n  const rf = r * 0.00392156862745098; // 1/255\n  const gf = g * 0.00392156862745098;\n  const bf = b * 0.00392156862745098;\n\n  const max = rf > gf ? (rf > bf ? rf : bf) : (gf > bf ? gf : bf);\n  const min = rf < gf ? (rf < bf ? rf : bf) : (gf < bf ? gf : bf);\n  const delta = max - min;\n\n  if (delta < 1e-6) return 0; // Faster float compare\n\n  let hue: number;\n  if (max === rf) {\n    hue = ((gf - bf) / delta) % 6;\n  } else if (max === gf) {\n    hue = (bf - rf) / delta + 2;\n  } else {\n    hue = (rf - gf) / delta + 4;\n  }\n\n  hue = Math.round(hue * 60);\n  if (hue < 0) hue += 360;\n  return hue;\n}\n\n// Remove double clamp and branch, use Math.round directly, keep tight\nexport function lerpInt(a: number, b: number, t: number): number {\n  // (b-a)*t is fast, sometimes t=0 or t=1 exactly, so avoid floating error\n  const v = a + (b - a) * t;\n  // Clamp in a single pass\n  return v <= 0 ? 0 : v >= 255 ? 255 : (0.5 + v) | 0;\n}\n\n// Use unsigned right shift for fast Uint32 RGBA\nexport function packRgba(r: number, g: number, b: number, a: number): number {\n  // >>> 0 forces Uint32, improves perf in some engines\n  return ((a << 24) | (b << 16) | (g << 8) | r) >>> 0;\n}\n\nexport function buildHeatLut256(lowHex: string, highHex: string): Uint32Array {\n  const lo = hexToRgb(lowHex);\n  const hi = hexToRgb(highHex);\n\n  const lut = new Uint32Array(256);\n  // Hoist for reuse\n  const r0 = lo.r, r1 = hi.r;\n  const g0 = lo.g, g1 = hi.g;\n  const b0 = lo.b, b1 = hi.b;\n\n  for (let i = 0; i < 256; ++i) {\n    // Inline t, save divisions if possible\n    const t = i * 0.00392156862745098; // i / 255\n    const r = (r0 + (r1 - r0) * t + 0.5) | 0;\n    const g = (g0 + (g1 - g0) * t + 0.5) | 0;\n    const b = (b0 + (b1 - b0) * t + 0.5) | 0;\n    lut[i] = ((255 << 24) | (b << 16) | (g << 8) | r) >>> 0;\n  }\n  return lut;\n}\n","/**\n * Device detection utilities\n */\n\nexport const detectMobile = (): boolean => {\n  const userAgent =\n    navigator.userAgent ||\n    navigator.vendor ||\n    (window as Window & { opera?: string }).opera ||\n    \"\";\n\n  // Check for mobile user agents\n  const mobileRegex =\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  const isMobileUA = mobileRegex.test(userAgent);\n\n  // Check for touch capability\n  const hasTouch = \"ontouchstart\" in window || navigator.maxTouchPoints > 0;\n\n  // Check screen size (fallback)\n  const isSmallScreen = window.innerWidth <= 500;\n\n  // Consider it mobile if it has mobile UA OR (has touch AND small screen)\n  return isMobileUA || (hasTouch && isSmallScreen);\n};\n","/**\n * Configuration constants for the Lava Lamp simulation\n */\n\nimport { detectMobile } from \"./deviceDetection.ts\";\n\nconst isMobile = detectMobile();\n\n// Audio source configuration\nexport const AUDIO_SOURCES = {\n  REDWOOD: \"redwood\",\n  KEXP: \"kexp\",\n} as const;\n\n// Default color configuration\nexport const DEFAULT_HIGH = \"#ffdd00\";\nexport const DEFAULT_LOW = \"#ff5500\";\n\n// Physics simulation constants\nexport const SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\n// Rendering constants\n// PIXEL_SIZE is now computed adaptively based on screen size\nexport const RENDER = {\n  PARTICLE_RADIUS: 10,\n  THRESHOLD: 0.8,\n} as const;\n\n/**\n * Calculate adaptive pixel size based on screen dimensions\n * Based on benchmarks:\n * - 2522x1656 (4.18M) with 8px → needs ~14.4px\n * - 1681x1104 (1.86M) with 8px → needs ~9.6px\n * - 1401x920 (1.29M) with 8px → 8px (baseline)\n * - 375x667 (250K) with 8px → could be ~4.8px\n *\n * Target: ~14ms render time for 60fps\n */\nexport function computePixelSize(\n  width: number,\n  height: number,\n  basePixelSize: number = 8\n): number {\n  const area = width * height;\n\n  // Sweet spot: 1.29M pixels with 8px baseline\n  // Formula: pixelSize = basePixelSize * sqrt(area / 1,288,920)\n  const scaleFactor = Math.sqrt(area / 1_288_920);\n  const adaptivePixelSize = basePixelSize * scaleFactor;\n\n  // Clamp between 4 and 24\n  return Math.max(4, Math.min(24, Math.round(adaptivePixelSize)));\n}\n\n// Particle clustering configuration\nexport const CLUMPS = {\n  COUNT: 15,\n  RADIUS: isMobile ? 30 : 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n/**\n * The density of the lava lamp simulation (particles per pixel).\n * Higher values produce a greater number of particles (higher density).\n * Increase this number to make the lava lamp more dense.\n */\nexport const PARTICLES_PER_PIXEL = isMobile ? 0.00054 : 0.00061;\n\n/**\n * Maximum number of particles regardless of screen size.\n * This prevents performance issues on very large screens.\n */\nexport const MAX_PARTICLES = 2000;\n\n// Speed control configuration\nexport const SPEED = {\n  MIN: 0.0,\n  MAX: 5,\n  DEFAULT: 0.25,\n  STEPS: 10, // number of discrete positions\n} as const;\n\n// Fixed update rate (independent of render cost / screen size)\nexport const FIXED_FPS = 60;\nexport const FIXED_MS = 1000 / FIXED_FPS;\nexport const MAX_CATCHUP_STEPS = 5;\n\n// LocalStorage keys\nexport const MUSIC_TIME_KEY = \"lava-lamp-music-time\";\n","/**\n * Spatial grid utilities for efficient neighbor queries\n */\n\nimport type React from \"react\";\n\nexport type SpatialGrid = {\n  cellSize: number;\n  cols: number;\n  rows: number;\n  heads: Int32Array; // length cols*rows, head index or -1\n  next: Int32Array; // length particleCount, next index or -1\n};\n\nexport function ensureGrid(\n  gridRef: React.MutableRefObject<SpatialGrid | null>,\n  width: number,\n  height: number,\n  count: number,\n  cellSize: number\n): void {\n  const cols = Math.max(1, Math.ceil(width / cellSize));\n  const rows = Math.max(1, Math.ceil(height / cellSize));\n  const cells = cols * rows;\n\n  const g = gridRef.current;\n  if (\n    !g ||\n    g.cols !== cols ||\n    g.rows !== rows ||\n    g.cellSize !== cellSize ||\n    g.next.length !== count ||\n    g.heads.length !== cells\n  ) {\n    gridRef.current = {\n      cellSize,\n      cols,\n      rows,\n      heads: new Int32Array(cells),\n      next: new Int32Array(count),\n    };\n  }\n}\n\nexport function gridIndex(g: SpatialGrid, cx: number, cy: number): number {\n  return cy * g.cols + cx;\n}\n\n","/**\n * Physics simulation and particle behavior\n */\n\nimport type { Particle, Vec2, SpatialGrid } from \"./types.ts\";\nimport { SIM, CLUMPS, PARTICLES_PER_PIXEL, MAX_PARTICLES } from \"./constants.ts\";\nimport { gridIndex } from \"./spatialGrid.ts\";\n\n// Math utilities\nexport function clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\nexport function randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\n// Particle bounds checking\nexport function bounceInBounds(\n  p: Particle,\n  width: number,\n  height: number\n): void {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nexport function clampAllToBounds(\n  particles: Particle[],\n  width: number,\n  height: number\n): void {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\n// Particle count calculation\nexport function computeParticleCount(width: number, height: number): number {\n  const area = width * height;\n  const desired = Math.round(area * PARTICLES_PER_PIXEL);\n  return Math.min(desired, MAX_PARTICLES);\n}\n\n// Particle creation\nexport function createParticles(\n  width: number,\n  height: number,\n  count: number\n): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// Physics forces\nexport function applyBuoyancyAndGravity(p: Particle, dt: number): void {\n  const buoyancy = p.heat * p.heat * SIM.BUOYANCY;\n  p.vy += (SIM.GRAVITY - buoyancy) * dt;\n}\n\nexport function applyFriction(p: Particle, dt: number): void {\n  const f = Math.pow(SIM.FRICTION, dt);\n  p.vx *= f;\n  p.vy *= f;\n}\n\nexport function integrate(p: Particle, dt: number): void {\n  p.x += p.vx * dt;\n  p.y += p.vy * dt;\n}\n\nexport function applyPointerHeat(\n  p: Particle,\n  pointerPos: Vec2,\n  dt: number,\n  cooling: boolean = false\n): void {\n  const dx = p.x - pointerPos.x;\n  const dy = p.y - pointerPos.y;\n  const d2 = dx * dx + dy * dy;\n  const r = SIM.MOUSE_HEAT_RADIUS;\n  const r2 = r * r;\n\n  if (d2 < r2) {\n    const d = Math.sqrt(d2);\n    const intensity = 1 - d * (1 / r);\n    const heatChange = SIM.HEAT_RATE * 10 * intensity * dt;\n    p.heat += cooling ? -heatChange : heatChange;\n  }\n}\n\nexport function applyCohesionImpulse(\n  p1: Particle,\n  p2: Particle,\n  dx: number,\n  dy: number,\n  d: number,\n  dt: number\n): void {\n  const force = SIM.COHESION_STRENGTH * (1 - d * (1 / SIM.COHESION_RADIUS));\n  const invD = 1 / d;\n  const fx = dx * invD * force * dt;\n  const fy = dy * invD * force * dt;\n\n  p1.vx += fx;\n  p1.vy += fy;\n  p2.vx -= fx;\n  p2.vy -= fy;\n}\n\nexport function applyHeatConduction(\n  p1: Particle,\n  p2: Particle,\n  dt: number\n): void {\n  const heatDiff = p1.heat - p2.heat;\n  const conduction = heatDiff * SIM.HEAT_CONDUCTION * dt;\n  p1.heat -= conduction;\n  p2.heat += conduction;\n}\n\nexport function applyBottomHeatOrAirCooling(\n  p: Particle,\n  height: number,\n  neighborCount: number,\n  dt: number\n): void {\n  const distanceFromBottom = height - p.y;\n\n  if (distanceFromBottom < SIM.HEAT_SOURCE_DISTANCE) {\n    const intensity = 1 - distanceFromBottom * (1 / SIM.HEAT_SOURCE_DISTANCE);\n    p.heat += SIM.HEAT_RATE * intensity * dt;\n    return;\n  }\n\n  const maxNeighbors = 8;\n  const neighbors = neighborCount < maxNeighbors ? neighborCount : maxNeighbors;\n  const airExposure = 1 - neighbors / maxNeighbors;\n\n  p.heat -= SIM.COOL_RATE * (0.2 + airExposure * 0.8) * dt;\n}\n\n// Main simulation step\nexport function stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array,\n  timeScale: number,\n  grid: SpatialGrid,\n  pointerCooling: boolean = false\n): void {\n  const dt = Math.max(0, Math.min(4.0, timeScale));\n\n  // Pass 1: integrate + pointer heat + reset neighbors + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    applyBuoyancyAndGravity(p, dt);\n    applyFriction(p, dt);\n    integrate(p, dt);\n\n    if (pointerDown) applyPointerHeat(p, pointerPos, dt, pointerCooling);\n\n    neighborCounts[i] = 0;\n    bounceInBounds(p, width, height);\n  }\n\n  // dt=0 => frozen (no cohesion/conduction/cooling), but still clamp\n  if (dt === 0) {\n    for (let i = 0; i < particles.length; i++) {\n      particles[i].heat = clamp01(particles[i].heat);\n    }\n    clampAllToBounds(particles, width, height);\n    return;\n  }\n\n  // Build spatial hash\n  grid.heads.fill(-1);\n  const invCell = 1 / grid.cellSize;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    let cx = (p.x * invCell) | 0;\n    let cy = (p.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const cell = gridIndex(grid, cx, cy);\n    grid.next[i] = grid.heads[cell];\n    grid.heads[cell] = i;\n  }\n\n  // Pass 2: local neighbor forces + conduction\n  const r = SIM.COHESION_RADIUS;\n  const r2 = r * r;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p1 = particles[i];\n\n    let cx = (p1.x * invCell) | 0;\n    let cy = (p1.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const x0 = cx > 0 ? cx - 1 : cx;\n    const x1 = cx + 1 < grid.cols ? cx + 1 : cx;\n    const y0 = cy > 0 ? cy - 1 : cy;\n    const y1 = cy + 1 < grid.rows ? cy + 1 : cy;\n\n    for (let ny = y0; ny <= y1; ny++) {\n      for (let nx = x0; nx <= x1; nx++) {\n        let j = grid.heads[gridIndex(grid, nx, ny)];\n        while (j !== -1) {\n          if (j > i) {\n            const p2 = particles[j];\n            const dx = p2.x - p1.x;\n            const dy = p2.y - p1.y;\n            const d2 = dx * dx + dy * dy;\n\n            if (d2 > 0 && d2 < r2) {\n              neighborCounts[i]++;\n              neighborCounts[j]++;\n\n              const d = Math.sqrt(d2);\n              applyCohesionImpulse(p1, p2, dx, dy, d, dt);\n              applyHeatConduction(p1, p2, dt);\n            }\n          }\n          j = grid.next[j];\n        }\n      }\n    }\n  }\n\n  // Pass 3: bottom heat / air cooling + clamp heat + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n    applyBottomHeatOrAirCooling(p, height, neighborCounts[i], dt);\n    p.heat = clamp01(p.heat);\n  }\n\n  clampAllToBounds(particles, width, height);\n}\n","/**\n * Canvas rendering utilities for metaball effect (performance optimized)\n */\n\nimport type React from \"react\";\nimport type { Particle } from \"./types.ts\";\nimport { RENDER, computePixelSize } from \"./constants.ts\";\nimport { packRgba } from \"./colorUtils.ts\";\n\n// Cached black value for fill (avoid recomputation)\nconst BLACK_RGBA = packRgba(0, 0, 0, 255);\n\n/**\n * Ensures a properly-sized ImageData instance\n */\nexport function ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\n/**\n * Rapidly fills a pixel block given a color.\n * Hot loop with tight bounds checking.\n */\nfunction fillPixelBlockFast(\n  data32: Uint32Array,\n  x: number,\n  y: number,\n  px: number,\n  w: number,\n  h: number,\n  rgba: number\n) {\n  const ymax = Math.min(y + px, h);\n  const xmax = Math.min(x + px, w);\n  for (let yy = y; yy < ymax; yy++) {\n    let idx = yy * w + x;\n    for (let xx = x; xx < xmax; xx++) {\n      data32[idx++] = rgba;\n    }\n  }\n}\n\n/**\n * Metaball rendering (brute force for all particles per pixel).\n */\nexport function drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number,\n  heatLut256: Uint32Array,\n  pixelSize: number\n): void {\n  const threshold = RENDER.THRESHOLD;\n  const particleRadiusSquared = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n  const data32 = new Uint32Array(imageData.data.buffer);\n\n  // Fill the entire image with black using the cached RGBA value.\n  data32.fill(BLACK_RGBA);\n\n  const width = canvasWidth;\n  const height = canvasHeight;\n\n  for (let y = 0; y < height; y += pixelSize) {\n    for (let x = 0; x < width; x += pixelSize) {\n      let influenceSum = 0;\n      let heatSum = 0;\n\n      // Calculate influence from all particles at this block's top-left corner.\n      for (let i = 0; i < particles.length; ++i) {\n        const p = particles[i];\n        const dx = x - p.x;\n        const dy = y - p.y;\n        const distanceSquared = dx * dx + dy * dy;\n        const influence = particleRadiusSquared / (distanceSquared + 1);\n\n        influenceSum += influence;\n        heatSum += influence * p.heat;\n      }\n\n      // Only render if total influence exceeds the threshold.\n      if (influenceSum <= threshold) continue;\n\n      // Weighted average heat based on influence.\n      const heat = heatSum / influenceSum;\n      const lutIdx = heat <= 0 ? 0 : heat >= 1 ? 255 : (heat * 255) | 0;\n      const colorRgba = heatLut256[lutIdx];\n\n      fillPixelBlockFast(data32, x, y, pixelSize, width, height, colorRgba);\n    }\n  }\n}\n\n/**\n * Renders a frame.\n */\nexport function renderFrame(\n  ctx: CanvasRenderingContext2D,\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>,\n  heatLut256: Uint32Array\n): void {\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n  const pixelSize = computePixelSize(canvas.width, canvas.height);\n\n  drawMetaballs(\n    imageData,\n    particles,\n    canvas.width,\n    canvas.height,\n    heatLut256,\n    pixelSize\n  );\n\n  ctx.putImageData(imageData, 0, 0);\n}\n","/**\n * Speed control utilities for the simulation\n */\n\nimport { SPEED } from \"./constants.ts\";\nimport { lerp } from \"./physics.ts\";\n\nexport function clampInt(v: number, lo: number, hi: number): number {\n  return v < lo ? lo : v > hi ? hi : v;\n}\n\n/**\n * Convert slider index to simulation speed value\n * Note: MIN=0 is special; idx 0 => frozen. idx 1..(STEPS-1) => (0..MAX] in log space.\n */\nexport function indexToSpeed(idx: number): number {\n  if (idx <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  if (idx >= steps) return SPEED.MAX;\n\n  // normalized position excluding 0\n  const t = idx / steps; // idx=steps/2 => midpoint\n\n  // calibrated so midpoint ≈ 0.5\n  const targetMidSpeed = 0.5;\n  const minPositive = (targetMidSpeed * targetMidSpeed) / SPEED.MAX;\n\n  const minLog = Math.log(minPositive);\n  const maxLog = Math.log(SPEED.MAX);\n\n  return Math.exp(lerp(minLog, maxLog, t));\n}\n\n/**\n * Find the slider index closest to the given speed value\n */\nexport function speedToNearestIndex(speed: number): number {\n  if (speed <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  const last = steps - 1;\n\n  let best = 1;\n  let bestErr = Infinity;\n  const target = Math.log(speed);\n\n  for (let i = 1; i <= last; i++) {\n    const s = indexToSpeed(i);\n    const err = Math.abs(Math.log(s) - target);\n    if (err < bestErr) {\n      bestErr = err;\n      best = i;\n    }\n  }\n  return best;\n}\n","import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\n// @ts-expect-error - Asset import\nimport musicAudioNoise from \"../assets/lavaLamp/guitar.mp3\";\n// @ts-expect-error - Asset import\nimport clickAudioNoise from \"../assets/lavaLamp/click.mp3\";\n// @ts-expect-error - Asset import\nimport powerIcon from \"../assets/lavaLamp/power.svg\";\n\nimport { PersonalAudio } from \"../util/Audio\";\nimport { AudioAmplitudeAnalyzer } from \"../util/audioAmplitude.ts\";\nimport NowPlayingWidget from \"./NowPlayingWidget.tsx\";\nimport { buildHeatLut256, hexToHue, hslToHex } from \"./utils/colorUtils.ts\";\nimport {\n  AUDIO_SOURCES,\n  DEFAULT_HIGH,\n  DEFAULT_LOW,\n  FIXED_MS,\n  MAX_CATCHUP_STEPS,\n  SIM,\n  SPEED,\n} from \"./utils/constants.ts\";\nimport { detectMobile } from \"./utils/deviceDetection.ts\";\nimport {\n  clampAllToBounds,\n  computeParticleCount,\n  createParticles,\n  stepSimulationOnePairPass,\n} from \"./utils/physics.ts\";\nimport { renderFrame } from \"./utils/rendering.ts\";\nimport { ensureGrid } from \"./utils/spatialGrid.ts\";\nimport {\n  clampInt,\n  indexToSpeed,\n  speedToNearestIndex,\n} from \"./utils/speedUtils.ts\";\nimport {\n  readSavedMusicTimeSeconds,\n  writeSavedMusicTimeSeconds,\n} from \"./utils/storage.ts\";\nimport type {\n  AudioSource,\n  Particle,\n  SpatialGrid,\n  Vec2,\n} from \"./utils/types.ts\";\n\n// Audio source config for select\nconst AUDIO_SOURCE_CONFIG = {\n  [AUDIO_SOURCES.REDWOOD]: {\n    label: \"redwood meditation\",\n    url: musicAudioNoise,\n  },\n  [AUDIO_SOURCES.KEXP]: {\n    label: \"kexp\",\n    url: \"https://kexp.streamguys1.com/kexp160.aac\",\n  },\n} as const;\n\nexport default function LavaLamp(): ReactElement {\n  const isMobile = detectMobile();\n\n  // --- Core Refs/State ---\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const ctxRef = useRef<CanvasRenderingContext2D | null>(null);\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n  const particleCountRef = useRef<number | null>(null);\n  const gridRef = useRef<SpatialGrid | null>(null);\n  const sizeRef = useRef<{ w: number; h: number }>({ w: 1, h: 1 });\n\n  const [audioSource, setAudioSource] = useState<AudioSource>(\n    AUDIO_SOURCES.KEXP\n  );\n\n  // Audio setup\n  const gameMusic = useMemo(() => {\n    const audio = new PersonalAudio(\n      AUDIO_SOURCE_CONFIG[AUDIO_SOURCES.KEXP].url,\n      true\n    );\n    audio.preload = \"auto\";\n    return audio;\n  }, []);\n  const clickSound = useMemo(\n    () => new PersonalAudio(clickAudioNoise, false),\n    []\n  );\n\n  const [hasStarted, setHasStarted] = useState(false);\n  const pointerDownRef = useRef(false);\n  const pointerCoolingRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  // --- Audio Amplitude ---\n  const amplitudeAnalyzerRef = useRef<AudioAmplitudeAnalyzer | null>(null);\n  const currentWaveformRef = useRef<number[]>(Array(10).fill(0));\n  const [displayWaveform, setDisplayWaveform] = useState<number[]>(\n    Array(10).fill(0)\n  );\n  const waveformUpdateCounterRef = useRef(0);\n\n  // --- Controls UI State ---\n  const defaultSpeedIdx = useMemo(() => speedToNearestIndex(SPEED.DEFAULT), []);\n  const [speedIdx, setSpeedIdx] = useState<number>(defaultSpeedIdx);\n  const speedRef = useRef<number>(SPEED.DEFAULT);\n\n  useEffect(() => {\n    speedRef.current = indexToSpeed(speedIdx);\n  }, [speedIdx]);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n  const toggleMenu = useCallback(() => setMenuOpen((v) => !v), []);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  // --- Fullscreen listener (simplified) ---\n  useEffect(() => {\n    const handler = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n      document.body.classList.toggle(\n        \"lava-lamp-fullscreen\",\n        !!document.fullscreenElement\n      );\n\n      // Also resize canvas (only if present)\n      const canvas = canvasRef.current;\n      if (canvas) {\n        const w = window.innerWidth,\n          h = window.innerHeight;\n        canvas.width = w;\n        canvas.height = h;\n        sizeRef.current = { w, h };\n        imageRef.current = null;\n        particlesRef.current && clampAllToBounds(particlesRef.current, w, h);\n      }\n    };\n    document.addEventListener(\"fullscreenchange\", handler);\n    return () => {\n      document.removeEventListener(\"fullscreenchange\", handler);\n      document.body.classList.remove(\"lava-lamp-fullscreen\");\n    };\n  }, []);\n\n  const toggleFullscreen = useCallback(() => {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen?.().catch(() => {});\n    } else {\n      document.exitFullscreen?.();\n    }\n  }, []);\n\n  // --- Menu outside click handler (short) ---\n  useEffect(() => {\n    if (!menuOpen) return;\n    const handler = (e: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node))\n        setMenuOpen(false);\n    };\n    document.addEventListener(\"mousedown\", handler);\n    return () => document.removeEventListener(\"mousedown\", handler);\n  }, [menuOpen]);\n\n  const [volume, setVolume] = useState(1.0);\n  useEffect(() => {\n    gameMusic.volume = volume;\n  }, [volume, gameMusic]);\n\n  const [nowPlaying, setNowPlaying] = useState<{\n    song: string;\n    artist: string;\n    album: string;\n    isAirbreak: boolean;\n  } | null>(null);\n  const [nowPlayingExpanded, setNowPlayingExpanded] = useState(true);\n\n  // --- AudioSource change handler ---\n  const isFirstRender = useRef(true);\n  useEffect(() => {\n    if (isFirstRender.current) {\n      isFirstRender.current = false;\n      return;\n    }\n    const config = AUDIO_SOURCE_CONFIG[audioSource];\n    const wasPlaying = gameMusic.isPlaying();\n    if (wasPlaying) gameMusic.pause();\n    gameMusic.src = config.url;\n    gameMusic.load();\n    if (wasPlaying) {\n      const onPlay = () => {\n        gameMusic.play().catch(() => {});\n        gameMusic.removeEventListener(\"canplaythrough\", onPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onPlay, { once: true });\n    }\n  }, [audioSource, gameMusic]);\n\n  // --- KEXP Now Playing Poll ---\n  useEffect(() => {\n    if (!hasStarted || audioSource !== AUDIO_SOURCES.KEXP) {\n      setNowPlaying(null);\n      return;\n    }\n    let timer: number;\n    const fetchNowPlaying = async () => {\n      try {\n        const data = await (\n          await fetch(\"https://api.kexp.org/v2/plays/?limit=5\")\n        ).json();\n        const play = data.results?.[0];\n        if (!play) return;\n        if (play.play_type === \"airbreak\")\n          setNowPlaying({\n            song: \"airbreak\",\n            artist: \"\",\n            album: \"\",\n            isAirbreak: true,\n          });\n        else if (play.play_type === \"trackplay\")\n          setNowPlaying({\n            song: (play.song || \"unknown track\").toLowerCase(),\n            artist: (play.artist || \"unknown artist\").toLowerCase(),\n            album: (play.album || \"unknown album\").toLowerCase(),\n            isAirbreak: false,\n          });\n      } catch {}\n    };\n    fetchNowPlaying();\n    timer = window.setInterval(fetchNowPlaying, 5000);\n    return () => clearInterval(timer);\n  }, [hasStarted, audioSource]);\n\n  // --- Lava Colors/Heat LUT ---\n  const [lavaLowColor, setLavaLowColor] = useState(DEFAULT_LOW);\n  const [lavaHighColor, setLavaHighColor] = useState(DEFAULT_HIGH);\n  const [rainbowMode, setRainbowMode] = useState(false);\n  const heatLutRef = useRef<Uint32Array>(\n    buildHeatLut256(DEFAULT_LOW, DEFAULT_HIGH)\n  );\n  const lavaLowColorRef = useRef(DEFAULT_LOW);\n  const lavaHighColorRef = useRef(DEFAULT_HIGH);\n\n  useEffect(() => {\n    lavaLowColorRef.current = lavaLowColor;\n    lavaHighColorRef.current = lavaHighColor;\n    heatLutRef.current = buildHeatLut256(lavaLowColor, lavaHighColor);\n  }, [lavaLowColor, lavaHighColor]);\n\n  // --- Canvas initial mount setup (context, size) ---\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const w = window.innerWidth,\n      h = window.innerHeight;\n    sizeRef.current = { w, h };\n    canvas.width = w;\n    canvas.height = h;\n    ctxRef.current = canvas.getContext(\"2d\");\n    imageRef.current = null;\n  }, []);\n\n  // --- Particles initialization ---\n  const initializeParticlesOnce = useCallback(() => {\n    const { w, h } = sizeRef.current;\n    if (particleCountRef.current === null)\n      particleCountRef.current = computeParticleCount(w, h);\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n    ensureGrid(gridRef, w, h, count, SIM.COHESION_RADIUS);\n  }, []);\n\n  // --- Music position saving ---\n  const saveMusicPosition = useCallback(() => {\n    writeSavedMusicTimeSeconds(gameMusic.currentTime ?? 0);\n  }, [gameMusic]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n    const id = window.setInterval(saveMusicPosition, 1000);\n    const onPageHide = () => saveMusicPosition();\n    const onVisibility = () => {\n      if (document.visibilityState === \"hidden\") saveMusicPosition();\n    };\n    window.addEventListener(\"pagehide\", onPageHide);\n    document.addEventListener(\"visibilitychange\", onVisibility);\n    return () => {\n      clearInterval(id);\n      window.removeEventListener(\"pagehide\", onPageHide);\n      document.removeEventListener(\"visibilitychange\", onVisibility);\n    };\n  }, [hasStarted, saveMusicPosition]);\n\n  // --- Global cleanup on unmount ---\n  useEffect(\n    () => () => {\n      saveMusicPosition();\n      gameMusic.pause();\n      gameMusic.volume = 0;\n      gameMusic.reset();\n      clickSound.pause();\n      clickSound.volume = 0;\n      clickSound.reset();\n      amplitudeAnalyzerRef.current?.disconnect();\n      amplitudeAnalyzerRef.current = null;\n    },\n    [gameMusic, clickSound, saveMusicPosition]\n  );\n\n  // --- Core animation/update ---\n  const updateOnce = useCallback(() => {\n    const g = gridRef.current,\n      { w, h } = sizeRef.current;\n    if (!g) return;\n    stepSimulationOnePairPass(\n      particlesRef.current,\n      w,\n      h,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current,\n      speedRef.current,\n      g,\n      pointerCoolingRef.current\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current,\n      ctx = ctxRef.current;\n    if (!canvas || !ctx) return;\n    renderFrame(\n      ctx,\n      canvas,\n      particlesRef.current,\n      imageRef,\n      heatLutRef.current\n    );\n  }, []);\n\n  const clockRef = useRef<{ last: number; acc: number }>({ last: 0, acc: 0 });\n  const animate = useCallback(\n    (now: number) => {\n      const clock = clockRef.current;\n      if (!clock.last) clock.last = now;\n      let delta = now - clock.last;\n      clock.last = now;\n      clock.acc += Math.min(250, Math.max(0, delta));\n      let steps = 0;\n      while (clock.acc >= FIXED_MS && steps < MAX_CATCHUP_STEPS) {\n        updateOnce();\n        clock.acc -= FIXED_MS;\n        steps++;\n      }\n      if (clock.acc >= FIXED_MS) clock.acc = 0;\n\n      // Waveform animation, update every 5 frames\n      if (amplitudeAnalyzerRef.current) {\n        currentWaveformRef.current =\n          amplitudeAnalyzerRef.current.getWaveformBars(10);\n        if (++waveformUpdateCounterRef.current >= 5) {\n          setDisplayWaveform(currentWaveformRef.current);\n          waveformUpdateCounterRef.current = 0;\n        }\n      }\n      draw();\n      rafRef.current = requestAnimationFrame(animate);\n    },\n    [draw, updateOnce]\n  );\n\n  // --- Rainbow mode: drift hues over time ---\n  const rainbowLowHueRef = useRef(0),\n    rainbowHighHueRef = useRef(0);\n  const prevRainbow = useRef(false);\n  useEffect(() => {\n    if (rainbowMode && !prevRainbow.current) {\n      rainbowLowHueRef.current = hexToHue(lavaLowColor);\n      rainbowHighHueRef.current = hexToHue(lavaHighColor);\n    }\n    prevRainbow.current = rainbowMode;\n  }, [rainbowMode, lavaLowColor, lavaHighColor]);\n  useEffect(() => {\n    if (!rainbowMode) return;\n    let id: number,\n      lastT = performance.now();\n    const tick = (now: number) => {\n      const dt = now - lastT;\n      lastT = now;\n      const s = speedRef.current,\n        norm = dt / 16.67,\n        base = 0.02;\n      rainbowLowHueRef.current =\n        (rainbowLowHueRef.current + base * s * norm) % 360;\n      rainbowHighHueRef.current =\n        (rainbowHighHueRef.current + base * s * norm * 1.3) % 360;\n      setLavaLowColor(hslToHex(rainbowLowHueRef.current, 1, 0.5));\n      setLavaHighColor(hslToHex(rainbowHighHueRef.current, 1, 0.5));\n      id = requestAnimationFrame(tick);\n    };\n    id = requestAnimationFrame(tick);\n    return () => cancelAnimationFrame(id);\n  }, [rainbowMode]);\n\n  // --- Pointer handling (all-in-one) ---\n  useEffect(() => {\n    const c = canvasRef.current;\n    if (!c) return;\n    const toLocal = (e: PointerEvent) => {\n      const rect = c.getBoundingClientRect();\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n    };\n    const onDown = (e: PointerEvent) => {\n      pointerDownRef.current = true;\n      pointerCoolingRef.current =\n        e.button === 2 || (e.button === 0 && e.ctrlKey);\n      pointerPosRef.current = toLocal(e);\n    };\n    const onMove = (e: PointerEvent) => (pointerPosRef.current = toLocal(e));\n    const onUp = () => {\n      pointerDownRef.current = false;\n      pointerCoolingRef.current = false;\n    };\n    c.addEventListener(\"pointerdown\", onDown);\n    c.addEventListener(\"contextmenu\", (e) => e.preventDefault());\n    window.addEventListener(\"pointermove\", onMove);\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"pointercancel\", onUp);\n    return () => {\n      c.removeEventListener(\"pointerdown\", onDown);\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"pointercancel\", onUp);\n    };\n  }, []);\n\n  // --- Utility: play click and resume saved music time ---\n  const playClick = useCallback(() => {\n    try {\n      clickSound.volume = 1;\n      clickSound.currentTime = 0;\n      clickSound.reset();\n      clickSound.play();\n    } catch {}\n  }, [clickSound]);\n\n  const resumeMusicFromSavedTime = useCallback(() => {\n    const t = readSavedMusicTimeSeconds();\n    try {\n      const dur = (gameMusic as any).duration;\n      gameMusic.currentTime =\n        typeof dur === \"number\" && Number.isFinite(dur) && dur > 0\n          ? t % dur\n          : t;\n    } catch {}\n  }, [gameMusic]);\n\n  // --- Lamp startup: ensures only start+init triggers once, handles audio ---\n  const startLamp = useCallback(async () => {\n    playClick();\n    if (!hasStarted) {\n      setHasStarted(true);\n      initializeParticlesOnce();\n      clockRef.current = { last: 0, acc: 0 };\n      requestAnimationFrame(() => draw());\n      rafRef.current = requestAnimationFrame(animate);\n\n      // AudioAmplitudeAnalyzer\n      if (!amplitudeAnalyzerRef.current) {\n        const analyzer = new AudioAmplitudeAnalyzer();\n        if (analyzer.connect(gameMusic))\n          amplitudeAnalyzerRef.current = analyzer;\n      }\n    }\n    amplitudeAnalyzerRef.current?.resume();\n    if (audioSource !== AUDIO_SOURCES.KEXP) resumeMusicFromSavedTime();\n    gameMusic.volume = 1.0;\n    if (gameMusic.readyState < 3) {\n      gameMusic.load();\n      const onCanPlay = async () => {\n        try {\n          await gameMusic.play();\n        } catch {}\n        gameMusic.removeEventListener(\"canplaythrough\", onCanPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onCanPlay, { once: true });\n    } else {\n      try {\n        await gameMusic.play();\n      } catch {}\n    }\n  }, [\n    animate,\n    audioSource,\n    draw,\n    gameMusic,\n    hasStarted,\n    initializeParticlesOnce,\n    playClick,\n    resumeMusicFromSavedTime,\n  ]);\n\n  // --- Render ---\n  const lastSpeedIdx = SPEED.STEPS - 1;\n  const initialCanvasSize = useMemo(\n    () => ({\n      w: window.innerWidth,\n      h: window.innerHeight,\n    }),\n    []\n  );\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n      />\n      <NowPlayingWidget\n        nowPlaying={nowPlaying}\n        displayWaveform={displayWaveform}\n        expanded={nowPlayingExpanded}\n        onToggle={() => setNowPlayingExpanded((v) => !v)}\n      />\n      {!hasStarted ? (\n        <div className=\"lava-lamp-start-overlay\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-start\"\n            onClick={startLamp}\n            aria-label=\"Start lava lamp radio\"\n          >\n            <img src={powerIcon} alt=\"Power\" className=\"lava-lamp-start-icon\" />\n          </button>\n        </div>\n      ) : (\n        <div className=\"lava-lamp-controls\" ref={menuRef}>\n          <button\n            type=\"button\"\n            className=\"lava-lamp-menu-toggle\"\n            onClick={toggleMenu}\n            aria-label={menuOpen ? \"Hide menu\" : \"Show menu\"}\n            aria-pressed={menuOpen}\n          >\n            {menuOpen ? \"✕\" : \"☰\"}\n          </button>\n          {menuOpen && (\n            <div className=\"lava-lamp-menu\">\n              {/* Speed */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    speed: {speedIdx}\n                  </div>\n                </div>\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={lastSpeedIdx}\n                    step={1}\n                    value={speedIdx}\n                    onChange={(e) =>\n                      setSpeedIdx(clampInt(+e.target.value, 0, lastSpeedIdx))\n                    }\n                    aria-label=\"Simulation speed\"\n                  />\n                </div>\n              </div>\n              {/* Volume */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    volume: {Math.round(volume * 100)}%\n                  </div>\n                </div>\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={1}\n                    step={0.01}\n                    value={volume}\n                    onChange={(e) => setVolume(+e.target.value)}\n                    aria-label=\"Music volume\"\n                  />\n                </div>\n              </div>\n              {/* Audio Source */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">audio source</div>\n                </div>\n                <div className=\"lava-lamp-slider-wrap\">\n                  <select\n                    className=\"lava-lamp-slider\"\n                    value={audioSource}\n                    onChange={(e) =>\n                      setAudioSource(e.target.value as AudioSource)\n                    }\n                    aria-label=\"Audio source\"\n                  >\n                    {Object.entries(AUDIO_SOURCE_CONFIG).map(([k, c]) => (\n                      <option key={k} value={k}>\n                        {c.label}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n              {/* Lava colors */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">lava colors</div>\n                </div>\n                {/* Rainbow mode toggle */}\n                <div\n                  className=\"lava-lamp-slider-wrap\"\n                  style={{ marginBottom: 12 }}\n                >\n                  <label\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: 8,\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      className=\"lava-lamp-checkbox\"\n                      checked={rainbowMode}\n                      onChange={(e) => setRainbowMode(e.target.checked)}\n                    />\n                    <span style={{ fontSize: 13, opacity: 0.9 }}>\n                      rainbow drift mode\n                    </span>\n                  </label>\n                </div>\n                <div className=\"lava-lamp-color-row\">\n                  <label className=\"lava-lamp-color-label\">\n                    hot\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaHighColor}\n                      onChange={(e) => {\n                        setLavaHighColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava high color\"\n                    />\n                  </label>\n                  <label className=\"lava-lamp-color-label\">\n                    cool\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaLowColor}\n                      onChange={(e) => {\n                        setLavaLowColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava low color\"\n                    />\n                  </label>\n                  <button\n                    type=\"button\"\n                    className=\"lava-lamp-color-reset\"\n                    onClick={() => {\n                      setLavaLowColor(DEFAULT_LOW);\n                      setLavaHighColor(DEFAULT_HIGH);\n                      setRainbowMode(false);\n                    }}\n                    disabled={rainbowMode}\n                  >\n                    reset\n                  </button>\n                </div>\n              </div>\n              {/* Fullscreen */}\n              {!isMobile && (\n                <div className=\"lava-lamp-control-block\">\n                  <div className=\"lava-lamp-slider-wrap\">\n                    <label\n                      style={{\n                        display: \"flex\",\n                        alignItems: \"center\",\n                        gap: 8,\n                        cursor: \"pointer\",\n                      }}\n                    >\n                      <input\n                        type=\"checkbox\"\n                        className=\"lava-lamp-checkbox\"\n                        checked={isFullscreen}\n                        onChange={toggleFullscreen}\n                      />\n                      <span style={{ fontSize: 13, opacity: 0.9 }}>\n                        fullscreen mode\n                      </span>\n                    </label>\n                  </div>\n                </div>\n              )}\n              {/* Power off */}\n              <div className=\"lava-lamp-control-block\">\n                <button\n                  type=\"button\"\n                  className=\"lava-lamp-power-off\"\n                  onClick={() => window.location.reload()}\n                  aria-label=\"Power off\"\n                >\n                  <img\n                    src={powerIcon}\n                    alt=\"Power off\"\n                    className=\"lava-lamp-power-off-icon\"\n                  />\n                  <span>power off</span>\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * LocalStorage utilities for persisting state\n */\n\nimport { MUSIC_TIME_KEY } from \"./constants.ts\";\n\nexport function readSavedMusicTimeSeconds(): number {\n  try {\n    const raw = localStorage.getItem(MUSIC_TIME_KEY);\n    if (!raw) return 0;\n    const v = Number(raw);\n    return Number.isFinite(v) && v >= 0 ? v : 0;\n  } catch {\n    return 0;\n  }\n}\n\nexport function writeSavedMusicTimeSeconds(seconds: number): void {\n  try {\n    if (!Number.isFinite(seconds) || seconds < 0) return;\n    localStorage.setItem(MUSIC_TIME_KEY, String(seconds));\n  } catch {\n    // ignore\n  }\n}\n","export class PersonalAudio extends Audio {\n  constructor(src, loop=false) {\n    super(src);\n    this.loop = loop;\n    this.crossOrigin = \"anonymous\";\n  };\n\n  isPlayingSrc = (audioSrc) => {\n    return this.src?.includes(audioSrc)\n        && this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  isPlaying = () => {\n    return this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  timeLeft = () => this.duration - this.currentTime;\n\n  reset = () => {\n    this.pause();\n    this.currentTime = 0;\n  };\n}"],"names":["AudioAmplitudeAnalyzer","constructor","audioContext","analyser","dataArray","connected","connect","audioElement","this","AudioContext","createAnalyser","fftSize","smoothingTimeConstant","createMediaElementSource","destination","Uint8Array","frequencyBinCount","err","console","warn","getAmplitude","getByteTimeDomainData","sum","i","length","normalized","rms","Math","sqrt","min","getWaveformBars","barCount","Array","fill","bars","step","floor","index","abs","push","resume","state","catch","disconnect","close","isConnected","NowPlayingWidget","_ref","nowPlaying","displayWaveform","expanded","onToggle","nowPlayingSongRef","useRef","nowPlayingArtistRef","nowPlayingAlbumRef","songOverflowing","setSongOverflowing","useState","artistOverflowing","setArtistOverflowing","albumOverflowing","setAlbumOverflowing","useEffect","handleOverflowCheck","elementRef","setOverflowing","current","wrapper","querySelector","containerWidth","clientWidth","isOverflowing","scrollWidth","duration","delayFraction","style","setProperty","concat","classList","add","remove","checkAllOverflow","window","addEventListener","removeEventListener","_jsxs","className","children","_jsx","type","onClick","isAirbreak","map","height","ref","song","_Fragment","artist","album","hexToRgb","hex","h","slice","r","hexCharToNibble","g","b","c","code","charCodeAt","hslToHex","s","l","a","f","n","k","x","max","val","round","toString","hex2","hexToHue","rf","gf","bf","delta","hue","buildHeatLut256","lowHex","highHex","lo","hi","lut","Uint32Array","r0","r1","g0","g1","b0","b1","t","detectMobile","userAgent","navigator","vendor","opera","isMobileUA","test","hasTouch","maxTouchPoints","isSmallScreen","innerWidth","isMobile","AUDIO_SOURCES","REDWOOD","KEXP","DEFAULT_HIGH","DEFAULT_LOW","SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","PARTICLES_PER_PIXEL","MAX_PARTICLES","SPEED","MIN","MAX","DEFAULT","STEPS","FIXED_MS","MAX_CATCHUP_STEPS","MUSIC_TIME_KEY","gridIndex","cx","cy","cols","clamp01","v","randInCircle","radius","angle","random","PI","cos","y","sin","bounceInBounds","p","width","vx","vy","clampAllToBounds","particles","applyBuoyancyAndGravity","dt","buoyancy","heat","applyFriction","pow","integrate","applyPointerHeat","pointerPos","cooling","arguments","undefined","dx","dy","d2","intensity","heatChange","applyCohesionImpulse","p1","p2","d","force","invD","fx","fy","applyHeatConduction","conduction","applyBottomHeatOrAirCooling","neighborCount","distanceFromBottom","airExposure","BLACK_RGBA","fillPixelBlockFast","data32","px","w","rgba","ymax","xmax","yy","idx","xx","renderFrame","ctx","canvas","imageRef","heatLut256","imageData","img","createImageData","ensureImageData","pixelSize","area","adaptivePixelSize","computePixelSize","canvasWidth","canvasHeight","threshold","particleRadiusSquared","data","buffer","influenceSum","heatSum","influence","drawMetaballs","putImageData","indexToSpeed","steps","minPositive","targetMidSpeed","minLog","log","maxLog","exp","lerp","AUDIO_SOURCE_CONFIG","label","url","musicAudioNoise","LavaLamp","canvasRef","ctxRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","gridRef","sizeRef","audioSource","setAudioSource","gameMusic","useMemo","audio","PersonalAudio","preload","clickSound","clickAudioNoise","hasStarted","setHasStarted","pointerDownRef","pointerCoolingRef","pointerPosRef","amplitudeAnalyzerRef","currentWaveformRef","setDisplayWaveform","waveformUpdateCounterRef","defaultSpeedIdx","speed","last","best","bestErr","Infinity","target","speedToNearestIndex","speedIdx","setSpeedIdx","speedRef","menuOpen","setMenuOpen","toggleMenu","useCallback","menuRef","isFullscreen","setIsFullscreen","handler","document","fullscreenElement","body","toggle","innerHeight","toggleFullscreen","_document$exitFullscr","_document","_document$documentEle","_document$documentEle2","exitFullscreen","call","documentElement","requestFullscreen","e","contains","volume","setVolume","setNowPlaying","nowPlayingExpanded","setNowPlayingExpanded","isFirstRender","config","wasPlaying","isPlaying","pause","src","load","onPlay","play","once","timer","fetchNowPlaying","async","_data$results","fetch","json","results","play_type","toLowerCase","_unused","setInterval","clearInterval","lavaLowColor","setLavaLowColor","lavaHighColor","setLavaHighColor","rainbowMode","setRainbowMode","heatLutRef","lavaLowColorRef","lavaHighColorRef","getContext","initializeParticlesOnce","desired","computeParticleCount","count","particlesPerClump","centerX","centerY","clumpHeat","j","offset","createParticles","cellSize","ceil","rows","cells","next","heads","Int32Array","ensureGrid","saveMusicPosition","_gameMusic$currentTim","seconds","Number","isFinite","localStorage","setItem","String","_unused2","writeSavedMusicTimeSeconds","currentTime","id","onPageHide","onVisibility","visibilityState","_amplitudeAnalyzerRef","reset","updateOnce","pointerDown","neighborCounts","timeScale","grid","pointerCooling","invCell","cell","r2","x0","x1","y0","y1","ny","nx","stepSimulationOnePairPass","draw","clockRef","acc","animate","now","clock","requestAnimationFrame","rainbowLowHueRef","rainbowHighHueRef","prevRainbow","lastT","performance","tick","norm","cancelAnimationFrame","toLocal","rect","getBoundingClientRect","clientX","left","clientY","top","onDown","button","ctrlKey","onMove","onUp","preventDefault","playClick","resumeMusicFromSavedTime","raw","getItem","readSavedMusicTimeSeconds","dur","_unused3","startLamp","_amplitudeAnalyzerRef2","analyzer","readyState","onCanPlay","_unused4","_unused5","lastSpeedIdx","initialCanvasSize","value","onChange","Object","entries","marginBottom","display","alignItems","gap","cursor","checked","fontSize","opacity","disabled","location","reload","powerIcon","alt","Audio","loop","super","isPlayingSrc","audioSrc","_this$src","includes","paused","ended","timeLeft","crossOrigin"],"sourceRoot":""}