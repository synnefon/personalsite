{"version":3,"file":"static/js/399.88bc92b2.chunk.js","mappings":"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","sources":["lava_lamp/LavaLamp.tsx"],"sourcesContent":["import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\n// --- Types ---\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  heat: number; // [0..1]\n}\n\ntype Vec2 = { x: number; y: number };\n\n// --- Constants ---\nconst SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\nconst RENDER = {\n  PARTICLE_RADIUS: 10,\n  PIXEL_SIZE: 6,\n  THRESHOLD: 0.8,\n} as const;\n\nconst CLUMPS = {\n  COUNT: 15,\n  RADIUS: 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n// Baseline density: preserves \"look\" across screens, computed once per page load.\nconst BASELINE = {\n  WIDTH: 1920,\n  HEIGHT: 1080,\n  PARTICLES: 1200,\n} as const;\n\nfunction computeParticleCount(width: number, height: number): number {\n  const baselineArea = BASELINE.WIDTH * BASELINE.HEIGHT;\n  const currentArea = width * height;\n\n  const density = BASELINE.PARTICLES / baselineArea;\n  const scaled = Math.round(currentArea * density);\n\n  // Keep sane bounds: physics/render cost grows quickly.\n  return Math.max(200, Math.min(2000, scaled));\n}\n\n// --- Utils ---\nfunction clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nfunction hypot2(dx: number, dy: number): number {\n  return Math.hypot(dx, dy);\n}\n\nfunction randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\nfunction setCanvasToWindow(canvas: HTMLCanvasElement) {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n}\n\nfunction bounceInBounds(p: Particle, width: number, height: number) {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nfunction clampAllToBounds(particles: Particle[], width: number, height: number) {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\n// --- Init ---\nfunction createParticles(width: number, height: number, count: number): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// --- Physics (Option 2: single pair-pass on post-move positions) ---\nfunction stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array\n) {\n  const n = particles.length;\n\n  // Cache constants locally (hot loop)\n  const gravity = SIM.GRAVITY;\n  const buoyancyK = SIM.BUOYANCY;\n  const friction = SIM.FRICTION;\n\n  const mouseR = SIM.MOUSE_HEAT_RADIUS;\n  const mouseRInv = 1 / mouseR;\n\n  const heatRate = SIM.HEAT_RATE;\n  const coolRate = SIM.COOL_RATE;\n\n  const heatSrcDist = SIM.HEAT_SOURCE_DISTANCE;\n  const heatSrcDistInv = 1 / heatSrcDist;\n\n  const cohR = SIM.COHESION_RADIUS;\n  const cohRInv = 1 / cohR;\n  const cohStrength = SIM.COHESION_STRENGTH;\n\n  const conductionK = SIM.HEAT_CONDUCTION;\n\n  const pointerX = pointerPos.x;\n  const pointerY = pointerPos.y;\n\n  // 1) External forces + integrate + pointer heat + initial bounce.\n  for (let i = 0; i < n; i++) {\n    const p = particles[i];\n\n    // gravity + buoyancy\n    const buoyancy = p.heat * p.heat * buoyancyK;\n    p.vy += gravity - buoyancy;\n\n    // friction\n    p.vx *= friction;\n    p.vy *= friction;\n\n    // integrate (semi-implicit: v updated before x)\n    p.x += p.vx;\n    p.y += p.vy;\n\n    // pointer heat (no allocations)\n    if (pointerDown) {\n      const dx = p.x - pointerX;\n      const dy = p.y - pointerY;\n      const d = hypot2(dx, dy);\n      if (d < mouseR) {\n        const intensity = 1 - d * mouseRInv;\n        p.heat += heatRate * 2 * intensity;\n      }\n    }\n\n    neighborCounts[i] = 0;\n\n    // keep roughly in-bounds before pair forces\n    bounceInBounds(p, width, height);\n  }\n\n  // 2) ONE pair loop: neighborCounts + cohesion + conduction (post-move positions)\n  for (let i = 0; i < n; i++) {\n    const p1 = particles[i];\n    for (let j = i + 1; j < n; j++) {\n      const p2 = particles[j];\n\n      const dx = p2.x - p1.x;\n      const dy = p2.y - p1.y;\n      const d = hypot2(dx, dy);\n\n      if (d > 0 && d < cohR) {\n        neighborCounts[i]++;\n        neighborCounts[j]++;\n\n        // cohesion\n        const force = cohStrength * (1 - d * cohRInv);\n        const invD = 1 / d;\n        const fx = dx * invD * force;\n        const fy = dy * invD * force;\n\n        p1.vx += fx;\n        p1.vy += fy;\n        p2.vx -= fx;\n        p2.vy -= fy;\n\n        // conduction\n        const heatDiff = p1.heat - p2.heat;\n        const conduction = heatDiff * conductionK;\n        p1.heat -= conduction;\n        p2.heat += conduction;\n      }\n    }\n  }\n\n  // 3) Heat source + cooling (now using post-move neighborCounts)\n  for (let i = 0; i < n; i++) {\n    const p = particles[i];\n\n    const distanceFromBottom = height - p.y;\n    if (distanceFromBottom < heatSrcDist) {\n      const intensity = 1 - distanceFromBottom * heatSrcDistInv;\n      p.heat += heatRate * intensity;\n    } else {\n      const maxNeighbors = 8;\n      const neighbors =\n        neighborCounts[i] < maxNeighbors ? neighborCounts[i] : maxNeighbors;\n      const airExposure = 1 - neighbors / maxNeighbors;\n      p.heat -= coolRate * (0.2 + airExposure * 0.8);\n    }\n\n    p.heat = clamp01(p.heat);\n  }\n\n  // 4) Re-clamp after cohesion so pair forces can't push out-of-bounds\n  clampAllToBounds(particles, width, height);\n}\n\n// --- Render helpers ---\nfunction ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\n// red → yellow\nfunction heatToRGB(heat: number): { r: number; g: number; b: number } {\n  const t = clamp01(heat);\n  return {\n    r: 255,\n    g: Math.round(50 + 205 * t),\n    b: 0,\n  };\n}\n\nfunction setPixelBlock(\n  data: Uint8ClampedArray,\n  canvasWidth: number,\n  canvasHeight: number,\n  x: number,\n  y: number,\n  size: number,\n  r: number,\n  g: number,\n  b: number\n) {\n  for (let py = 0; py < size; py++) {\n    const yy = y + py;\n    if (yy >= canvasHeight) continue;\n\n    const rowBase = yy * canvasWidth * 4;\n    for (let px = 0; px < size; px++) {\n      const xx = x + px;\n      if (xx >= canvasWidth) continue;\n\n      const idx = rowBase + xx * 4;\n      data[idx + 0] = r;\n      data[idx + 1] = g;\n      data[idx + 2] = b;\n      data[idx + 3] = 255;\n    }\n  }\n}\n\nfunction influenceAtPoint(p: Particle, x: number, y: number, r2: number): number {\n  const dx = x - p.x;\n  const dy = y - p.y;\n  const distSq = dx * dx + dy * dy;\n  return r2 / (distSq + 1);\n}\n\nfunction drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number\n) {\n  const data = imageData.data;\n  data.fill(0);\n\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      for (let i = 0; i < particles.length; i++) {\n        const p = particles[i];\n        const influence = influenceAtPoint(p, x, y, r2);\n        influenceSum += influence;\n        heatWeightedSum += influence * p.heat;\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const { r, g, b } = heatToRGB(heat);\n\n      setPixelBlock(data, canvasWidth, canvasHeight, x, y, pixelSize, r, g, b);\n    }\n  }\n}\n\nfunction renderFrame(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>\n) {\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n\n  ctx.fillStyle = \"#000\";\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n  drawMetaballs(imageData, particles, canvas.width, canvas.height);\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// --- Component ---\nexport default function LavaLamp(): ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n\n  // reuse neighborCounts buffer (no per-frame alloc)\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n\n  // particle count computed ONCE per load; never recomputed on resize\n  const particleCountRef = useRef<number | null>(null);\n\n  const [running, setRunning] = useState(true);\n\n  const pointerDownRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  const initializeParticlesOnce = useCallback(() => {\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n\n    if (particleCountRef.current === null) {\n      particleCountRef.current = computeParticleCount(w, h);\n    }\n\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n  }, []);\n\n  const update = useCallback(() => {\n    const particles = particlesRef.current;\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n\n    if (neighborCountsRef.current.length !== particles.length) {\n      neighborCountsRef.current = new Uint16Array(particles.length);\n    }\n\n    stepSimulationOnePairPass(\n      particles,\n      width,\n      height,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    renderFrame(canvas, particlesRef.current, imageRef);\n  }, []);\n\n  const animate = useCallback(() => {\n    if (!running) return;\n    update();\n    draw();\n    rafRef.current = requestAnimationFrame(animate);\n  }, [running, update, draw]);\n\n  // --- Mount/init (once) ---\n  useEffect(() => {\n    initializeParticlesOnce();\n  }, [initializeParticlesOnce]);\n\n  // --- Start/stop loop ---\n  useEffect(() => {\n    if (!running) {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n      return;\n    }\n\n    rafRef.current = requestAnimationFrame(animate);\n    return () => {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n  }, [running, animate]);\n\n  // --- Resize (canvas only; do NOT re-init particles) ---\n  useEffect(() => {\n    const handleResize = () => {\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n      setCanvasToWindow(canvas);\n      imageRef.current = null; // force ImageData resize ONLY\n    };\n\n    handleResize();\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  // --- Pointer handlers ---\n  const setPointerPos = useCallback((x: number, y: number) => {\n    pointerPosRef.current = { x, y };\n  }, []);\n\n  const onMouseDown = useCallback(\n    (e: React.MouseEvent<HTMLCanvasElement>) => {\n      pointerDownRef.current = true;\n      setPointerPos(e.clientX, e.clientY);\n    },\n    [setPointerPos]\n  );\n\n  const onMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLCanvasElement>) => {\n      setPointerPos(e.clientX, e.clientY);\n    },\n    [setPointerPos]\n  );\n\n  const onMouseUpOrLeave = useCallback(() => {\n    pointerDownRef.current = false;\n  }, []);\n\n  const onTouchStart = useCallback(\n    (e: React.TouchEvent<HTMLCanvasElement>) => {\n      const t = e.touches[0];\n      if (!t) return;\n      pointerDownRef.current = true;\n      setPointerPos(t.clientX, t.clientY);\n    },\n    [setPointerPos]\n  );\n\n  const onTouchMove = useCallback(\n    (e: React.TouchEvent<HTMLCanvasElement>) => {\n      const t = e.touches[0];\n      if (!t) return;\n      setPointerPos(t.clientX, t.clientY);\n    },\n    [setPointerPos]\n  );\n\n  const onTouchEnd = useCallback(() => {\n    pointerDownRef.current = false;\n  }, []);\n\n  // --- Controls ---\n  const toggleRunning = useCallback(() => setRunning((p) => !p), []);\n  const initialCanvasSize = useMemo(\n    () => ({ w: window.innerWidth, h: window.innerHeight }),\n    []\n  );\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n        onMouseDown={onMouseDown}\n        onMouseMove={onMouseMove}\n        onMouseUp={onMouseUpOrLeave}\n        onMouseLeave={onMouseUpOrLeave}\n        onTouchStart={onTouchStart}\n        onTouchMove={onTouchMove}\n        onTouchEnd={onTouchEnd}\n      />\n      <div className=\"lava-lamp-controls\">\n        <button className=\"lava-lamp-button\" onClick={toggleRunning}>\n          {running ? \"⏸\" : \"▶\"}\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":["SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","PIXEL_SIZE","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","BASELINE","WIDTH","HEIGHT","PARTICLES","clamp01","v","hypot2","dx","dy","Math","hypot","randInCircle","radius","angle","random","PI","r","x","cos","y","sin","bounceInBounds","p","width","height","vx","vy","stepSimulationOnePairPass","particles","pointerDown","pointerPos","neighborCounts","n","length","gravity","buoyancyK","friction","mouseR","mouseRInv","heatRate","coolRate","heatSrcDist","heatSrcDistInv","cohR","cohRInv","cohStrength","conductionK","pointerX","pointerY","i","buoyancy","heat","d","intensity","p1","j","p2","force","invD","fx","fy","conduction","distanceFromBottom","maxNeighbors","airExposure","clampAllToBounds","heatToRGB","t","g","round","b","setPixelBlock","data","canvasWidth","canvasHeight","size","py","yy","rowBase","px","xx","idx","influenceAtPoint","r2","renderFrame","canvas","imageRef","ctx","getContext","fillStyle","fillRect","imageData","img","current","createImageData","ensureImageData","fill","pixelSize","threshold","influenceSum","heatWeightedSum","influence","drawMetaballs","putImageData","LavaLamp","canvasRef","useRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","running","setRunning","useState","pointerDownRef","pointerPosRef","initializeParticlesOnce","useCallback","w","window","innerWidth","h","innerHeight","baselineArea","currentArea","density","scaled","max","min","computeParticleCount","count","particlesPerClump","floor","centerX","centerY","clumpHeat","offset","push","createParticles","update","draw","animate","requestAnimationFrame","useEffect","cancelAnimationFrame","handleResize","setCanvasToWindow","addEventListener","removeEventListener","setPointerPos","onMouseDown","e","clientX","clientY","onMouseMove","onMouseUpOrLeave","onTouchStart","touches","onTouchMove","onTouchEnd","toggleRunning","initialCanvasSize","useMemo","_jsxs","className","children","_jsx","ref","onMouseUp","onMouseLeave","onClick"],"sourceRoot":""}