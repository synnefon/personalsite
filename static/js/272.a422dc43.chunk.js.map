{"version":3,"file":"static/js/272.a422dc43.chunk.js","mappings":"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","sources":["assets/lavaLamp/power.svg","util/audioAmplitude.ts","lava_lamp/LavaLamp.tsx","util/Audio.js"],"sourcesContent":["var _g;\nconst _excluded = [\"title\", \"titleId\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport * as React from \"react\";\nfunction SvgPower(_ref, svgRef) {\n  let {\n      title,\n      titleId\n    } = _ref,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    xmlnsXlink: \"http://www.w3.org/1999/xlink\",\n    id: \"Capa_1\",\n    x: \"0px\",\n    y: \"0px\",\n    viewBox: \"0 0 512.292 512.292\",\n    style: {\n      enableBackground: \"new 0 0 512.292 512.292\"\n    },\n    xmlSpace: \"preserve\",\n    width: 512,\n    height: 512,\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _g || (_g = /*#__PURE__*/React.createElement(\"g\", null, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M256.061,0L256.061,0c17.673,0,32,14.327,32,32v106.667c0,17.673-14.327,32-32,32l0,0c-17.673,0-32-14.327-32-32V32   C224.061,14.327,238.387,0,256.061,0z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M330.727,105.387L330.727,105.387c-0.157,10.742,5.259,20.8,14.315,26.581c80.432,49.143,105.796,154.185,56.652,234.616   S247.51,472.38,167.078,423.237S61.282,269.052,110.426,188.62c14.042-22.982,33.324-42.315,56.269-56.418   c9.211-5.781,14.773-15.92,14.699-26.795l0,0c0.049-17.673-14.238-32.039-31.911-32.088c-6.07-0.017-12.02,1.693-17.155,4.931   C22.233,146.634-11.58,291.318,56.803,401.412s213.067,143.907,323.161,75.524s143.907-213.067,75.524-323.161   c-19.035-30.645-44.879-56.489-75.524-75.524c-14.997-9.461-34.824-4.973-44.285,10.024   C332.447,93.397,330.731,99.33,330.727,105.387z\"\n  }))));\n}\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgPower);\nexport default __webpack_public_path__ + \"static/media/power.632cc1e66922cf3fa35d93370ea84178.svg\";\nexport { ForwardRef as ReactComponent };","/**\n * Audio amplitude analysis for visualizing music playback.\n * Uses Web Audio API's AnalyserNode to extract real-time amplitude data.\n */\n\nexport class AudioAmplitudeAnalyzer {\n  private audioContext: AudioContext | null = null;\n  private analyser: AnalyserNode | null = null;\n  private dataArray: Uint8Array | null = null;\n  private connected = false;\n\n  /**\n   * Initialize and connect the analyser to an audio element.\n   * Must be called after user interaction to avoid autoplay restrictions.\n   */\n  connect(audioElement: HTMLAudioElement): boolean {\n    if (this.connected) return true;\n\n    try {\n      this.audioContext = new AudioContext();\n      this.analyser = this.audioContext.createAnalyser();\n      this.analyser.fftSize = 256; // Small size for performance\n      this.analyser.smoothingTimeConstant = 0.95; // Higher = smoother (0-1 range)\n\n      const source = this.audioContext.createMediaElementSource(audioElement);\n      source.connect(this.analyser).connect(this.audioContext.destination);\n\n      this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n      this.connected = true;\n\n      return true;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Failed to connect analyser:', err);\n      return false;\n    }\n  }\n\n  /**\n   * Get current amplitude as a value between 0 and 1.\n   * Uses RMS (root mean square) for smooth, accurate amplitude measurement.\n   */\n  getAmplitude(): number {\n    if (!this.analyser || !this.dataArray) return 0;\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      // Calculate RMS amplitude\n      let sum = 0;\n      for (let i = 0; i < this.dataArray.length; i++) {\n        const normalized = (this.dataArray[i] - 128) / 128;\n        sum += normalized * normalized;\n      }\n\n      const rms = Math.sqrt(sum / this.dataArray.length);\n\n      // Boost the signal for better visualization (typical music is quiet)\n      return Math.min(1, rms * 3);\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading amplitude:', err);\n      return 0;\n    }\n  }\n\n  /**\n   * Get waveform values for multiple bars (e.g., 4 bars for visualization).\n   * Samples different points in the waveform and returns normalized values [0-1].\n   */\n  getWaveformBars(barCount: number): number[] {\n    if (!this.analyser || !this.dataArray) {\n      return new Array(barCount).fill(0);\n    }\n\n    try {\n      // Get time domain data (waveform)\n      this.analyser.getByteTimeDomainData(this.dataArray);\n\n      const bars: number[] = [];\n      const step = Math.floor(this.dataArray.length / barCount);\n\n      for (let i = 0; i < barCount; i++) {\n        const index = i * step;\n        // Convert byte value (0-255, centered at 128) to 0-1 range\n        const normalized = Math.abs((this.dataArray[index] - 128) / 128);\n        // Very gentle boost for smooth, calm visualization\n        bars.push(Math.min(1, normalized * 1.2));\n      }\n\n      return bars;\n    } catch (err) {\n      console.warn('[AudioAmplitude] Error reading waveform:', err);\n      return new Array(barCount).fill(0);\n    }\n  }\n\n  /**\n   * Resume audio context if suspended (required on some browsers after page load).\n   */\n  resume(): void {\n    if (this.audioContext && this.audioContext.state === 'suspended') {\n      this.audioContext.resume().catch((err) => {\n        console.warn('[AudioAmplitude] Failed to resume audio context:', err);\n      });\n    }\n  }\n\n  /**\n   * Clean up resources.\n   */\n  disconnect(): void {\n    if (this.audioContext) {\n      this.audioContext.close().catch(() => {\n        // ignore\n      });\n      this.audioContext = null;\n    }\n    this.analyser = null;\n    this.dataArray = null;\n    this.connected = false;\n  }\n\n  isConnected(): boolean {\n    return this.connected;\n  }\n}\n","import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\n// AIDEV-NOTE: TypeScript cannot import non-code assets directly unless custom module declarations exist; fallback to string for asset references\n// If using custom typings (e.g., for mp3/svg imports), ensure they exist in `src/types` or `@types`.\n\n// If not, import as string and ignore TS error (safest cross-project), or\n// declare the modules in a `.d.ts` file for the asset types.\n\n// @ts-expect-error - See AIDEV-NOTE above; ensure proper module declarations for assets or update your tsconfig to include them.\nimport musicAudioNoise from \"../assets/lavaLamp/guitar.mp3\";\n// @ts-expect-error - See AIDEV-NOTE above.\nimport clickAudioNoise from \"../assets/lavaLamp/click.mp3\";\n// @ts-expect-error - See AIDEV-NOTE above.\nimport powerIcon from \"../assets/lavaLamp/power.svg\";\nimport { PersonalAudio } from \"../util/Audio\";\nimport { AudioAmplitudeAnalyzer } from \"../util/audioAmplitude.ts\";\n\nconst detectMobile = (): boolean => {\n  const userAgent =\n    navigator.userAgent ||\n    navigator.vendor ||\n    (window as Window & { opera?: string }).opera ||\n    \"\";\n\n  // Check for mobile user agents\n  const mobileRegex =\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n  const isMobileUA = mobileRegex.test(userAgent);\n\n  // Check for touch capability\n  const hasTouch = \"ontouchstart\" in window || navigator.maxTouchPoints > 0;\n\n  // Check screen size (fallback)\n  const isSmallScreen = window.innerWidth <= 500;\n\n  // Consider it mobile if it has mobile UA OR (has touch AND small screen)\n  return isMobileUA || (hasTouch && isSmallScreen);\n};\n\nconst isMobile = detectMobile();\n\n// --- Audio sources ---\nconst AUDIO_SOURCES = {\n  REDWOOD: \"redwood\",\n  KEXP: \"kexp\",\n} as const;\n\ntype AudioSource = (typeof AUDIO_SOURCES)[keyof typeof AUDIO_SOURCES];\n\nconst AUDIO_SOURCE_CONFIG: Record<AudioSource, { label: string; url: string }> =\n  {\n    [AUDIO_SOURCES.REDWOOD]: {\n      label: \"redwood meditation\",\n      url: musicAudioNoise,\n    },\n    [AUDIO_SOURCES.KEXP]: {\n      label: \"kexp\",\n      url: \"https://kexp.streamguys1.com/kexp160.aac\",\n    },\n  };\n\n// --- Colors: keep state (for controlled inputs) + refs (fast access elsewhere) ---\nconst DEFAULT_HIGH = \"#ffdd00\";\nconst DEFAULT_LOW = \"#ff5500\";\n\n// --- Helper: Convert hex to RGB ---\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } {\n  const h = hex.trim().replace(\"#\", \"\");\n  if (h.length === 3) {\n    const r = parseInt(h[0] + h[0], 16);\n    const g = parseInt(h[1] + h[1], 16);\n    const b = parseInt(h[2] + h[2], 16);\n    return { r, g, b };\n  }\n  if (h.length === 6) {\n    const r = parseInt(h.slice(0, 2), 16);\n    const g = parseInt(h.slice(2, 4), 16);\n    const b = parseInt(h.slice(4, 6), 16);\n    return { r, g, b };\n  }\n  return { r: 255, g: 221, b: 0 };\n}\n\n// --- Helper: Convert HSL to hex ---\nfunction hslToHex(h: number, s: number, l: number): string {\n  const a = s * Math.min(l, 1 - l);\n  const f = (n: number) => {\n    const k = (n + h / 30) % 12;\n    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n    return Math.round(255 * color)\n      .toString(16)\n      .padStart(2, \"0\");\n  };\n  return `#${f(0)}${f(8)}${f(4)}`;\n}\n\n// --- Helper: Convert hex to hue ---\nfunction hexToHue(hex: string): number {\n  const rgb = hexToRgb(hex);\n  const r = rgb.r / 255;\n  const g = rgb.g / 255;\n  const b = rgb.b / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const delta = max - min;\n\n  if (delta === 0) return 0;\n\n  let hue = 0;\n  if (max === r) {\n    hue = ((g - b) / delta) % 6;\n  } else if (max === g) {\n    hue = (b - r) / delta + 2;\n  } else {\n    hue = (r - g) / delta + 4;\n  }\n\n  hue = Math.round(hue * 60);\n  if (hue < 0) hue += 360;\n\n  return hue;\n}\n\n// --- Types ---\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  heat: number; // [0..1]\n}\n\ntype Vec2 = { x: number; y: number };\n\ntype SpatialGrid = {\n  cellSize: number;\n  cols: number;\n  rows: number;\n  heads: Int32Array; // length cols*rows, head index or -1\n  next: Int32Array; // length particleCount, next index or -1\n};\n\n// --- Constants ---\nconst SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\nconst RENDER = {\n  PARTICLE_RADIUS: 10,\n  PIXEL_SIZE: 6,\n  THRESHOLD: 0.8,\n} as const;\n\nconst CLUMPS = {\n  COUNT: 15,\n  RADIUS: isMobile ? 30 : 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n// Pixel density: pixels per particle\nconst PIXELS_PER_PARTICLE = isMobile ? 1800 : 1500;\n\n// --- Speed control (indexed slider) ---\nconst SPEED = {\n  MIN: 0.0,\n  MAX: 5,\n  DEFAULT: 0.25,\n  STEPS: 10, // number of discrete positions\n} as const;\n\n// --- Fixed update rate (independent of render cost / screen size) ---\nconst FIXED_FPS = 60;\nconst FIXED_MS = 1000 / FIXED_FPS;\nconst MAX_CATCHUP_STEPS = 4;\n\n// --- Persisted audio position ---\nconst MUSIC_TIME_KEY = \"lavaLamp.musicTimeSeconds\";\n\n// --- Utils ---\nfunction clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nfunction clampInt(v: number, lo: number, hi: number) {\n  return v < lo ? lo : v > hi ? hi : v;\n}\n\nfunction lerp(a: number, b: number, t: number) {\n  return a + (b - a) * t;\n}\n\nfunction lerpInt(a: number, b: number, t: number): number {\n  const v = a + (b - a) * t;\n  return v < 0 ? 0 : v > 255 ? 255 : Math.round(v);\n}\n\nfunction randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\nfunction bounceInBounds(p: Particle, width: number, height: number) {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nfunction clampAllToBounds(\n  particles: Particle[],\n  width: number,\n  height: number\n) {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\nfunction computeParticleCount(width: number, height: number): number {\n  const area = width * height;\n  return Math.round(area / PIXELS_PER_PARTICLE);\n}\n\nfunction readSavedMusicTimeSeconds(): number {\n  try {\n    const raw = localStorage.getItem(MUSIC_TIME_KEY);\n    if (!raw) return 0;\n    const v = Number(raw);\n    return Number.isFinite(v) && v >= 0 ? v : 0;\n  } catch {\n    return 0;\n  }\n}\n\nfunction writeSavedMusicTimeSeconds(seconds: number) {\n  try {\n    if (!Number.isFinite(seconds) || seconds < 0) return;\n    localStorage.setItem(MUSIC_TIME_KEY, String(seconds));\n  } catch {\n    // ignore\n  }\n}\n\n// Note: MIN=0 is special; idx 0 => frozen-ish. idx 1..(STEPS-1) => (0..MAX] in log space.\nfunction indexToSpeed(idx: number): number {\n  if (idx <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  if (idx >= steps) return SPEED.MAX;\n\n  // normalized position excluding 0\n  const t = idx / steps; // idx=steps/2 => midpoint\n\n  // calibrated so midpoint â‰ˆ 0.5\n  const targetMidSpeed = 0.5;\n  const minPositive = (targetMidSpeed * targetMidSpeed) / SPEED.MAX;\n\n  const minLog = Math.log(minPositive);\n  const maxLog = Math.log(SPEED.MAX);\n\n  return Math.exp(lerp(minLog, maxLog, t));\n}\n\nfunction speedToNearestIndex(speed: number): number {\n  if (speed <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  const last = steps - 1;\n\n  let best = 1;\n  let bestErr = Infinity;\n  const target = Math.log(speed);\n\n  for (let i = 1; i <= last; i++) {\n    const s = indexToSpeed(i);\n    const err = Math.abs(Math.log(s) - target);\n    if (err < bestErr) {\n      bestErr = err;\n      best = i;\n    }\n  }\n  return best;\n}\n\n// --- Color / LUT ---\nfunction packRgba(r: number, g: number, b: number, a: number): number {\n  // Uint32Array view over ImageData.data.buffer (common little-endian fast path).\n  return (a << 24) | (b << 16) | (g << 8) | r;\n}\n\nfunction buildHeatLut256(lowHex: string, highHex: string): Uint32Array {\n  const lo = hexToRgb(lowHex);\n  const hi = hexToRgb(highHex);\n\n  const lut = new Uint32Array(256);\n  for (let i = 0; i < 256; i++) {\n    const t = i / 255;\n    const r = lerpInt(lo.r, hi.r, t);\n    const g = lerpInt(lo.g, hi.g, t);\n    const b = lerpInt(lo.b, hi.b, t);\n    lut[i] = packRgba(r, g, b, 255);\n  }\n  return lut;\n}\n\n// --- Spatial grid helpers ---\nfunction ensureGrid(\n  gridRef: React.MutableRefObject<SpatialGrid | null>,\n  width: number,\n  height: number,\n  count: number,\n  cellSize: number\n) {\n  const cols = Math.max(1, Math.ceil(width / cellSize));\n  const rows = Math.max(1, Math.ceil(height / cellSize));\n  const cells = cols * rows;\n\n  const g = gridRef.current;\n  if (\n    !g ||\n    g.cols !== cols ||\n    g.rows !== rows ||\n    g.cellSize !== cellSize ||\n    g.next.length !== count ||\n    g.heads.length !== cells\n  ) {\n    gridRef.current = {\n      cellSize,\n      cols,\n      rows,\n      heads: new Int32Array(cells),\n      next: new Int32Array(count),\n    };\n  }\n}\n\nfunction gridIndex(g: SpatialGrid, cx: number, cy: number): number {\n  return cy * g.cols + cx;\n}\n\n// --- Init ---\nfunction createParticles(\n  width: number,\n  height: number,\n  count: number\n): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// --- Physics (grid-accelerated cohesion/conduction) ---\nexport function stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array,\n  timeScale: number,\n  grid: SpatialGrid\n) {\n  const dt = Math.max(0, Math.min(4.0, timeScale));\n\n  // Pass 1: integrate + pointer heat + reset neighbors + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    applyBuoyancyAndGravity(p, dt);\n    applyFriction(p, dt);\n    integrate(p, dt);\n\n    if (pointerDown) applyPointerHeat(p, pointerPos, dt);\n\n    neighborCounts[i] = 0;\n    bounceInBounds(p, width, height);\n  }\n\n  // dt=0 => frozen (no cohesion/conduction/cooling), but still clamp\n  if (dt === 0) {\n    for (let i = 0; i < particles.length; i++) {\n      particles[i].heat = clamp01(particles[i].heat);\n    }\n    clampAllToBounds(particles, width, height);\n    return;\n  }\n\n  // Build spatial hash\n  grid.heads.fill(-1);\n  const invCell = 1 / grid.cellSize;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    let cx = (p.x * invCell) | 0;\n    let cy = (p.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const cell = gridIndex(grid, cx, cy);\n    grid.next[i] = grid.heads[cell];\n    grid.heads[cell] = i;\n  }\n\n  // Pass 2: local neighbor forces + conduction\n  const r = SIM.COHESION_RADIUS;\n  const r2 = r * r;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p1 = particles[i];\n\n    let cx = (p1.x * invCell) | 0;\n    let cy = (p1.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const x0 = cx > 0 ? cx - 1 : cx;\n    const x1 = cx + 1 < grid.cols ? cx + 1 : cx;\n    const y0 = cy > 0 ? cy - 1 : cy;\n    const y1 = cy + 1 < grid.rows ? cy + 1 : cy;\n\n    for (let ny = y0; ny <= y1; ny++) {\n      for (let nx = x0; nx <= x1; nx++) {\n        let j = grid.heads[gridIndex(grid, nx, ny)];\n        while (j !== -1) {\n          if (j > i) {\n            const p2 = particles[j];\n            const dx = p2.x - p1.x;\n            const dy = p2.y - p1.y;\n            const d2 = dx * dx + dy * dy;\n\n            if (d2 > 0 && d2 < r2) {\n              neighborCounts[i]++;\n              neighborCounts[j]++;\n\n              const d = Math.sqrt(d2);\n              applyCohesionImpulse(p1, p2, dx, dy, d, dt);\n              applyHeatConduction(p1, p2, dt);\n            }\n          }\n          j = grid.next[j];\n        }\n      }\n    }\n  }\n\n  // Pass 3: heat source / cooling\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n    applyBottomHeatOrAirCooling(p, height, neighborCounts[i], dt);\n    p.heat = clamp01(p.heat);\n  }\n\n  clampAllToBounds(particles, width, height);\n}\n\nfunction applyBuoyancyAndGravity(p: Particle, dt: number) {\n  const buoyancy = p.heat * p.heat * SIM.BUOYANCY;\n  p.vy += (SIM.GRAVITY - buoyancy) * dt;\n}\n\nfunction applyFriction(p: Particle, dt: number) {\n  const f = Math.pow(SIM.FRICTION, dt);\n  p.vx *= f;\n  p.vy *= f;\n}\n\nfunction integrate(p: Particle, dt: number) {\n  p.x += p.vx * dt;\n  p.y += p.vy * dt;\n}\n\nfunction applyPointerHeat(p: Particle, pointerPos: Vec2, dt: number) {\n  const dx = p.x - pointerPos.x;\n  const dy = p.y - pointerPos.y;\n  const d2 = dx * dx + dy * dy;\n  const r = SIM.MOUSE_HEAT_RADIUS;\n  const r2 = r * r;\n\n  if (d2 < r2) {\n    const d = Math.sqrt(d2);\n    const intensity = 1 - d * (1 / r);\n    p.heat += SIM.HEAT_RATE * 2 * intensity * dt;\n  }\n}\n\nfunction applyCohesionImpulse(\n  p1: Particle,\n  p2: Particle,\n  dx: number,\n  dy: number,\n  d: number,\n  dt: number\n) {\n  const force = SIM.COHESION_STRENGTH * (1 - d * (1 / SIM.COHESION_RADIUS));\n  const invD = 1 / d;\n  const fx = dx * invD * force * dt;\n  const fy = dy * invD * force * dt;\n\n  p1.vx += fx;\n  p1.vy += fy;\n  p2.vx -= fx;\n  p2.vy -= fy;\n}\n\nfunction applyHeatConduction(p1: Particle, p2: Particle, dt: number) {\n  const heatDiff = p1.heat - p2.heat;\n  const conduction = heatDiff * SIM.HEAT_CONDUCTION * dt;\n  p1.heat -= conduction;\n  p2.heat += conduction;\n}\n\nfunction applyBottomHeatOrAirCooling(\n  p: Particle,\n  height: number,\n  neighborCount: number,\n  dt: number\n) {\n  const distanceFromBottom = height - p.y;\n\n  if (distanceFromBottom < SIM.HEAT_SOURCE_DISTANCE) {\n    const intensity = 1 - distanceFromBottom * (1 / SIM.HEAT_SOURCE_DISTANCE);\n    p.heat += SIM.HEAT_RATE * intensity * dt;\n    return;\n  }\n\n  const maxNeighbors = 8;\n  const neighbors = neighborCount < maxNeighbors ? neighborCount : maxNeighbors;\n  const airExposure = 1 - neighbors / maxNeighbors;\n\n  p.heat -= SIM.COOL_RATE * (0.2 + airExposure * 0.8) * dt;\n}\n\n// --- Render helpers ---\nfunction ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\nfunction drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number,\n  heatLut256: Uint32Array\n) {\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  const data32 = new Uint32Array(imageData.data.buffer);\n\n  // 7) Donâ€™t clear twice: clear ONCE here to opaque black\n  const black = packRgba(0, 0, 0, 255);\n  data32.fill(black);\n\n  const w = canvasWidth;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      for (let i = 0; i < particles.length; i++) {\n        const p = particles[i];\n        const dx = x - p.x;\n        const dy = y - p.y;\n        const distSq = dx * dx + dy * dy;\n        const influence = r2 / (distSq + 1);\n\n        influenceSum += influence;\n        heatWeightedSum += influence * p.heat;\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const lutIdx = heat <= 0 ? 0 : heat >= 1 ? 255 : (heat * 255) | 0;\n      const rgba = heatLut256[lutIdx];\n\n      for (let py = 0; py < pixelSize; py++) {\n        const yy = y + py;\n        if (yy >= canvasHeight) break;\n\n        let idx = yy * w + x;\n        const rowEnd = Math.min(x + pixelSize, w);\n        for (let xx = x; xx < rowEnd; xx++) {\n          data32[idx++] = rgba;\n        }\n      }\n    }\n  }\n}\n\nfunction renderFrame(\n  ctx: CanvasRenderingContext2D,\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>,\n  heatLut256: Uint32Array\n) {\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n  drawMetaballs(imageData, particles, canvas.width, canvas.height, heatLut256);\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// --- Component ---\nexport default function LavaLamp(): ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const ctxRef = useRef<CanvasRenderingContext2D | null>(null);\n\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n  const particleCountRef = useRef<number | null>(null);\n\n  const gridRef = useRef<SpatialGrid | null>(null);\n\n  // 5) Cache dimensions ONCE (read only on page load)\n  const sizeRef = useRef<{ w: number; h: number }>({ w: 1, h: 1 });\n\n  const [audioSource, setAudioSource] = useState<AudioSource>(\n    AUDIO_SOURCES.KEXP\n  );\n\n  const gameMusic = useMemo(() => {\n    // Initialize directly with KEXP stream\n    const audio = new PersonalAudio(\n      AUDIO_SOURCE_CONFIG[AUDIO_SOURCES.KEXP].url,\n      true\n    );\n    audio.preload = \"auto\";\n    return audio;\n  }, []);\n  const clickSound = useMemo(\n    () => new PersonalAudio(clickAudioNoise, false),\n    []\n  );\n\n  const [hasStarted, setHasStarted] = useState(false);\n\n  const pointerDownRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  // Audio amplitude analysis\n  const amplitudeAnalyzerRef = useRef<AudioAmplitudeAnalyzer | null>(null);\n  const currentWaveformRef = useRef<number[]>(new Array(10).fill(0));\n  const [displayWaveform, setDisplayWaveform] = useState<number[]>(\n    new Array(10).fill(0)\n  );\n  const waveformUpdateCounterRef = useRef(0);\n\n  // Speed slider state\n  const defaultSpeedIdx = useMemo(() => speedToNearestIndex(SPEED.DEFAULT), []);\n  const [speedIdx, setSpeedIdx] = useState<number>(defaultSpeedIdx);\n  const speedRef = useRef<number>(SPEED.DEFAULT);\n\n  useEffect(() => {\n    speedRef.current = indexToSpeed(speedIdx);\n  }, [speedIdx]);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n  const toggleMenu = useCallback(() => setMenuOpen((v) => !v), []);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  const [isFullscreen, setIsFullscreen] = useState<boolean>(false);\n\n  // Handle fullscreen changes\n  useEffect(() => {\n    const handleFullscreenChange = (): void => {\n      const inFullscreen = !!document.fullscreenElement;\n      setIsFullscreen(inFullscreen);\n\n      // Add/remove body class for CSS targeting\n      if (inFullscreen) {\n        document.body.classList.add(\"lava-lamp-fullscreen\");\n      } else {\n        document.body.classList.remove(\"lava-lamp-fullscreen\");\n      }\n\n      // Resize canvas to match new screen size\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      const w = window.innerWidth;\n      const h = window.innerHeight;\n\n      canvas.width = w;\n      canvas.height = h;\n\n      // Update cached size\n      sizeRef.current = { w, h };\n\n      // Reset image data to force recalculation\n      imageRef.current = null;\n\n      // Clamp existing particles to new bounds\n      if (particlesRef.current) {\n        clampAllToBounds(particlesRef.current, w, h);\n      }\n    };\n    document.addEventListener(\"fullscreenchange\", handleFullscreenChange);\n    return () => {\n      document.removeEventListener(\"fullscreenchange\", handleFullscreenChange);\n      document.body.classList.remove(\"lava-lamp-fullscreen\");\n    };\n  }, []);\n\n  const toggleFullscreen = useCallback((): void => {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen().catch((err) => {\n        console.error(\"Error attempting to enable fullscreen:\", err);\n      });\n    } else {\n      document.exitFullscreen();\n    }\n  }, []);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!menuOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setMenuOpen(false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, [menuOpen]);\n\n  const [volume, setVolume] = useState(1.0);\n  useEffect(() => {\n    gameMusic.volume = volume;\n  }, [volume, gameMusic]);\n  const [nowPlaying, setNowPlaying] = useState<{\n    song: string;\n    artist: string;\n    album: string;\n    isAirbreak: boolean;\n  } | null>(null);\n  const [nowPlayingExpanded, setNowPlayingExpanded] = useState(true);\n  const nowPlayingSongRef = useRef<HTMLDivElement>(null);\n  const nowPlayingArtistRef = useRef<HTMLDivElement>(null);\n  const nowPlayingAlbumRef = useRef<HTMLDivElement>(null);\n  const [songOverflowing, setSongOverflowing] = useState(false);\n  const [artistOverflowing, setArtistOverflowing] = useState(false);\n  const [albumOverflowing, setAlbumOverflowing] = useState(false);\n\n  const isFirstRender = useRef(true);\n\n  useEffect(() => {\n    // Skip on first render - audio is already initialized with KEXP\n    if (isFirstRender.current) {\n      isFirstRender.current = false;\n      return;\n    }\n\n    const config = AUDIO_SOURCE_CONFIG[audioSource];\n    const wasPlaying = gameMusic.isPlaying();\n\n    // Pause current audio before switching\n    if (wasPlaying) {\n      gameMusic.pause();\n    }\n\n    gameMusic.src = config.url;\n    gameMusic.load();\n\n    if (wasPlaying) {\n      const onCanPlay = () => {\n        gameMusic.play().catch(() => {\n          // ignore autoplay errors\n        });\n        gameMusic.removeEventListener(\"canplaythrough\", onCanPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onCanPlay, { once: true });\n    }\n  }, [audioSource, gameMusic]);\n\n  // Fetch KEXP now playing info\n  useEffect(() => {\n    if (!hasStarted || audioSource !== AUDIO_SOURCES.KEXP) {\n      setNowPlaying(null);\n      return;\n    }\n\n    const fetchNowPlaying = async () => {\n      try {\n        const response = await fetch(\"https://api.kexp.org/v2/plays/?limit=5\");\n        const data = await response.json();\n\n        // Get the most recent play regardless of type\n        const mostRecentPlay = data.results?.[0];\n\n        if (!mostRecentPlay) {\n          console.log(\"[KEXP] No plays found\");\n          return;\n        }\n\n        // Check if it's an airbreak\n        if (mostRecentPlay.play_type === \"airbreak\") {\n          setNowPlaying({\n            song: \"airbreak\",\n            artist: \"\",\n            album: \"\",\n            isAirbreak: true,\n          });\n        } else if (mostRecentPlay.play_type === \"trackplay\") {\n          const newTrack = {\n            song: (mostRecentPlay.song || \"unknown track\").toLowerCase(),\n            artist: (mostRecentPlay.artist || \"unknown artist\").toLowerCase(),\n            album: (mostRecentPlay.album || \"unknown album\").toLowerCase(),\n            isAirbreak: false,\n          };\n          setNowPlaying(newTrack);\n        }\n      } catch (err) {\n        console.log(\"[KEXP] Fetch error:\", err);\n      }\n    };\n\n    fetchNowPlaying();\n    const interval = setInterval(fetchNowPlaying, 5000); // Poll every 5 seconds\n\n    return () => clearInterval(interval);\n  }, [hasStarted, audioSource]);\n\n  // Check for text overflow and apply scrolling class\n  useEffect(() => {\n    const SCROLL_SPEED = 30; // pixels per second (slower = more readable)\n\n    const calculateScrollDuration = (\n      containerWidth: number,\n      textWidth: number\n    ): number => {\n      // Distance = just the text width (text scrolls from 0% to -100%)\n      return textWidth / SCROLL_SPEED;\n    };\n\n    const calculateSecondCopyDelay = (\n      containerWidth: number,\n      textWidth: number,\n      duration: number\n    ): number => {\n      // Wait for Copy 1 to completely scroll off screen before starting Copy 2\n      // At 100% of the animation, Copy 1 is at translateX(-100%) (fully off screen)\n      // Copy 2 starts its animation just as Copy 1 loops back to the beginning\n      return 1.0;\n    };\n\n    const checkOverflow = () => {\n      if (nowPlayingSongRef.current) {\n        const wrapper = nowPlayingSongRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingSongRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setSongOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingSongRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingSongRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingSongRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingSongRef.current.classList.remove(\"overflowing\");\n        }\n      }\n\n      if (nowPlayingArtistRef.current) {\n        const wrapper = nowPlayingArtistRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingArtistRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setArtistOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingArtistRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingArtistRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingArtistRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingArtistRef.current.classList.remove(\"overflowing\");\n        }\n      }\n\n      if (nowPlayingAlbumRef.current) {\n        const wrapper = nowPlayingAlbumRef.current.querySelector(\n          \".scroll-wrapper\"\n        ) as HTMLElement;\n        const containerWidth = nowPlayingAlbumRef.current.clientWidth;\n        const isOverflowing = wrapper && wrapper.scrollWidth > containerWidth;\n        setAlbumOverflowing(!!isOverflowing);\n        if (isOverflowing && wrapper) {\n          const duration = calculateScrollDuration(\n            containerWidth,\n            wrapper.scrollWidth\n          );\n          const delayFraction = calculateSecondCopyDelay(\n            containerWidth,\n            wrapper.scrollWidth,\n            duration\n          );\n          nowPlayingAlbumRef.current.style.setProperty(\n            \"--scroll-duration\",\n            `${duration}s`\n          );\n          nowPlayingAlbumRef.current.style.setProperty(\n            \"--second-copy-delay\",\n            `${delayFraction}`\n          );\n          nowPlayingAlbumRef.current.classList.add(\"overflowing\");\n        } else {\n          nowPlayingAlbumRef.current.classList.remove(\"overflowing\");\n        }\n      }\n    };\n\n    checkOverflow();\n    window.addEventListener(\"resize\", checkOverflow);\n\n    return () => window.removeEventListener(\"resize\", checkOverflow);\n  }, [nowPlaying, nowPlayingExpanded]);\n\n  const lavaLowColorRef = useRef(DEFAULT_LOW);\n  const lavaHighColorRef = useRef(DEFAULT_HIGH);\n\n  const [lavaLowColor, setLavaLowColor] = useState(DEFAULT_LOW);\n  const [lavaHighColor, setLavaHighColor] = useState(DEFAULT_HIGH);\n  const [rainbowMode, setRainbowMode] = useState(false);\n  const rainbowLowHueRef = useRef(0);\n  const rainbowHighHueRef = useRef(0);\n\n  const heatLutRef = useRef<Uint32Array>(\n    buildHeatLut256(DEFAULT_LOW, DEFAULT_HIGH)\n  );\n\n  // Rebuild LUT whenever colors change; redraw immediately if running.\n  useEffect(() => {\n    lavaLowColorRef.current = lavaLowColor;\n    lavaHighColorRef.current = lavaHighColor;\n    heatLutRef.current = buildHeatLut256(lavaLowColor, lavaHighColor);\n  }, [lavaLowColor, lavaHighColor, hasStarted]);\n\n  // 5) Cache canvas/context + dimensions (only read on initial mount)\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n    sizeRef.current = { w, h };\n\n    canvas.width = w;\n    canvas.height = h;\n\n    ctxRef.current = canvas.getContext(\"2d\");\n\n    // ensure image data matches cached size\n    imageRef.current = null;\n\n    // no resize listener by request\n  }, []);\n\n  const initializeParticlesOnce = useCallback(() => {\n    const { w, h } = sizeRef.current;\n\n    if (particleCountRef.current === null) {\n      particleCountRef.current = computeParticleCount(w, h);\n    }\n\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n\n    ensureGrid(gridRef, w, h, count, SIM.COHESION_RADIUS);\n  }, []);\n\n  const saveMusicPosition = useCallback(() => {\n    writeSavedMusicTimeSeconds(gameMusic.currentTime ?? 0);\n  }, [gameMusic]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    const tick = () => saveMusicPosition();\n    const id = window.setInterval(tick, 1000);\n\n    const onPageHide = () => saveMusicPosition();\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"hidden\") saveMusicPosition();\n    };\n\n    window.addEventListener(\"pagehide\", onPageHide);\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n\n    return () => {\n      window.clearInterval(id);\n      window.removeEventListener(\"pagehide\", onPageHide);\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    };\n  }, [hasStarted, saveMusicPosition]);\n\n  useEffect(() => {\n    return () => {\n      saveMusicPosition();\n\n      gameMusic.pause();\n      gameMusic.volume = 0;\n      gameMusic.reset();\n\n      clickSound.pause();\n      clickSound.volume = 0;\n      clickSound.reset();\n\n      // Cleanup amplitude analyzer\n      if (amplitudeAnalyzerRef.current) {\n        amplitudeAnalyzerRef.current.disconnect();\n        amplitudeAnalyzerRef.current = null;\n      }\n    };\n  }, [gameMusic, clickSound, saveMusicPosition]);\n\n  const updateOnce = useCallback(() => {\n    const g = gridRef.current;\n    if (!g) return;\n\n    const { w, h } = sizeRef.current;\n\n    stepSimulationOnePairPass(\n      particlesRef.current,\n      w,\n      h,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current,\n      speedRef.current,\n      g\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    const ctx = ctxRef.current;\n    if (!canvas || !ctx) return;\n\n    renderFrame(\n      ctx,\n      canvas,\n      particlesRef.current,\n      imageRef,\n      heatLutRef.current\n    );\n  }, []);\n\n  // 0) Fixed update cadence: updates happen at FIXED_FPS regardless of render speed.\n  const clockRef = useRef<{ last: number; acc: number }>({ last: 0, acc: 0 });\n\n  const animate = useCallback(\n    (now: number) => {\n      const clock = clockRef.current;\n\n      if (clock.last === 0) clock.last = now;\n      const delta = now - clock.last;\n      clock.last = now;\n\n      // Clamp massive deltas (tab-switch etc.)\n      clock.acc += Math.min(250, Math.max(0, delta));\n\n      let steps = 0;\n      while (clock.acc >= FIXED_MS && steps < MAX_CATCHUP_STEPS) {\n        updateOnce();\n        clock.acc -= FIXED_MS;\n        steps++;\n      }\n\n      // Drop extra backlog to avoid death spiral\n      if (clock.acc >= FIXED_MS) clock.acc = 0;\n\n      // Update audio waveform bars (update state every 5 frames for smoother, calmer animation)\n      if (amplitudeAnalyzerRef.current) {\n        currentWaveformRef.current =\n          amplitudeAnalyzerRef.current.getWaveformBars(10);\n        waveformUpdateCounterRef.current++;\n        if (waveformUpdateCounterRef.current >= 5) {\n          setDisplayWaveform(currentWaveformRef.current);\n          waveformUpdateCounterRef.current = 0;\n        }\n      }\n\n      draw();\n      rafRef.current = requestAnimationFrame(animate);\n    },\n    [draw, updateOnce]\n  );\n\n  // Initialize rainbow hues from current colors ONLY when rainbow mode is enabled\n  const prevRainbowModeRef = useRef(false);\n  useEffect(() => {\n    // Only initialize when rainbow mode transitions from false -> true\n    if (rainbowMode && !prevRainbowModeRef.current) {\n      // Start rainbow from the current colors' hues\n      rainbowLowHueRef.current = hexToHue(lavaLowColor);\n      rainbowHighHueRef.current = hexToHue(lavaHighColor);\n    }\n    prevRainbowModeRef.current = rainbowMode;\n  }, [rainbowMode, lavaLowColor, lavaHighColor]);\n\n  // Rainbow mode color cycling\n  useEffect(() => {\n    if (!rainbowMode) return;\n\n    let animationId: number;\n    let lastTime = performance.now();\n\n    const updateRainbowColors = (now: number) => {\n      const deltaTime = now - lastTime;\n      lastTime = now;\n\n      // Speed scales from 0 (frozen) to 5 (max)\n      // Rainbow speed: 0.02 degrees per frame at speed=1, scales linearly\n      const baseSpeed = 0.02;\n      const speed = speedRef.current;\n      const normalizedDelta = deltaTime / 16.67; // normalize to ~60fps\n\n      // Drift hot and cold independently at slightly different rates\n      const lowIncrement = baseSpeed * speed * normalizedDelta;\n      const highIncrement = baseSpeed * speed * normalizedDelta * 1.3; // 30% faster\n\n      rainbowLowHueRef.current =\n        (rainbowLowHueRef.current + lowIncrement) % 360;\n      rainbowHighHueRef.current =\n        (rainbowHighHueRef.current + highIncrement) % 360;\n\n      const lowColor = hslToHex(rainbowLowHueRef.current, 1.0, 0.5);\n      const highColor = hslToHex(rainbowHighHueRef.current, 1.0, 0.5);\n\n      setLavaLowColor(lowColor);\n      setLavaHighColor(highColor);\n\n      animationId = requestAnimationFrame(updateRainbowColors);\n    };\n\n    animationId = requestAnimationFrame(updateRainbowColors);\n\n    return () => cancelAnimationFrame(animationId);\n  }, [rainbowMode]);\n\n  // Pointer handling\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const toLocal = (e: PointerEvent): Vec2 => {\n      const rect = canvas.getBoundingClientRect();\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n    };\n\n    const onDown = (e: PointerEvent) => {\n      pointerDownRef.current = true;\n      pointerPosRef.current = toLocal(e);\n    };\n    const onMove = (e: PointerEvent) => {\n      pointerPosRef.current = toLocal(e);\n    };\n    const onUp = () => {\n      pointerDownRef.current = false;\n    };\n\n    canvas.addEventListener(\"pointerdown\", onDown);\n    window.addEventListener(\"pointermove\", onMove);\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"pointercancel\", onUp);\n\n    return () => {\n      canvas.removeEventListener(\"pointerdown\", onDown);\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"pointercancel\", onUp);\n    };\n  }, []);\n\n  const playClick = useCallback(() => {\n    try {\n      clickSound.volume = 1.0;\n      clickSound.currentTime = 0;\n      clickSound.reset();\n      clickSound.play();\n    } catch {\n      // ignore\n    }\n  }, [clickSound]);\n\n  const resumeMusicFromSavedTime = useCallback(() => {\n    const t = readSavedMusicTimeSeconds();\n    try {\n      const duration = (gameMusic as any).duration as number | undefined;\n      if (\n        typeof duration === \"number\" &&\n        Number.isFinite(duration) &&\n        duration > 0\n      ) {\n        gameMusic.currentTime = t % duration;\n      } else {\n        gameMusic.currentTime = t;\n      }\n    } catch {\n      // ignore\n    }\n  }, [gameMusic]);\n\n  const startLamp = useCallback(async () => {\n    playClick();\n\n    if (!hasStarted) {\n      setHasStarted(true);\n      initializeParticlesOnce();\n\n      // reset fixed-timestep clock\n      clockRef.current = { last: 0, acc: 0 };\n\n      // draw a first frame immediately\n      requestAnimationFrame(() => draw());\n\n      // start RAF loop\n      rafRef.current = requestAnimationFrame(animate);\n\n      // Initialize amplitude analyzer\n      if (!amplitudeAnalyzerRef.current) {\n        const analyzer = new AudioAmplitudeAnalyzer();\n        const connected = analyzer.connect(gameMusic);\n        if (connected) {\n          amplitudeAnalyzerRef.current = analyzer;\n          console.log(\"[LavaLamp] Audio amplitude analyzer connected\");\n        } else {\n          console.warn(\"[LavaLamp] Failed to connect audio amplitude analyzer\");\n        }\n      }\n    }\n\n    // Resume audio context if suspended\n    if (amplitudeAnalyzerRef.current) {\n      amplitudeAnalyzerRef.current.resume();\n    }\n\n    // Only resume from saved time for non-streaming sources (like Redwood)\n    if (audioSource !== AUDIO_SOURCES.KEXP) {\n      resumeMusicFromSavedTime();\n    }\n    gameMusic.volume = 1.0;\n\n    // Ensure audio is loaded before trying to play\n    if (gameMusic.readyState < 3) {\n      // If not enough data loaded, trigger load and wait\n      gameMusic.load();\n\n      const onCanPlay = async () => {\n        try {\n          await gameMusic.play();\n        } catch {\n          // ignore if still fails\n        }\n        gameMusic.removeEventListener(\"canplaythrough\", onCanPlay);\n      };\n      gameMusic.addEventListener(\"canplaythrough\", onCanPlay, { once: true });\n    } else {\n      // Audio already loaded, play immediately\n      try {\n        await gameMusic.play();\n      } catch {\n        // ignore autoplay errors\n      }\n    }\n  }, [\n    animate,\n    audioSource,\n    draw,\n    gameMusic,\n    hasStarted,\n    initializeParticlesOnce,\n    playClick,\n    resumeMusicFromSavedTime,\n  ]);\n\n  const initialCanvasSize = useMemo(\n    () => ({ w: window.innerWidth, h: window.innerHeight }),\n    []\n  );\n\n  const lastSpeedIdx = SPEED.STEPS - 1;\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n      />\n\n      {nowPlaying && (\n        <div\n          className={`lava-lamp-now-playing ${\n            nowPlayingExpanded ? \"expanded\" : \"collapsed\"\n          }`}\n        >\n          <button\n            type=\"button\"\n            className=\"lava-lamp-now-playing-toggle\"\n            onClick={() => setNowPlayingExpanded(!nowPlayingExpanded)}\n            aria-label={\n              nowPlayingExpanded ? \"Collapse now playing\" : \"Expand now playing\"\n            }\n          >\n            {nowPlayingExpanded ? \"â€º\" : \"â€¹\"}\n          </button>\n          <div className=\"lava-lamp-now-playing-content\">\n            <div className=\"lava-lamp-now-playing-header\">\n              <div className=\"lava-lamp-now-playing-label\">kexp</div>\n              {!nowPlaying.isAirbreak && (\n                <div className=\"lava-lamp-soundwave\">\n                  {displayWaveform.map((height, i) => (\n                    <div\n                      key={i}\n                      className=\"lava-lamp-soundwave-bar\"\n                      style={{ \"--bar-height\": height } as React.CSSProperties}\n                    />\n                  ))}\n                </div>\n              )}\n            </div>\n            <div ref={nowPlayingSongRef} className=\"lava-lamp-now-playing-song\">\n              <span className=\"scroll-wrapper\">{nowPlaying.song}</span>\n              {songOverflowing && (\n                <span className=\"scroll-wrapper second\">{nowPlaying.song}</span>\n              )}\n            </div>\n            {!nowPlaying.isAirbreak && (\n              <>\n                <div\n                  ref={nowPlayingArtistRef}\n                  className=\"lava-lamp-now-playing-artist\"\n                >\n                  <span className=\"scroll-wrapper\">{nowPlaying.artist}</span>\n                  {artistOverflowing && (\n                    <span className=\"scroll-wrapper second\">\n                      {nowPlaying.artist}\n                    </span>\n                  )}\n                </div>\n                <div\n                  ref={nowPlayingAlbumRef}\n                  className=\"lava-lamp-now-playing-album\"\n                >\n                  <span className=\"scroll-wrapper\">{nowPlaying.album}</span>\n                  {albumOverflowing && (\n                    <span className=\"scroll-wrapper second\">\n                      {nowPlaying.album}\n                    </span>\n                  )}\n                </div>\n              </>\n            )}\n          </div>\n        </div>\n      )}\n\n      {!hasStarted ? (\n        <div className=\"lava-lamp-start-overlay\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-start\"\n            onClick={startLamp}\n            aria-label=\"Start lava lamp radio\"\n          >\n            <img src={powerIcon} alt=\"Power\" className=\"lava-lamp-start-icon\" />\n          </button>\n        </div>\n      ) : (\n        <div className=\"lava-lamp-controls\" ref={menuRef}>\n          <button\n            type=\"button\"\n            className=\"lava-lamp-menu-toggle\"\n            onClick={toggleMenu}\n            aria-label={menuOpen ? \"Hide menu\" : \"Show menu\"}\n            aria-pressed={menuOpen}\n          >\n            {menuOpen ? \"âœ•\" : \"â˜°\"}\n          </button>\n\n          {menuOpen && (\n            <div className=\"lava-lamp-menu\">\n              {/* Speed */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    speed: {speedIdx}\n                  </div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={lastSpeedIdx}\n                    step={1}\n                    value={speedIdx}\n                    onChange={(e) =>\n                      setSpeedIdx(\n                        clampInt(Number(e.target.value), 0, lastSpeedIdx)\n                      )\n                    }\n                    aria-label=\"Simulation speed\"\n                  />\n                </div>\n              </div>\n\n              {/* Volume */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    volume: {Math.round(volume * 100)}%\n                  </div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={1}\n                    step={0.01}\n                    value={volume}\n                    onChange={(e) => setVolume(Number(e.target.value))}\n                    aria-label=\"Music volume\"\n                  />\n                </div>\n              </div>\n\n              {/* Audio Source */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">audio source</div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <select\n                    className=\"lava-lamp-slider\"\n                    value={audioSource}\n                    onChange={(e) =>\n                      setAudioSource(e.target.value as AudioSource)\n                    }\n                    aria-label=\"Audio source\"\n                  >\n                    {Object.entries(AUDIO_SOURCE_CONFIG).map(\n                      ([key, config]) => (\n                        <option key={key} value={key}>\n                          {config.label}\n                        </option>\n                      )\n                    )}\n                  </select>\n                </div>\n              </div>\n\n              {/* Lava colors */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">lava colors</div>\n                </div>\n\n                {/* Rainbow mode toggle */}\n                <div\n                  className=\"lava-lamp-slider-wrap\"\n                  style={{ marginBottom: \"12px\" }}\n                >\n                  <label\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"8px\",\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      className=\"lava-lamp-checkbox\"\n                      checked={rainbowMode}\n                      onChange={(e) => setRainbowMode(e.target.checked)}\n                    />\n                    <span style={{ fontSize: \"13px\", opacity: 0.9 }}>\n                      rainbow drift mode\n                    </span>\n                  </label>\n                </div>\n\n                <div className=\"lava-lamp-color-row\">\n                  <label className=\"lava-lamp-color-label\">\n                    hot\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaHighColor}\n                      onChange={(e) => {\n                        setLavaHighColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava high color\"\n                    />\n                  </label>\n\n                  <label className=\"lava-lamp-color-label\">\n                    cool\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaLowColor}\n                      onChange={(e) => {\n                        setLavaLowColor(e.target.value);\n                        setRainbowMode(false);\n                      }}\n                      disabled={rainbowMode}\n                      aria-label=\"Lava low color\"\n                    />\n                  </label>\n\n                  <button\n                    type=\"button\"\n                    className=\"lava-lamp-color-reset\"\n                    onClick={() => {\n                      setLavaLowColor(DEFAULT_LOW);\n                      setLavaHighColor(DEFAULT_HIGH);\n                      setRainbowMode(false);\n                    }}\n                    disabled={rainbowMode}\n                  >\n                    reset\n                  </button>\n                </div>\n              </div>\n\n              {/* Fullscreen */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-slider-wrap\">\n                  <label\n                    style={{\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      gap: \"8px\",\n                      cursor: \"pointer\",\n                    }}\n                  >\n                    <input\n                      type=\"checkbox\"\n                      className=\"lava-lamp-checkbox\"\n                      checked={isFullscreen}\n                      onChange={toggleFullscreen}\n                    />\n                    <span style={{ fontSize: \"13px\", opacity: 0.9 }}>\n                      fullscreen mode\n                    </span>\n                  </label>\n                </div>\n              </div>\n\n              {/* Power off */}\n              <div className=\"lava-lamp-control-block\">\n                <button\n                  type=\"button\"\n                  className=\"lava-lamp-power-off\"\n                  onClick={() => window.location.reload()}\n                  aria-label=\"Power off\"\n                >\n                  <img\n                    src={powerIcon}\n                    alt=\"Power off\"\n                    className=\"lava-lamp-power-off-icon\"\n                  />\n                  <span>power off</span>\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","export class PersonalAudio extends Audio {\n  constructor(src, loop=false) {\n    super(src);\n    this.loop = loop;\n    this.crossOrigin = \"anonymous\";\n  };\n\n  isPlayingSrc = (audioSrc) => {\n    return this.src?.includes(audioSrc)\n        && this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  isPlaying = () => {\n    return this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  timeLeft = () => this.duration - this.currentTime;\n\n  reset = () => {\n    this.pause();\n    this.currentTime = 0;\n  };\n}"],"names":["AudioAmplitudeAnalyzer","constructor","audioContext","analyser","dataArray","connected","connect","audioElement","this","AudioContext","createAnalyser","fftSize","smoothingTimeConstant","createMediaElementSource","destination","Uint8Array","frequencyBinCount","err","console","warn","getAmplitude","getByteTimeDomainData","sum","i","length","normalized","rms","Math","sqrt","min","getWaveformBars","barCount","Array","fill","bars","step","floor","index","abs","push","resume","state","catch","disconnect","close","isConnected","isMobile","detectMobile","userAgent","navigator","vendor","window","opera","isMobileUA","test","hasTouch","maxTouchPoints","isSmallScreen","innerWidth","AUDIO_SOURCES","REDWOOD","KEXP","AUDIO_SOURCE_CONFIG","label","url","musicAudioNoise","DEFAULT_HIGH","DEFAULT_LOW","hexToRgb","hex","h","trim","replace","r","parseInt","g","b","slice","hslToHex","s","l","a","f","n","k","color","max","round","toString","padStart","concat","hexToHue","rgb","delta","hue","SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","PIXEL_SIZE","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","PIXELS_PER_PARTICLE","SPEED","MIN","MAX","DEFAULT","STEPS","FIXED_MS","MAX_CATCHUP_STEPS","MUSIC_TIME_KEY","clamp01","v","lerpInt","t","randInCircle","radius","angle","random","PI","x","cos","y","sin","bounceInBounds","p","width","height","vx","vy","clampAllToBounds","particles","indexToSpeed","idx","steps","minPositive","targetMidSpeed","minLog","log","maxLog","exp","lerp","packRgba","buildHeatLut256","lowHex","highHex","lo","hi","lut","Uint32Array","gridIndex","cx","cy","cols","stepSimulationOnePairPass","pointerDown","pointerPos","neighborCounts","timeScale","grid","dt","applyBuoyancyAndGravity","applyFriction","integrate","applyPointerHeat","heat","heads","invCell","cellSize","rows","cell","next","r2","p1","x0","x1","y0","y1","ny","nx","j","p2","dx","dy","d2","applyCohesionImpulse","applyHeatConduction","applyBottomHeatOrAirCooling","buoyancy","pow","intensity","d","force","invD","fx","fy","conduction","neighborCount","distanceFromBottom","airExposure","renderFrame","ctx","canvas","imageRef","heatLut256","imageData","img","current","createImageData","ensureImageData","canvasWidth","canvasHeight","pixelSize","threshold","data32","data","buffer","black","w","influenceSum","heatWeightedSum","influence","rgba","py","yy","rowEnd","xx","drawMetaballs","putImageData","LavaLamp","canvasRef","useRef","ctxRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","gridRef","sizeRef","audioSource","setAudioSource","useState","gameMusic","useMemo","audio","PersonalAudio","preload","clickSound","clickAudioNoise","hasStarted","setHasStarted","pointerDownRef","pointerPosRef","amplitudeAnalyzerRef","currentWaveformRef","displayWaveform","setDisplayWaveform","waveformUpdateCounterRef","defaultSpeedIdx","speed","last","best","bestErr","Infinity","target","speedToNearestIndex","speedIdx","setSpeedIdx","speedRef","useEffect","menuOpen","setMenuOpen","toggleMenu","useCallback","menuRef","isFullscreen","setIsFullscreen","handleFullscreenChange","inFullscreen","document","fullscreenElement","body","classList","add","remove","innerHeight","addEventListener","removeEventListener","toggleFullscreen","exitFullscreen","documentElement","requestFullscreen","error","handleClickOutside","event","contains","volume","setVolume","nowPlaying","setNowPlaying","nowPlayingExpanded","setNowPlayingExpanded","nowPlayingSongRef","nowPlayingArtistRef","nowPlayingAlbumRef","songOverflowing","setSongOverflowing","artistOverflowing","setArtistOverflowing","albumOverflowing","setAlbumOverflowing","isFirstRender","config","wasPlaying","isPlaying","pause","src","load","onCanPlay","play","once","fetchNowPlaying","async","_data$results","response","fetch","mostRecentPlay","json","results","play_type","song","artist","album","isAirbreak","newTrack","toLowerCase","interval","setInterval","clearInterval","calculateScrollDuration","containerWidth","textWidth","checkOverflow","wrapper","querySelector","clientWidth","isOverflowing","scrollWidth","duration","delayFraction","style","setProperty","lavaLowColorRef","lavaHighColorRef","lavaLowColor","setLavaLowColor","lavaHighColor","setLavaHighColor","rainbowMode","setRainbowMode","rainbowLowHueRef","rainbowHighHueRef","heatLutRef","getContext","initializeParticlesOnce","area","computeParticleCount","count","particlesPerClump","centerX","centerY","clumpHeat","offset","createParticles","ceil","cells","Int32Array","ensureGrid","saveMusicPosition","_gameMusic$currentTim","seconds","Number","isFinite","localStorage","setItem","String","_unused2","writeSavedMusicTimeSeconds","currentTime","id","tick","onPageHide","onVisibilityChange","visibilityState","reset","updateOnce","draw","clockRef","acc","animate","now","clock","requestAnimationFrame","prevRainbowModeRef","animationId","lastTime","performance","updateRainbowColors","deltaTime","normalizedDelta","lowIncrement","highIncrement","lowColor","highColor","cancelAnimationFrame","toLocal","e","rect","getBoundingClientRect","clientX","left","clientY","top","onDown","onMove","onUp","playClick","_unused3","resumeMusicFromSavedTime","raw","getItem","_unused","readSavedMusicTimeSeconds","_unused4","startLamp","analyzer","readyState","_unused5","_unused6","initialCanvasSize","lastSpeedIdx","_jsxs","className","children","_jsx","ref","type","onClick","map","_Fragment","value","onChange","Object","entries","_ref","key","marginBottom","display","alignItems","gap","cursor","checked","fontSize","opacity","disabled","location","reload","powerIcon","alt","Audio","loop","arguments","undefined","super","isPlayingSrc","audioSrc","_this$src","includes","paused","ended","timeLeft","crossOrigin"],"sourceRoot":""}