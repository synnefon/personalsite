{"version":3,"file":"static/js/200.d3b6849a.chunk.js","mappings":"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","sources":["lava_lamp/LavaLamp.tsx","util/Audio.js"],"sourcesContent":["import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\nimport musicAudioNoise from \"../assets/lavaLamp/guitar.mp3\";\nimport clickAudioNoise from \"../assets/lavaLamp/click.mp3\";\nimport { PersonalAudio } from \"../util/Audio\";\n\n// --- Types ---\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  heat: number; // [0..1]\n}\n\ntype Vec2 = { x: number; y: number };\n\n// --- Constants ---\nconst SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\nconst RENDER = {\n  PARTICLE_RADIUS: 10,\n  PIXEL_SIZE: 6,\n  THRESHOLD: 0.8,\n} as const;\n\nconst CLUMPS = {\n  COUNT: 15,\n  RADIUS: 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n// Baseline density: preserves \"look\" across screens, computed once per page load.\nconst BASELINE = {\n  WIDTH: 1920,\n  HEIGHT: 1080,\n  PARTICLES: 1200,\n} as const;\n\nfunction computeParticleCount(width: number, height: number): number {\n  const baselineArea = BASELINE.WIDTH * BASELINE.HEIGHT;\n  const currentArea = width * height;\n\n  const density = BASELINE.PARTICLES / baselineArea;\n  const scaled = Math.round(currentArea * density);\n\n  return Math.max(200, Math.min(2000, scaled));\n}\n\n// --- Persisted audio position ---\nconst MUSIC_TIME_KEY = \"lavaLamp.musicTimeSeconds\";\n\nfunction readSavedMusicTimeSeconds(): number {\n  try {\n    const raw = localStorage.getItem(MUSIC_TIME_KEY);\n    if (!raw) return 0;\n    const v = Number(raw);\n    return Number.isFinite(v) && v >= 0 ? v : 0;\n  } catch {\n    return 0;\n  }\n}\n\nfunction writeSavedMusicTimeSeconds(seconds: number) {\n  try {\n    if (!Number.isFinite(seconds) || seconds < 0) return;\n    localStorage.setItem(MUSIC_TIME_KEY, String(seconds));\n  } catch {\n    // ignore\n  }\n}\n\n// --- Utils ---\nfunction clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nfunction hypot2(dx: number, dy: number): number {\n  return Math.hypot(dx, dy);\n}\n\nfunction randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\nfunction setCanvasToWindow(canvas: HTMLCanvasElement) {\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n}\n\nfunction bounceInBounds(p: Particle, width: number, height: number) {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nfunction clampAllToBounds(particles: Particle[], width: number, height: number) {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\n// --- Init ---\nfunction createParticles(width: number, height: number, count: number): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// --- Physics (Option 2: single pair-pass on post-move positions) ---\nfunction stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array\n) {\n  const n = particles.length;\n\n  const gravity = SIM.GRAVITY;\n  const buoyancyK = SIM.BUOYANCY;\n  const friction = SIM.FRICTION;\n\n  const mouseR = SIM.MOUSE_HEAT_RADIUS;\n  const mouseRInv = 1 / mouseR;\n\n  const heatRate = SIM.HEAT_RATE;\n  const coolRate = SIM.COOL_RATE;\n\n  const heatSrcDist = SIM.HEAT_SOURCE_DISTANCE;\n  const heatSrcDistInv = 1 / heatSrcDist;\n\n  const cohR = SIM.COHESION_RADIUS;\n  const cohRInv = 1 / cohR;\n  const cohStrength = SIM.COHESION_STRENGTH;\n\n  const conductionK = SIM.HEAT_CONDUCTION;\n\n  const pointerX = pointerPos.x;\n  const pointerY = pointerPos.y;\n\n  for (let i = 0; i < n; i++) {\n    const p = particles[i];\n\n    const buoyancy = p.heat * p.heat * buoyancyK;\n    p.vy += gravity - buoyancy;\n\n    p.vx *= friction;\n    p.vy *= friction;\n\n    p.x += p.vx;\n    p.y += p.vy;\n\n    if (pointerDown) {\n      const dx = p.x - pointerX;\n      const dy = p.y - pointerY;\n      const d = hypot2(dx, dy);\n      if (d < mouseR) {\n        const intensity = 1 - d * mouseRInv;\n        p.heat += heatRate * 2 * intensity;\n      }\n    }\n\n    neighborCounts[i] = 0;\n    bounceInBounds(p, width, height);\n  }\n\n  for (let i = 0; i < n; i++) {\n    const p1 = particles[i];\n    for (let j = i + 1; j < n; j++) {\n      const p2 = particles[j];\n\n      const dx = p2.x - p1.x;\n      const dy = p2.y - p1.y;\n      const d = hypot2(dx, dy);\n\n      if (d > 0 && d < cohR) {\n        neighborCounts[i]++;\n        neighborCounts[j]++;\n\n        const force = cohStrength * (1 - d * cohRInv);\n        const invD = 1 / d;\n        const fx = dx * invD * force;\n        const fy = dy * invD * force;\n\n        p1.vx += fx;\n        p1.vy += fy;\n        p2.vx -= fx;\n        p2.vy -= fy;\n\n        const heatDiff = p1.heat - p2.heat;\n        const conduction = heatDiff * conductionK;\n        p1.heat -= conduction;\n        p2.heat += conduction;\n      }\n    }\n  }\n\n  for (let i = 0; i < n; i++) {\n    const p = particles[i];\n    const distanceFromBottom = height - p.y;\n\n    if (distanceFromBottom < heatSrcDist) {\n      const intensity = 1 - distanceFromBottom * heatSrcDistInv;\n      p.heat += heatRate * intensity;\n    } else {\n      const maxNeighbors = 8;\n      const neighbors =\n        neighborCounts[i] < maxNeighbors ? neighborCounts[i] : maxNeighbors;\n      const airExposure = 1 - neighbors / maxNeighbors;\n      p.heat -= coolRate * (0.2 + airExposure * 0.8);\n    }\n\n    p.heat = clamp01(p.heat);\n  }\n\n  clampAllToBounds(particles, width, height);\n}\n\n// --- Render helpers ---\nfunction ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\nfunction heatToRGB(heat: number): { r: number; g: number; b: number } {\n  const t = clamp01(heat);\n  return { r: 255, g: Math.round(50 + 205 * t), b: 0 };\n}\n\nfunction setPixelBlock(\n  data: Uint8ClampedArray,\n  canvasWidth: number,\n  canvasHeight: number,\n  x: number,\n  y: number,\n  size: number,\n  r: number,\n  g: number,\n  b: number\n) {\n  for (let py = 0; py < size; py++) {\n    const yy = y + py;\n    if (yy >= canvasHeight) continue;\n\n    const rowBase = yy * canvasWidth * 4;\n    for (let px = 0; px < size; px++) {\n      const xx = x + px;\n      if (xx >= canvasWidth) continue;\n\n      const idx = rowBase + xx * 4;\n      data[idx + 0] = r;\n      data[idx + 1] = g;\n      data[idx + 2] = b;\n      data[idx + 3] = 255;\n    }\n  }\n}\n\nfunction influenceAtPoint(p: Particle, x: number, y: number, r2: number): number {\n  const dx = x - p.x;\n  const dy = y - p.y;\n  const distSq = dx * dx + dy * dy;\n  return r2 / (distSq + 1);\n}\n\nfunction drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number\n) {\n  const data = imageData.data;\n  data.fill(0);\n\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      for (let i = 0; i < particles.length; i++) {\n        const p = particles[i];\n        const influence = influenceAtPoint(p, x, y, r2);\n        influenceSum += influence;\n        heatWeightedSum += influence * p.heat;\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const { r, g, b } = heatToRGB(heat);\n\n      setPixelBlock(data, canvasWidth, canvasHeight, x, y, pixelSize, r, g, b);\n    }\n  }\n}\n\nfunction renderFrame(\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>\n) {\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n\n  ctx.fillStyle = \"#000\";\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n  drawMetaballs(imageData, particles, canvas.width, canvas.height);\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// --- Component ---\nexport default function LavaLamp(): ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n  const particleCountRef = useRef<number | null>(null);\n\n  const gameMusic = useMemo(() => new PersonalAudio(musicAudioNoise, true), []);\n  const clickSound = useMemo(() => new PersonalAudio(clickAudioNoise, false), []);\n\n  // No lava until first Start.\n  const [hasStarted, setHasStarted] = useState(false);\n  const [running, setRunning] = useState(false);\n\n  const pointerDownRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  const initializeParticlesOnce = useCallback(() => {\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n\n    if (particleCountRef.current === null) {\n      particleCountRef.current = computeParticleCount(w, h);\n    }\n\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n  }, []);\n\n  const saveMusicPosition = useCallback(() => {\n    // Persist even if paused/unmounted so we can resume after navigation.\n    writeSavedMusicTimeSeconds(gameMusic.currentTime ?? 0);\n  }, [gameMusic]);\n\n  // Periodically persist while the lamp is running (so back-navigation resumes close to where you left)\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    const tick = () => saveMusicPosition();\n    const id = window.setInterval(tick, 1000);\n\n    const onPageHide = () => saveMusicPosition();\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"hidden\") saveMusicPosition();\n    };\n\n    window.addEventListener(\"pagehide\", onPageHide);\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n\n    return () => {\n      window.clearInterval(id);\n      window.removeEventListener(\"pagehide\", onPageHide);\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    };\n  }, [hasStarted, saveMusicPosition]);\n\n  // Cleanup only (do NOT autoplay); persist time first\n  useEffect(() => {\n    return () => {\n      saveMusicPosition();\n\n      gameMusic.pause();\n      gameMusic.volume = 0;\n      gameMusic.reset();\n\n      clickSound.pause();\n      clickSound.volume = 0;\n      clickSound.reset();\n    };\n  }, [gameMusic, clickSound, saveMusicPosition]);\n\n  const update = useCallback(() => {\n    stepSimulationOnePairPass(\n      particlesRef.current,\n      window.innerWidth,\n      window.innerHeight,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    renderFrame(canvas, particlesRef.current, imageRef);\n  }, []);\n\n  const animate = useCallback(() => {\n    if (!running) return;\n    update();\n    draw();\n    rafRef.current = requestAnimationFrame(animate);\n  }, [running, update, draw]);\n\n  // Resize canvas only (no particle re-init, no drawing lava before start)\n  useEffect(() => {\n    const handleResize = () => {\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n      setCanvasToWindow(canvas);\n      imageRef.current = null;\n\n      if (hasStarted) draw();\n    };\n\n    handleResize();\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, [draw, hasStarted]);\n\n  // Start/stop RAF loop\n  useEffect(() => {\n    if (!running) {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n      return;\n    }\n\n    rafRef.current = requestAnimationFrame(animate);\n    return () => {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n  }, [running, animate]);\n\n  const playClick = useCallback(() => {\n    try {\n      clickSound.volume = 1.0;\n      clickSound.currentTime = 0;\n      clickSound.reset();\n      clickSound.play();\n    } catch {\n      // ignore\n    }\n  }, [clickSound]);\n\n  const resumeMusicFromSavedTime = useCallback(() => {\n    const t = readSavedMusicTimeSeconds();\n    try {\n      // If duration is known and we stored something past the end, wrap.\n      const duration = (gameMusic as any).duration as number | undefined;\n      if (typeof duration === \"number\" && Number.isFinite(duration) && duration > 0) {\n        gameMusic.currentTime = t % duration;\n      } else {\n        gameMusic.currentTime = t;\n      }\n    } catch {\n      // ignore\n    }\n  }, [gameMusic]);\n\n  const startLamp = useCallback(() => {\n    playClick();\n\n    if (!hasStarted) {\n      setHasStarted(true);\n      initializeParticlesOnce();\n      requestAnimationFrame(() => draw());\n    }\n\n    setRunning(true);\n\n    // gesture-driven: resume from last saved time, then play (looping via PersonalAudio ctor flag)\n    resumeMusicFromSavedTime();\n    gameMusic.volume = 1.0;\n    gameMusic.play();\n  }, [\n    draw,\n    gameMusic,\n    hasStarted,\n    initializeParticlesOnce,\n    playClick,\n    resumeMusicFromSavedTime,\n  ]);\n\n  // Old play/pause button behavior (after started)\n  const toggleRunning = useCallback(() => {\n    playClick();\n\n    setRunning((prev) => {\n      const next = !prev;\n\n      if (next) {\n        resumeMusicFromSavedTime();\n        gameMusic.volume = 1.0;\n        gameMusic.play();\n      } else {\n        saveMusicPosition();\n        gameMusic.pause();\n      }\n\n      return next;\n    });\n  }, [gameMusic, playClick, resumeMusicFromSavedTime, saveMusicPosition]);\n\n  const initialCanvasSize = useMemo(\n    () => ({ w: window.innerWidth, h: window.innerHeight }),\n    []\n  );\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n      />\n\n      {!hasStarted ? (\n        <div className=\"lava-lamp-start-overlay\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-start\"\n            onClick={startLamp}\n            aria-label=\"Start lava lamp\"\n          >\n            START\n          </button>\n        </div>\n      ) : (\n        <div className=\"lava-lamp-controls\">\n          <button className=\"lava-lamp-button\" onClick={toggleRunning}>\n            {running ? \"⏸\" : \"▶\"}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n","export class PersonalAudio extends Audio {\n  constructor(src, loop=false) {\n    super(src);\n    this.loop = loop;\n  };\n\n  isPlayingSrc = (audioSrc) => {\n    return this.src?.includes(audioSrc)\n        && this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  isPlaying = () => {\n    return this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  timeLeft = () => this.duration - this.currentTime;\n\n  reset = () => {\n    this.pause();\n    this.currentTime = 0;\n  };\n}"],"names":["SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","PIXEL_SIZE","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","BASELINE","WIDTH","HEIGHT","PARTICLES","MUSIC_TIME_KEY","clamp01","v","hypot2","dx","dy","Math","hypot","randInCircle","radius","angle","random","PI","r","x","cos","y","sin","bounceInBounds","p","width","height","vx","vy","stepSimulationOnePairPass","particles","pointerDown","pointerPos","neighborCounts","n","length","gravity","buoyancyK","friction","mouseR","mouseRInv","heatRate","coolRate","heatSrcDist","heatSrcDistInv","cohR","cohRInv","cohStrength","conductionK","pointerX","pointerY","i","buoyancy","heat","d","intensity","p1","j","p2","force","invD","fx","fy","conduction","distanceFromBottom","maxNeighbors","airExposure","clampAllToBounds","heatToRGB","t","g","round","b","setPixelBlock","data","canvasWidth","canvasHeight","size","py","yy","rowBase","px","xx","idx","influenceAtPoint","r2","renderFrame","canvas","imageRef","ctx","getContext","fillStyle","fillRect","imageData","img","current","createImageData","ensureImageData","fill","pixelSize","threshold","influenceSum","heatWeightedSum","influence","drawMetaballs","putImageData","LavaLamp","canvasRef","useRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","gameMusic","useMemo","PersonalAudio","musicAudioNoise","clickSound","clickAudioNoise","hasStarted","setHasStarted","useState","running","setRunning","pointerDownRef","pointerPosRef","initializeParticlesOnce","useCallback","w","window","innerWidth","h","innerHeight","baselineArea","currentArea","density","scaled","max","min","computeParticleCount","count","particlesPerClump","floor","centerX","centerY","clumpHeat","offset","push","createParticles","saveMusicPosition","_gameMusic$currentTim","seconds","Number","isFinite","localStorage","setItem","String","_unused2","writeSavedMusicTimeSeconds","currentTime","useEffect","id","setInterval","tick","onPageHide","onVisibilityChange","document","visibilityState","addEventListener","clearInterval","removeEventListener","pause","volume","reset","update","draw","animate","requestAnimationFrame","handleResize","setCanvasToWindow","cancelAnimationFrame","playClick","play","_unused3","resumeMusicFromSavedTime","raw","getItem","_unused","readSavedMusicTimeSeconds","duration","_unused4","startLamp","toggleRunning","prev","next","initialCanvasSize","_jsxs","className","children","_jsx","ref","onClick","type","Audio","constructor","src","loop","arguments","undefined","super","isPlayingSrc","audioSrc","_this$src","this","includes","paused","ended","readyState","isPlaying","timeLeft"],"sourceRoot":""}