"use strict";(self.webpackChunkpersonalsite=self.webpackChunkpersonalsite||[]).push([[4],{4854:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ne});var a=n(5043);const r=n.p+"static/media/power.632cc1e66922cf3fa35d93370ea84178.svg";var l=n(579);function s(e){let{nowPlaying:t,displayWaveform:n,expanded:r,onToggle:s}=e;const o=(0,a.useRef)(null),c=(0,a.useRef)(null),i=(0,a.useRef)(null),[u,d]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),[f,p]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{function e(e,t){if(!e.current)return;const n=e.current.querySelector(".scroll-wrapper"),a=e.current.clientWidth,r=n&&n.scrollWidth>a;if(t(!!r),r&&n){const t=n.scrollWidth/30,a=1;e.current.style.setProperty("--scroll-duration","".concat(t,"s")),e.current.style.setProperty("--second-copy-delay","".concat(a)),e.current.classList.add("overflowing")}else e.current.classList.remove("overflowing")}function t(){e(o,d),e(c,m),e(i,p)}return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}),[t,r]),t?(0,l.jsxs)("div",{className:"lava-lamp-now-playing ".concat(r?"expanded":"collapsed"),children:[(0,l.jsx)("button",{type:"button",className:"lava-lamp-now-playing-toggle",onClick:s,"aria-label":r?"Collapse now playing":"Expand now playing",children:r?">":"<"}),(0,l.jsxs)("div",{className:"lava-lamp-now-playing-content",children:[(0,l.jsxs)("div",{className:"lava-lamp-now-playing-header",children:[(0,l.jsx)("div",{className:"lava-lamp-now-playing-label",children:"kexp"}),!t.isAirbreak&&(0,l.jsx)("div",{className:"lava-lamp-soundwave",children:n.map(((e,t)=>(0,l.jsx)("div",{className:"lava-lamp-soundwave-bar",style:{"--bar-height":e}},t)))})]}),(0,l.jsxs)("div",{ref:o,className:"lava-lamp-now-playing-song",children:[(0,l.jsx)("span",{className:"scroll-wrapper",children:t.song}),u&&(0,l.jsx)("span",{className:"scroll-wrapper second",children:t.song})]}),!t.isAirbreak&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{ref:c,className:"lava-lamp-now-playing-artist",children:[(0,l.jsx)("span",{className:"scroll-wrapper",children:t.artist}),h&&(0,l.jsx)("span",{className:"scroll-wrapper second",children:t.artist})]}),(0,l.jsxs)("div",{ref:i,className:"lava-lamp-now-playing-album",children:[(0,l.jsx)("span",{className:"scroll-wrapper",children:t.album}),f&&(0,l.jsx)("span",{className:"scroll-wrapper second",children:t.album})]})]})]})]}):null}const o=n.p+"static/media/guitar.7c3177d2baeb887643cc.mp3",c=n.p+"static/media/click.1c87678ffc4ae6835e44.mp3",i=()=>{const e=navigator.userAgent||navigator.vendor||window.opera||"",t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),n="ontouchstart"in window||navigator.maxTouchPoints>0,a=window.innerWidth<=500;return t||n&&a},u=i(),d={REDWOOD:"redwood",KEXP:"kexp"},h="#ffdd00",m="#ff5500",f={GRAVITY:.01,BUOYANCY_BASE:.04,FRICTION:.98,HEAT_RATE_BASE:.005,COOL_RATE_BASE:.0017,HEAT_CONDUCTION:.002,HEAT_SOURCE_DISTANCE_BASE:45,COHESION_RADIUS_BASE:25,COHESION_STRENGTH:.0035,MOUSE_HEAT_RADIUS_BASE:100};function p(e){return f.COHESION_RADIUS_BASE*e}const v={PARTICLE_RADIUS_BASE:10,THRESHOLD:.8};function w(e,t){const n=e*t;return Math.sqrt(n/1288920)}const g={COUNT:15,RADIUS_BASE:u?30:50,TOP_HALF_PROB:.3};const y=u?54e-5:61e-5,x=2e3,A={MIN:0,MAX:5,DEFAULT:.25,STEPS:10},b=1e3/60,E=5,R="lava-lamp-music-time",S={[d.REDWOOD]:{label:"redwood meditation",url:o},[d.KEXP]:{label:"kexp",url:"https://kexp.streamguys1.com/kexp160.aac"}},C=c;function N(e){if(e<=0)return 0;const t=A.STEPS;if(e>=t)return A.MAX;const n=e/t,a=.25/A.MAX,r=Math.log(a),l=Math.log(A.MAX);return Math.exp(r+(l-r)*n)}function M(e,t,n){return n*e.cols+t}function j(e){let{speedIdx:t,setSpeedIdx:n,volume:s,setVolume:o,audioSource:c,setAudioSource:i,lavaLowColor:u,setLavaLowColor:d,lavaHighColor:f,setLavaHighColor:p,rainbowMode:v,setRainbowMode:w,isFullscreen:g,toggleFullscreen:y,isMobile:x}=e;const[b,E]=(0,a.useState)(!1),R=(0,a.useCallback)((()=>E((e=>!e))),[]),C=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(!b)return;const e=e=>{C.current&&!C.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[b]);const N=A.STEPS-1;return(0,l.jsxs)("div",{className:"lava-lamp-controls",ref:C,children:[(0,l.jsx)("button",{type:"button",className:"lava-lamp-menu-toggle",onClick:R,"aria-label":b?"Hide menu":"Show menu","aria-pressed":b,children:b?"\u2715":"\u2630"}),b&&(0,l.jsxs)("div",{className:"lava-lamp-menu",children:[(0,l.jsxs)("div",{className:"lava-lamp-control-block",children:[(0,l.jsx)("div",{className:"lava-lamp-control-header",children:(0,l.jsxs)("div",{className:"lava-lamp-control-title",children:["speed: ",t]})}),(0,l.jsx)("div",{className:"lava-lamp-slider-wrap",children:(0,l.jsx)("input",{className:"lava-lamp-slider",type:"range",min:0,max:N,step:1,value:t,onChange:e=>{return n((t=+e.target.value,r=N,t<(a=0)?a:t>r?r:t));var t,a,r},"aria-label":"Simulation speed"})})]}),(0,l.jsxs)("div",{className:"lava-lamp-control-block",children:[(0,l.jsx)("div",{className:"lava-lamp-control-header",children:(0,l.jsxs)("div",{className:"lava-lamp-control-title",children:["volume: ",Math.round(100*s),"%"]})}),(0,l.jsx)("div",{className:"lava-lamp-slider-wrap",children:(0,l.jsx)("input",{className:"lava-lamp-slider",type:"range",min:0,max:1,step:.01,value:s,onChange:e=>o(+e.target.value),"aria-label":"Music volume"})})]}),(0,l.jsxs)("div",{className:"lava-lamp-control-block",children:[(0,l.jsx)("div",{className:"lava-lamp-control-header",children:(0,l.jsx)("div",{className:"lava-lamp-control-title",children:"audio source"})}),(0,l.jsx)("div",{className:"lava-lamp-slider-wrap",children:(0,l.jsx)("select",{className:"lava-lamp-slider",value:c,onChange:e=>i(e.target.value),"aria-label":"Audio source",children:Object.entries(S).map((e=>{let[t,n]=e;return(0,l.jsx)("option",{value:t,children:n.label},t)}))})})]}),(0,l.jsxs)("div",{className:"lava-lamp-control-block",children:[(0,l.jsx)("div",{className:"lava-lamp-control-header",children:(0,l.jsx)("div",{className:"lava-lamp-control-title",children:"lava colors"})}),(0,l.jsx)("div",{className:"lava-lamp-slider-wrap",style:{marginBottom:12},children:(0,l.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[(0,l.jsx)("input",{type:"checkbox",className:"lava-lamp-checkbox",checked:v,onChange:e=>w(e.target.checked)}),(0,l.jsx)("span",{style:{fontSize:13,opacity:.9},children:"rainbow drift mode"})]})}),(0,l.jsxs)("div",{className:"lava-lamp-color-row",children:[(0,l.jsxs)("label",{className:"lava-lamp-color-label",children:["hot",(0,l.jsx)("input",{className:"lava-lamp-color-input",type:"color",value:f,onChange:e=>{p(e.target.value),w(!1)},disabled:v,"aria-label":"Lava high color"})]}),(0,l.jsxs)("label",{className:"lava-lamp-color-label",children:["cool",(0,l.jsx)("input",{className:"lava-lamp-color-input",type:"color",value:u,onChange:e=>{d(e.target.value),w(!1)},disabled:v,"aria-label":"Lava low color"})]}),(0,l.jsx)("button",{type:"button",className:"lava-lamp-color-reset",onClick:()=>{d(m),p(h),w(!1)},disabled:v,children:"reset"})]})]}),!x&&(0,l.jsx)("div",{className:"lava-lamp-control-block",children:(0,l.jsx)("div",{className:"lava-lamp-slider-wrap",children:(0,l.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[(0,l.jsx)("input",{type:"checkbox",className:"lava-lamp-checkbox",checked:g,onChange:y}),(0,l.jsx)("span",{style:{fontSize:13,opacity:.9},children:"fullscreen mode"})]})})}),(0,l.jsx)("div",{className:"lava-lamp-control-block",children:(0,l.jsxs)("button",{type:"button",className:"lava-lamp-power-off",onClick:()=>window.location.reload(),"aria-label":"Power off",children:[(0,l.jsx)("img",{src:r,alt:"Power off",className:"lava-lamp-power-off-icon"}),(0,l.jsx)("span",{children:"power off"})]})})]})]})}var L=n(7375);class k{constructor(){this.audioContext=null,this.analyser=null,this.dataArray=null,this.connected=!1}connect(e){if(this.connected)return!0;try{this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=256,this.analyser.smoothingTimeConstant=.95;return this.audioContext.createMediaElementSource(e).connect(this.analyser).connect(this.audioContext.destination),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),this.connected=!0,!0}catch(t){return console.warn("[AudioAmplitude] Failed to connect analyser:",t),!1}}getAmplitude(){if(!this.analyser||!this.dataArray)return 0;try{this.analyser.getByteTimeDomainData(this.dataArray);let e=0;for(let n=0;n<this.dataArray.length;n++){const t=(this.dataArray[n]-128)/128;e+=t*t}const t=Math.sqrt(e/this.dataArray.length);return Math.min(1,3*t)}catch(e){return console.warn("[AudioAmplitude] Error reading amplitude:",e),0}}getWaveformBars(e){if(!this.analyser||!this.dataArray)return new Array(e).fill(0);try{this.analyser.getByteTimeDomainData(this.dataArray);const t=[],n=Math.floor(this.dataArray.length/e);for(let a=0;a<e;a++){const e=a*n,r=Math.abs((this.dataArray[e]-128)/128);t.push(Math.min(1,1.2*r))}return t}catch(t){return console.warn("[AudioAmplitude] Error reading waveform:",t),new Array(e).fill(0)}}resume(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().catch((e=>{console.warn("[AudioAmplitude] Failed to resume audio context:",e)}))}disconnect(){this.audioContext&&(this.audioContext.close().catch((()=>{})),this.audioContext=null),this.analyser=null,this.dataArray=null,this.connected=!1}isConnected(){return this.connected}}function T(e){const[t,n]=(0,a.useState)(d.KEXP),[r,l]=(0,a.useState)(1),s=(0,a.useMemo)((()=>{const e=new L.D(S[d.KEXP].url,!0);return e.preload="auto",e}),[]),o=(0,a.useMemo)((()=>new L.D(C,!1)),[]),c=(0,a.useRef)(null),i=(0,a.useRef)(Array(10).fill(0)),[u,h]=(0,a.useState)(Array(10).fill(0)),m=(0,a.useRef)(0);(0,a.useEffect)((()=>{s.volume=r}),[r,s]);const f=(0,a.useRef)(!0);(0,a.useEffect)((()=>{if(f.current)return void(f.current=!1);const e=S[t],n=s.isPlaying();if(n&&s.pause(),s.src=e.url,s.load(),n){const e=()=>{s.play().catch((()=>{})),s.removeEventListener("canplaythrough",e)};s.addEventListener("canplaythrough",e,{once:!0})}}),[t,s]);const p=(0,a.useCallback)((()=>{var e;!function(e){try{if(!Number.isFinite(e)||e<0)return;localStorage.setItem(R,String(e))}catch(t){}}(null!==(e=s.currentTime)&&void 0!==e?e:0)}),[s]);(0,a.useEffect)((()=>{if(!e)return;const t=window.setInterval(p,1e3),n=()=>p(),a=()=>{"hidden"===document.visibilityState&&p()};return window.addEventListener("pagehide",n),document.addEventListener("visibilitychange",a),()=>{clearInterval(t),window.removeEventListener("pagehide",n),document.removeEventListener("visibilitychange",a)}}),[e,p]),(0,a.useEffect)((()=>()=>{var e;p(),s.pause(),s.volume=0,s.reset(),o.pause(),o.volume=0,o.reset(),null===(e=c.current)||void 0===e||e.disconnect(),c.current=null}),[s,o,p]);const v=(0,a.useCallback)((()=>{try{o.volume=1,o.currentTime=0,o.reset(),o.play()}catch(e){}}),[o]),w=(0,a.useCallback)((()=>{const e=function(){try{const e=localStorage.getItem(R);if(!e)return 0;const t=Number(e);return Number.isFinite(t)&&t>=0?t:0}catch(e){return 0}}();try{const t=s.duration;s.currentTime="number"===typeof t&&Number.isFinite(t)&&t>0?e%t:e}catch(t){}}),[s]),g=(0,a.useCallback)((()=>{c.current&&(i.current=c.current.getWaveformBars(10),++m.current>=5&&(h(i.current),m.current=0))}),[]),y=(0,a.useCallback)((()=>{if(!c.current){const e=new k;e.connect(s)&&(c.current=e)}}),[s]),x=(0,a.useCallback)((()=>{var e;null===(e=c.current)||void 0===e||e.resume()}),[]);return{audioSource:t,setAudioSource:n,volume:r,setVolume:l,gameMusic:s,clickSound:o,displayWaveform:u,amplitudeAnalyzerRef:c,playClick:v,resumeMusicFromSavedTime:w,updateWaveform:g,initializeAmplitudeAnalyzer:y,resumeAmplitudeAnalyzer:x}}function I(e){let t=e;return"#"===t[0]&&(t=t.slice(1)),6===t.length?{r:16*_(t[0])+_(t[1]),g:16*_(t[2])+_(t[3]),b:16*_(t[4])+_(t[5])}:3===t.length?{r:17*_(t[0]),g:17*_(t[1]),b:17*_(t[2])}:{r:255,g:221,b:0}}function _(e){const t=e.charCodeAt(0);return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:0}function O(e,t,n){const a=t*Math.min(n,1-n);function r(t){const r=(t+e/30)%12,l=n-a*Math.max(Math.min(r-3,9-r,1),-1);let s=Math.round(255*l);return s=s<0?0:s>255?255:s,function(e){return e<16?"0"+e.toString(16):e.toString(16)}(s)}return"#".concat(r(0)).concat(r(8)).concat(r(4))}function P(e){const{r:t,g:n,b:a}=I(e),r=.00392156862745098*t,l=.00392156862745098*n,s=.00392156862745098*a,o=r>l?r>s?r:s:l>s?l:s,c=o-(r<l?r<s?r:s:l<s?l:s);if(c<1e-6)return 0;let i;return i=o===r?(l-s)/c%6:o===l?(s-r)/c+2:(r-l)/c+4,i=Math.round(60*i),i<0&&(i+=360),i}function D(e,t){const n=I(e),a=I(t),r=new Uint32Array(256),l=n.r,s=a.r,o=n.g,c=a.g,i=n.b,u=a.b;for(let d=0;d<256;++d){const e=.00392156862745098*d,t=l+(s-l)*e+.5|0,n=o+(c-o)*e+.5|0,a=i+(u-i)*e+.5|0;r[d]=(255<<24|a<<16|n<<8|t)>>>0}return r}function F(e){return e<0?0:e>1?1:e}function H(e){const t=Math.random()*Math.PI*2,n=Math.random()*e;return{x:Math.cos(t)*n,y:Math.sin(t)*n}}function B(e,t,n){e.x<0?(e.x=0,e.vx*=-.5):e.x>t&&(e.x=t,e.vx*=-.5),e.y<0?(e.y=0,e.vy*=-.5):e.y>n&&(e.y=n,e.vy*=-.5)}function U(e,t,n){for(let a=0;a<e.length;a++)B(e[a],t,n)}function z(e,t,n,a){const r=[],l=Math.floor(n/g.COUNT),s=function(e){return g.RADIUS_BASE*e}(a);for(let o=0;o<g.COUNT;o++){const n=Math.random()*e,a=Math.random()<g.TOP_HALF_PROB?Math.random()*t*.5:.5*t+Math.random()*t*.5,o=Math.random();for(let e=0;e<l;e++){const e=H(s);r.push({x:n+e.x,y:a+e.y,vx:0,vy:0,heat:o})}}for(;r.length<n;)r.push({x:Math.random()*e,y:Math.random()*t,vx:0,vy:0,heat:0});return r}function W(e,t,n){const a=e.heat*e.heat*n;e.vy+=(f.GRAVITY-a)*t}function q(e,t){const n=Math.pow(f.FRICTION,t);e.vx*=n,e.vy*=n}function X(e,t){e.x+=e.vx*t,e.y+=e.vy*t}function K(e,t,n,a,r){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const s=e.x-t.x,o=e.y-t.y,c=s*s+o*o,i=function(e){return f.MOUSE_HEAT_RADIUS_BASE*e}(a);if(c<i*i){const t=10*r*(1-Math.sqrt(c)*(1/i))*n;e.heat+=l?-t:t}}function Y(e,t,n,a,r,l,s){const o=f.COHESION_STRENGTH*(1-r*(1/s)),c=1/r,i=n*c*o*l,u=a*c*o*l;e.vx+=i,e.vy+=u,t.vx-=i,t.vy-=u}function V(e,t,n){const a=(e.heat-t.heat)*f.HEAT_CONDUCTION*n;e.heat-=a,t.heat+=a}function G(e,t,n,a,r,l){const s=t-e.y,o=function(e){return f.HEAT_SOURCE_DISTANCE_BASE*e}(r);if(s<o){const t=1-s*(1/o);return void(e.heat+=l*t*a)}const c=1-(n<8?n:8)/8,i=function(e){return f.COOL_RATE_BASE*e}(r);e.heat-=i*(.2+.8*c)*a}function J(e,t,n,a,r,l,s,o){let c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const i=Math.max(0,Math.min(4,s)),u=w(t,n),d=p(u),h=function(e){return f.BUOYANCY_BASE*e}(u),m=function(e){return f.HEAT_RATE_BASE*e}(u);for(let f=0;f<e.length;f++){const s=e[f];W(s,i,h),q(s,i),X(s,i),a&&K(s,r,i,u,m,c),l[f]=0,B(s,t,n)}if(0===i){for(let t=0;t<e.length;t++)e[t].heat=F(e[t].heat);return void U(e,t,n)}o.heads.fill(-1);const v=1/o.cellSize;for(let f=0;f<e.length;f++){const t=e[f];let n=t.x*v|0,a=t.y*v|0;n<0?n=0:n>=o.cols&&(n=o.cols-1),a<0?a=0:a>=o.rows&&(a=o.rows-1);const r=M(o,n,a);o.next[f]=o.heads[r],o.heads[r]=f}const g=d*d;for(let f=0;f<e.length;f++){const t=e[f];let n=t.x*v|0,a=t.y*v|0;n<0?n=0:n>=o.cols&&(n=o.cols-1),a<0?a=0:a>=o.rows&&(a=o.rows-1);const r=n>0?n-1:n,s=n+1<o.cols?n+1:n,c=a>0?a-1:a,u=a+1<o.rows?a+1:a;for(let h=c;h<=u;h++)for(let n=r;n<=s;n++){let a=o.heads[M(o,n,h)];for(;-1!==a;){if(a>f){const n=e[a],r=n.x-t.x,s=n.y-t.y,o=r*r+s*s;if(o>0&&o<g){l[f]++,l[a]++;Y(t,n,r,s,Math.sqrt(o),i,d),V(t,n,i)}}a=o.next[a]}}}for(let f=0;f<e.length;f++){const t=e[f];G(t,n,l[f],i,u,m),t.heat=F(t.heat)}U(e,t,n)}const Q=(255<<24|0<<16|0<<8|0)>>>0;function Z(e,t,n,a,r,l,s){const o=Math.min(n+a,l),c=Math.min(t+a,r);for(let i=n;i<o;i++){let n=i*r+t;for(let a=t;a<c;a++)e[n++]=s}}function $(e,t,n,a,r,l){const s=v.THRESHOLD,o=function(e){return v.PARTICLE_RADIUS_BASE*e}(w(n,a)),c=o*o,i=new Uint32Array(e.data.buffer);i.fill(Q);const u=n,d=a;for(let h=0;h<d;h+=l)for(let e=0;e<u;e+=l){let n=0,a=0;for(let r=0;r<t.length;++r){const l=t[r],s=e-l.x,o=h-l.y,i=c/(s*s+o*o+1);n+=i,a+=i*l.heat}if(n<=s)continue;const o=a/n;Z(i,e,h,l,u,d,r[o<=0?0:o>=1?255:255*o|0])}}function ee(e,t,n,a,r){const l=function(e,t,n,a){const r=t.current;return r&&r.width===n&&r.height===a||(t.current=e.createImageData(n,a)),t.current}(e,a,t.width,t.height),s=function(e,t){const n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:8)*w(e,t);return Math.max(4,Math.min(24,Math.round(n)))}(t.width,t.height);$(l,n,t.width,t.height,r,s),e.putImageData(l,0,0)}function te(e){let{canvasRef:t,ctxRef:n,pointerDownRef:r,pointerCoolingRef:l,pointerPosRef:s,speedRef:o,heatLutRef:c,updateWaveform:i}=e;const u=(0,a.useRef)([]),d=(0,a.useRef)(null),h=(0,a.useRef)(new Uint16Array(0)),m=(0,a.useRef)(null),f=(0,a.useRef)(null),v=(0,a.useRef)({w:1,h:1}),g=(0,a.useRef)(null),A=(0,a.useRef)({last:0,acc:0});(0,a.useEffect)((()=>{const e=t.current;if(!e)return;const a=window.innerWidth,r=window.innerHeight;v.current={w:a,h:r},e.width=a,e.height=r,n.current=e.getContext("2d"),d.current=null}),[t,n]);const R=(0,a.useCallback)((()=>{const{w:e,h:t}=v.current;null===m.current&&(m.current=function(e,t){const n=e*t,a=w(e,t),r=Math.round(n*y/(a*a));return Math.min(r,x)}(e,t));const n=m.current,a=w(e,t);u.current=z(e,t,n,a),h.current=new Uint16Array(n);const r=p(a);!function(e,t,n,a,r){const l=Math.max(1,Math.ceil(t/r)),s=Math.max(1,Math.ceil(n/r)),o=l*s,c=e.current;c&&c.cols===l&&c.rows===s&&c.cellSize===r&&c.next.length===a&&c.heads.length===o||(e.current={cellSize:r,cols:l,rows:s,heads:new Int32Array(o),next:new Int32Array(a)})}(f,e,t,n,r)}),[]),S=(0,a.useCallback)((()=>{const e=f.current,{w:t,h:n}=v.current;e&&J(u.current,t,n,r.current,s.current,h.current,o.current,e,l.current)}),[r,s,o,l]),C=(0,a.useCallback)((()=>{const e=t.current,a=n.current;e&&a&&ee(a,e,u.current,d,c.current)}),[t,n,c]),N=(0,a.useCallback)((e=>{const t=A.current;t.last||(t.last=e);let n=e-t.last;t.last=e,t.acc+=Math.min(250,Math.max(0,n));let a=0;for(;t.acc>=b&&a<E;)S(),t.acc-=b,a++;t.acc>=b&&(t.acc=0),i(),C(),g.current=requestAnimationFrame(N)}),[C,S,i]),M=(0,a.useCallback)((()=>{R(),A.current={last:0,acc:0},requestAnimationFrame((()=>C())),g.current=requestAnimationFrame(N)}),[R,C,N]);return(0,a.useEffect)((()=>()=>{null!==g.current&&cancelAnimationFrame(g.current)}),[]),{particlesRef:u,sizeRef:v,imageRef:d,startSimulation:M}}function ne(){const e=i(),t=(0,a.useRef)(null),n=(0,a.useRef)(null),[o,c]=(0,a.useState)(!1),u=(0,a.useMemo)((()=>function(e){if(e<=0)return 0;const t=A.STEPS-1;let n=1,a=1/0;const r=Math.log(e);for(let l=1;l<=t;l++){const e=N(l),t=Math.abs(Math.log(e)-r);t<a&&(a=t,n=l)}return n}(A.DEFAULT)),[]),[f,p]=(0,a.useState)(u),v=(0,a.useRef)(A.DEFAULT);(0,a.useEffect)((()=>{v.current=N(f)}),[f]);const{audioSource:w,setAudioSource:g,volume:y,setVolume:x,gameMusic:b,displayWaveform:E,playClick:R,resumeMusicFromSavedTime:S,updateWaveform:C,initializeAmplitudeAnalyzer:M,resumeAmplitudeAnalyzer:L}=T(o),{lavaLowColor:k,setLavaLowColor:I,lavaHighColor:_,setLavaHighColor:F,rainbowMode:H,setRainbowMode:B,heatLutRef:z}=function(e){const[t,n]=(0,a.useState)(m),[r,l]=(0,a.useState)(h),[s,o]=(0,a.useState)(!1),c=(0,a.useRef)(D(m,h)),i=(0,a.useRef)(m),u=(0,a.useRef)(h);(0,a.useEffect)((()=>{i.current=t,u.current=r,c.current=D(t,r)}),[t,r]);const d=(0,a.useRef)(0),f=(0,a.useRef)(0),p=(0,a.useRef)(!1);return(0,a.useEffect)((()=>{s&&!p.current&&(d.current=P(t),f.current=P(r)),p.current=s}),[s,t,r]),(0,a.useEffect)((()=>{if(!s)return;let t,a=performance.now();const r=s=>{const o=s-a;a=s;const c=e.current,i=o/16.67;d.current=(d.current+.02*c*i)%360,f.current=(f.current+.02*c*i*1.3)%360,n(O(d.current,1,.5)),l(O(f.current,1,.5)),t=requestAnimationFrame(r)};return t=requestAnimationFrame(r),()=>cancelAnimationFrame(t)}),[s,e]),{lavaLowColor:t,setLavaLowColor:n,lavaHighColor:r,setLavaHighColor:l,rainbowMode:s,setRainbowMode:o,heatLutRef:c}}(v),{pointerDownRef:W,pointerCoolingRef:q,pointerPosRef:X}=function(e){const t=(0,a.useRef)(!1),n=(0,a.useRef)(!1),r=(0,a.useRef)({x:0,y:0});return(0,a.useEffect)((()=>{const a=e.current;if(!a)return;const l=e=>{const t=a.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}},s=e=>{t.current=!0,n.current=2===e.button||0===e.button&&e.ctrlKey,r.current=l(e)},o=e=>r.current=l(e),c=()=>{t.current=!1,n.current=!1};return a.addEventListener("pointerdown",s),a.addEventListener("contextmenu",(e=>e.preventDefault())),window.addEventListener("pointermove",o),window.addEventListener("pointerup",c),window.addEventListener("pointercancel",c),()=>{a.removeEventListener("pointerdown",s),window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",c),window.removeEventListener("pointercancel",c)}}),[e]),{pointerDownRef:t,pointerCoolingRef:n,pointerPosRef:r}}(t),{particlesRef:K,sizeRef:Y,imageRef:V,startSimulation:G}=te({canvasRef:t,ctxRef:n,pointerDownRef:W,pointerCoolingRef:q,pointerPosRef:X,speedRef:v,heatLutRef:z,updateWaveform:C}),{isFullscreen:J,toggleFullscreen:Q}=function(e){let{canvasRef:t,particlesRef:n,sizeRef:r,imageRef:l}=e;const[s,o]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=()=>{o(!!document.fullscreenElement),document.body.classList.toggle("lava-lamp-fullscreen",!!document.fullscreenElement);const e=t.current;if(e){const t=window.innerWidth,a=window.innerHeight;e.width=t,e.height=a,r.current={w:t,h:a},l.current=null,n.current&&U(n.current,t,a)}};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e),document.body.classList.remove("lava-lamp-fullscreen")}}),[t,n,r,l]),{isFullscreen:s,toggleFullscreen:(0,a.useCallback)((()=>{var e,t,n,a;document.fullscreenElement?null===(e=(t=document).exitFullscreen)||void 0===e||e.call(t):null===(n=(a=document.documentElement).requestFullscreen)||void 0===n||n.call(a).catch((()=>{}))}),[])}}({canvasRef:t,particlesRef:K,sizeRef:Y,imageRef:V}),{nowPlaying:Z,nowPlayingExpanded:$,setNowPlayingExpanded:ee}=function(e,t){const[n,r]=(0,a.useState)(null),[l,s]=(0,a.useState)(!0);return(0,a.useEffect)((()=>{if(!e||t!==d.KEXP)return void r(null);let n;const a=async()=>{try{var e;const t=null===(e=(await(await fetch("https://api.kexp.org/v2/plays/?limit=5")).json()).results)||void 0===e?void 0:e[0];if(!t)return;"airbreak"===t.play_type?r({song:"airbreak",artist:"",album:"",isAirbreak:!0}):"trackplay"===t.play_type&&r({song:(t.song||"unknown track").toLowerCase(),artist:(t.artist||"unknown artist").toLowerCase(),album:(t.album||"unknown album").toLowerCase(),isAirbreak:!1})}catch(t){}};return a(),n=window.setInterval(a,5e3),()=>clearInterval(n)}),[e,t]),{nowPlaying:n,nowPlayingExpanded:l,setNowPlayingExpanded:s}}(o,w),ne=(0,a.useCallback)((async()=>{if(R(),o||(c(!0),G(),M()),L(),w!==d.KEXP&&S(),b.volume=1,b.readyState<3){b.load();const e=async()=>{try{await b.play()}catch(t){}b.removeEventListener("canplaythrough",e)};b.addEventListener("canplaythrough",e,{once:!0})}else try{await b.play()}catch(e){}}),[R,o,G,M,L,w,S,b]),ae=(0,a.useMemo)((()=>({w:window.innerWidth,h:window.innerHeight})),[]);return(0,l.jsxs)("div",{className:"lava-lamp-container",children:[(0,l.jsx)("canvas",{ref:t,className:"lava-lamp-canvas",width:ae.w,height:ae.h}),(0,l.jsx)(s,{nowPlaying:Z,displayWaveform:E,expanded:$,onToggle:()=>ee((e=>!e))}),o?(0,l.jsx)(j,{speedIdx:f,setSpeedIdx:p,volume:y,setVolume:x,audioSource:w,setAudioSource:g,lavaLowColor:k,setLavaLowColor:I,lavaHighColor:_,setLavaHighColor:F,rainbowMode:H,setRainbowMode:B,isFullscreen:J,toggleFullscreen:Q,isMobile:e}):(0,l.jsx)("div",{className:"lava-lamp-start-overlay",children:(0,l.jsx)("button",{type:"button",className:"lava-lamp-start",onClick:ne,"aria-label":"Start lava lamp radio",children:(0,l.jsx)("img",{src:r,alt:"Power",className:"lava-lamp-start-icon"})})})]})}},7375:(e,t,n)=>{n.d(t,{D:()=>a});class a extends Audio{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(e),this.isPlayingSrc=e=>{var t;return(null===(t=this.src)||void 0===t?void 0:t.includes(e))&&this.currentTime>0&&!this.paused&&!this.ended&&this.readyState>2},this.isPlaying=()=>this.currentTime>0&&!this.paused&&!this.ended&&this.readyState>2,this.timeLeft=()=>this.duration-this.currentTime,this.reset=()=>{this.pause(),this.currentTime=0},this.loop=t,this.crossOrigin="anonymous"}}}}]);
//# sourceMappingURL=4.3dfdcb33.chunk.js.map