{"version":3,"file":"static/js/200.482a30a7.chunk.js","mappings":"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","sources":["lava_lamp/LavaLamp.tsx","util/Audio.js"],"sourcesContent":["import React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport \"../styles/lavalamp.css\";\n\nimport musicAudioNoise from \"../assets/lavaLamp/guitar.mp3\";\nimport clickAudioNoise from \"../assets/lavaLamp/click.mp3\";\nimport { PersonalAudio } from \"../util/Audio\";\n\n// --- Audio sources ---\nconst AUDIO_SOURCES = {\n  REDWOOD: \"redwood\",\n  KEXP: \"kexp\",\n} as const;\n\ntype AudioSource = typeof AUDIO_SOURCES[keyof typeof AUDIO_SOURCES];\n\nconst AUDIO_SOURCE_CONFIG: Record<AudioSource, { label: string; url: string }> = {\n  [AUDIO_SOURCES.REDWOOD]: {\n    label: \"redwood meditation\",\n    url: musicAudioNoise,\n  },\n  [AUDIO_SOURCES.KEXP]: {\n    label: \"KEXP\",\n    url: \"https://kexp.streamguys1.com/kexp160.aac\",\n  },\n};\n\n// --- Colors: keep state (for controlled inputs) + refs (fast access elsewhere) ---\nconst DEFAULT_HIGH = \"#ffdd00\";\nconst DEFAULT_LOW = \"#ff5500\";\n\n// --- Types ---\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  heat: number; // [0..1]\n}\n\ntype Vec2 = { x: number; y: number };\n\ntype SpatialGrid = {\n  cellSize: number;\n  cols: number;\n  rows: number;\n  heads: Int32Array; // length cols*rows, head index or -1\n  next: Int32Array; // length particleCount, next index or -1\n};\n\n// --- Constants ---\nconst SIM = {\n  GRAVITY: 0.01,\n  BUOYANCY: 0.04,\n  FRICTION: 0.98,\n\n  HEAT_RATE: 0.005,\n  COOL_RATE: 0.0017,\n  HEAT_CONDUCTION: 0.002,\n\n  HEAT_SOURCE_DISTANCE: 45,\n\n  COHESION_RADIUS: 25,\n  COHESION_STRENGTH: 0.0035,\n\n  MOUSE_HEAT_RADIUS: 100,\n} as const;\n\nconst RENDER = {\n  PARTICLE_RADIUS: 10,\n  PIXEL_SIZE: 6,\n  THRESHOLD: 0.8,\n} as const;\n\nconst CLUMPS = {\n  COUNT: 15,\n  RADIUS: 50,\n  TOP_HALF_PROB: 0.3,\n} as const;\n\n// Baseline density: preserves \"look\" across screens, computed once per page load.\nconst BASELINE = {\n  WIDTH: 1920,\n  HEIGHT: 1080,\n  PARTICLES: 1200,\n} as const;\n\n// --- Speed control (indexed slider) ---\nconst SPEED = {\n  MIN: 0.0,\n  MAX: 5,\n  DEFAULT: 0.25,\n  STEPS: 10, // number of discrete positions\n} as const;\n\n// --- Fixed update rate (independent of render cost / screen size) ---\nconst FIXED_FPS = 60;\nconst FIXED_MS = 1000 / FIXED_FPS;\nconst MAX_CATCHUP_STEPS = 4;\n\n// --- Persisted audio position ---\nconst MUSIC_TIME_KEY = \"lavaLamp.musicTimeSeconds\";\n\n// --- Utils ---\nfunction clamp01(v: number): number {\n  return v < 0 ? 0 : v > 1 ? 1 : v;\n}\n\nfunction clampInt(v: number, lo: number, hi: number) {\n  return v < lo ? lo : v > hi ? hi : v;\n}\n\nfunction lerp(a: number, b: number, t: number) {\n  return a + (b - a) * t;\n}\n\nfunction lerpInt(a: number, b: number, t: number): number {\n  const v = a + (b - a) * t;\n  return v < 0 ? 0 : v > 255 ? 255 : Math.round(v);\n}\n\nfunction randInCircle(radius: number): Vec2 {\n  const angle = Math.random() * Math.PI * 2;\n  const r = Math.random() * radius;\n  return { x: Math.cos(angle) * r, y: Math.sin(angle) * r };\n}\n\nfunction bounceInBounds(p: Particle, width: number, height: number) {\n  if (p.x < 0) {\n    p.x = 0;\n    p.vx *= -0.5;\n  } else if (p.x > width) {\n    p.x = width;\n    p.vx *= -0.5;\n  }\n\n  if (p.y < 0) {\n    p.y = 0;\n    p.vy *= -0.5;\n  } else if (p.y > height) {\n    p.y = height;\n    p.vy *= -0.5;\n  }\n}\n\nfunction clampAllToBounds(particles: Particle[], width: number, height: number) {\n  for (let i = 0; i < particles.length; i++) {\n    bounceInBounds(particles[i], width, height);\n  }\n}\n\nfunction computeParticleCount(width: number, height: number): number {\n  const baselineArea = BASELINE.WIDTH * BASELINE.HEIGHT;\n  const currentArea = width * height;\n\n  const density = BASELINE.PARTICLES / baselineArea;\n  const scaled = Math.round(currentArea * density);\n\n  return Math.max(200, Math.min(2000, scaled));\n}\n\nfunction readSavedMusicTimeSeconds(): number {\n  try {\n    const raw = localStorage.getItem(MUSIC_TIME_KEY);\n    if (!raw) return 0;\n    const v = Number(raw);\n    return Number.isFinite(v) && v >= 0 ? v : 0;\n  } catch {\n    return 0;\n  }\n}\n\nfunction writeSavedMusicTimeSeconds(seconds: number) {\n  try {\n    if (!Number.isFinite(seconds) || seconds < 0) return;\n    localStorage.setItem(MUSIC_TIME_KEY, String(seconds));\n  } catch {\n    // ignore\n  }\n}\n\n// Note: MIN=0 is special; idx 0 => frozen-ish. idx 1..(STEPS-1) => (0..MAX] in log space.\nfunction indexToSpeed(idx: number): number {\n  if (idx <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  if (idx >= steps) return SPEED.MAX;\n\n  // normalized position excluding 0\n  const t = idx / steps; // idx=steps/2 => midpoint\n\n  // calibrated so midpoint ≈ 0.5\n  const targetMidSpeed = 0.5;\n  const minPositive = (targetMidSpeed * targetMidSpeed) / SPEED.MAX;\n\n  const minLog = Math.log(minPositive);\n  const maxLog = Math.log(SPEED.MAX);\n\n  return Math.exp(lerp(minLog, maxLog, t));\n}\n\nfunction speedToNearestIndex(speed: number): number {\n  if (speed <= 0) return 0;\n\n  const steps = SPEED.STEPS;\n  const last = steps - 1;\n\n  let best = 1;\n  let bestErr = Infinity;\n  const target = Math.log(speed);\n\n  for (let i = 1; i <= last; i++) {\n    const s = indexToSpeed(i);\n    const err = Math.abs(Math.log(s) - target);\n    if (err < bestErr) {\n      bestErr = err;\n      best = i;\n    }\n  }\n  return best;\n}\n\n// --- Color / LUT ---\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } {\n  const h = hex.trim().replace(\"#\", \"\");\n  if (h.length === 3) {\n    const r = parseInt(h[0] + h[0], 16);\n    const g = parseInt(h[1] + h[1], 16);\n    const b = parseInt(h[2] + h[2], 16);\n    return { r, g, b };\n  }\n  if (h.length === 6) {\n    const r = parseInt(h.slice(0, 2), 16);\n    const g = parseInt(h.slice(2, 4), 16);\n    const b = parseInt(h.slice(4, 6), 16);\n    return { r, g, b };\n  }\n  return { r: 255, g: 221, b: 0 };\n}\n\nfunction packRgba(r: number, g: number, b: number, a: number): number {\n  // Uint32Array view over ImageData.data.buffer (common little-endian fast path).\n  return (a << 24) | (b << 16) | (g << 8) | r;\n}\n\nfunction buildHeatLut256(lowHex: string, highHex: string): Uint32Array {\n  const lo = hexToRgb(lowHex);\n  const hi = hexToRgb(highHex);\n\n  const lut = new Uint32Array(256);\n  for (let i = 0; i < 256; i++) {\n    const t = i / 255;\n    const r = lerpInt(lo.r, hi.r, t);\n    const g = lerpInt(lo.g, hi.g, t);\n    const b = lerpInt(lo.b, hi.b, t);\n    lut[i] = packRgba(r, g, b, 255);\n  }\n  return lut;\n}\n\n// --- Spatial grid helpers ---\nfunction ensureGrid(\n  gridRef: React.MutableRefObject<SpatialGrid | null>,\n  width: number,\n  height: number,\n  count: number,\n  cellSize: number\n) {\n  const cols = Math.max(1, Math.ceil(width / cellSize));\n  const rows = Math.max(1, Math.ceil(height / cellSize));\n  const cells = cols * rows;\n\n  const g = gridRef.current;\n  if (\n    !g ||\n    g.cols !== cols ||\n    g.rows !== rows ||\n    g.cellSize !== cellSize ||\n    g.next.length !== count ||\n    g.heads.length !== cells\n  ) {\n    gridRef.current = {\n      cellSize,\n      cols,\n      rows,\n      heads: new Int32Array(cells),\n      next: new Int32Array(count),\n    };\n  }\n}\n\nfunction gridIndex(g: SpatialGrid, cx: number, cy: number): number {\n  return cy * g.cols + cx;\n}\n\n// --- Init ---\nfunction createParticles(width: number, height: number, count: number): Particle[] {\n  const particles: Particle[] = [];\n  const particlesPerClump = Math.floor(count / CLUMPS.COUNT);\n\n  for (let i = 0; i < CLUMPS.COUNT; i++) {\n    const centerX = Math.random() * width;\n    const centerY =\n      Math.random() < CLUMPS.TOP_HALF_PROB\n        ? Math.random() * height * 0.5\n        : height * 0.5 + Math.random() * height * 0.5;\n\n    const clumpHeat = Math.random();\n    for (let j = 0; j < particlesPerClump; j++) {\n      const offset = randInCircle(CLUMPS.RADIUS);\n      particles.push({\n        x: centerX + offset.x,\n        y: centerY + offset.y,\n        vx: 0,\n        vy: 0,\n        heat: clumpHeat,\n      });\n    }\n  }\n\n  while (particles.length < count) {\n    particles.push({\n      x: Math.random() * width,\n      y: Math.random() * height,\n      vx: 0,\n      vy: 0,\n      heat: 0,\n    });\n  }\n\n  return particles;\n}\n\n// --- Physics (grid-accelerated cohesion/conduction) ---\nexport function stepSimulationOnePairPass(\n  particles: Particle[],\n  width: number,\n  height: number,\n  pointerDown: boolean,\n  pointerPos: Vec2,\n  neighborCounts: Uint16Array,\n  timeScale: number,\n  grid: SpatialGrid\n) {\n  const dt = Math.max(0, Math.min(4.0, timeScale));\n\n  // Pass 1: integrate + pointer heat + reset neighbors + bounds\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    applyBuoyancyAndGravity(p, dt);\n    applyFriction(p, dt);\n    integrate(p, dt);\n\n    if (pointerDown) applyPointerHeat(p, pointerPos, dt);\n\n    neighborCounts[i] = 0;\n    bounceInBounds(p, width, height);\n  }\n\n  // dt=0 => frozen (no cohesion/conduction/cooling), but still clamp\n  if (dt === 0) {\n    for (let i = 0; i < particles.length; i++) {\n      particles[i].heat = clamp01(particles[i].heat);\n    }\n    clampAllToBounds(particles, width, height);\n    return;\n  }\n\n  // Build spatial hash\n  grid.heads.fill(-1);\n  const invCell = 1 / grid.cellSize;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n\n    let cx = (p.x * invCell) | 0;\n    let cy = (p.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const cell = gridIndex(grid, cx, cy);\n    grid.next[i] = grid.heads[cell];\n    grid.heads[cell] = i;\n  }\n\n  // Pass 2: local neighbor forces + conduction\n  const r = SIM.COHESION_RADIUS;\n  const r2 = r * r;\n\n  for (let i = 0; i < particles.length; i++) {\n    const p1 = particles[i];\n\n    let cx = (p1.x * invCell) | 0;\n    let cy = (p1.y * invCell) | 0;\n\n    if (cx < 0) cx = 0;\n    else if (cx >= grid.cols) cx = grid.cols - 1;\n\n    if (cy < 0) cy = 0;\n    else if (cy >= grid.rows) cy = grid.rows - 1;\n\n    const x0 = cx > 0 ? cx - 1 : cx;\n    const x1 = cx + 1 < grid.cols ? cx + 1 : cx;\n    const y0 = cy > 0 ? cy - 1 : cy;\n    const y1 = cy + 1 < grid.rows ? cy + 1 : cy;\n\n    for (let ny = y0; ny <= y1; ny++) {\n      for (let nx = x0; nx <= x1; nx++) {\n        let j = grid.heads[gridIndex(grid, nx, ny)];\n        while (j !== -1) {\n          if (j > i) {\n            const p2 = particles[j];\n            const dx = p2.x - p1.x;\n            const dy = p2.y - p1.y;\n            const d2 = dx * dx + dy * dy;\n\n            if (d2 > 0 && d2 < r2) {\n              neighborCounts[i]++;\n              neighborCounts[j]++;\n\n              const d = Math.sqrt(d2);\n              applyCohesionImpulse(p1, p2, dx, dy, d, dt);\n              applyHeatConduction(p1, p2, dt);\n            }\n          }\n          j = grid.next[j];\n        }\n      }\n    }\n  }\n\n  // Pass 3: heat source / cooling\n  for (let i = 0; i < particles.length; i++) {\n    const p = particles[i];\n    applyBottomHeatOrAirCooling(p, height, neighborCounts[i], dt);\n    p.heat = clamp01(p.heat);\n  }\n\n  clampAllToBounds(particles, width, height);\n}\n\nfunction applyBuoyancyAndGravity(p: Particle, dt: number) {\n  const buoyancy = p.heat * p.heat * SIM.BUOYANCY;\n  p.vy += (SIM.GRAVITY - buoyancy) * dt;\n}\n\nfunction applyFriction(p: Particle, dt: number) {\n  const f = Math.pow(SIM.FRICTION, dt);\n  p.vx *= f;\n  p.vy *= f;\n}\n\nfunction integrate(p: Particle, dt: number) {\n  p.x += p.vx * dt;\n  p.y += p.vy * dt;\n}\n\nfunction applyPointerHeat(p: Particle, pointerPos: Vec2, dt: number) {\n  const dx = p.x - pointerPos.x;\n  const dy = p.y - pointerPos.y;\n  const d2 = dx * dx + dy * dy;\n  const r = SIM.MOUSE_HEAT_RADIUS;\n  const r2 = r * r;\n\n  if (d2 < r2) {\n    const d = Math.sqrt(d2);\n    const intensity = 1 - d * (1 / r);\n    p.heat += SIM.HEAT_RATE * 2 * intensity * dt;\n  }\n}\n\nfunction applyCohesionImpulse(\n  p1: Particle,\n  p2: Particle,\n  dx: number,\n  dy: number,\n  d: number,\n  dt: number\n) {\n  const force = SIM.COHESION_STRENGTH * (1 - d * (1 / SIM.COHESION_RADIUS));\n  const invD = 1 / d;\n  const fx = dx * invD * force * dt;\n  const fy = dy * invD * force * dt;\n\n  p1.vx += fx;\n  p1.vy += fy;\n  p2.vx -= fx;\n  p2.vy -= fy;\n}\n\nfunction applyHeatConduction(p1: Particle, p2: Particle, dt: number) {\n  const heatDiff = p1.heat - p2.heat;\n  const conduction = heatDiff * SIM.HEAT_CONDUCTION * dt;\n  p1.heat -= conduction;\n  p2.heat += conduction;\n}\n\nfunction applyBottomHeatOrAirCooling(\n  p: Particle,\n  height: number,\n  neighborCount: number,\n  dt: number\n) {\n  const distanceFromBottom = height - p.y;\n\n  if (distanceFromBottom < SIM.HEAT_SOURCE_DISTANCE) {\n    const intensity = 1 - distanceFromBottom * (1 / SIM.HEAT_SOURCE_DISTANCE);\n    p.heat += SIM.HEAT_RATE * intensity * dt;\n    return;\n  }\n\n  const maxNeighbors = 8;\n  const neighbors = neighborCount < maxNeighbors ? neighborCount : maxNeighbors;\n  const airExposure = 1 - neighbors / maxNeighbors;\n\n  p.heat -= SIM.COOL_RATE * (0.2 + airExposure * 0.8) * dt;\n}\n\n// --- Render helpers ---\nfunction ensureImageData(\n  ctx: CanvasRenderingContext2D,\n  imageRef: React.MutableRefObject<ImageData | null>,\n  width: number,\n  height: number\n): ImageData {\n  const img = imageRef.current;\n  if (!img || img.width !== width || img.height !== height) {\n    imageRef.current = ctx.createImageData(width, height);\n  }\n  return imageRef.current!;\n}\n\nfunction drawMetaballs(\n  imageData: ImageData,\n  particles: Particle[],\n  canvasWidth: number,\n  canvasHeight: number,\n  heatLut256: Uint32Array\n) {\n  const pixelSize = RENDER.PIXEL_SIZE;\n  const threshold = RENDER.THRESHOLD;\n  const r2 = RENDER.PARTICLE_RADIUS * RENDER.PARTICLE_RADIUS;\n\n  const data32 = new Uint32Array(imageData.data.buffer);\n\n  // 7) Don’t clear twice: clear ONCE here to opaque black\n  const black = packRgba(0, 0, 0, 255);\n  data32.fill(black);\n\n  const w = canvasWidth;\n\n  for (let y = 0; y < canvasHeight; y += pixelSize) {\n    for (let x = 0; x < canvasWidth; x += pixelSize) {\n      let influenceSum = 0;\n      let heatWeightedSum = 0;\n\n      for (let i = 0; i < particles.length; i++) {\n        const p = particles[i];\n        const dx = x - p.x;\n        const dy = y - p.y;\n        const distSq = dx * dx + dy * dy;\n        const influence = r2 / (distSq + 1);\n\n        influenceSum += influence;\n        heatWeightedSum += influence * p.heat;\n      }\n\n      if (influenceSum <= threshold) continue;\n\n      const heat = heatWeightedSum / influenceSum;\n      const lutIdx = heat <= 0 ? 0 : heat >= 1 ? 255 : (heat * 255) | 0;\n      const rgba = heatLut256[lutIdx];\n\n      for (let py = 0; py < pixelSize; py++) {\n        const yy = y + py;\n        if (yy >= canvasHeight) break;\n\n        let idx = yy * w + x;\n        const rowEnd = Math.min(x + pixelSize, w);\n        for (let xx = x; xx < rowEnd; xx++) {\n          data32[idx++] = rgba;\n        }\n      }\n    }\n  }\n}\n\nfunction renderFrame(\n  ctx: CanvasRenderingContext2D,\n  canvas: HTMLCanvasElement,\n  particles: Particle[],\n  imageRef: React.MutableRefObject<ImageData | null>,\n  heatLut256: Uint32Array\n) {\n  const imageData = ensureImageData(ctx, imageRef, canvas.width, canvas.height);\n  drawMetaballs(imageData, particles, canvas.width, canvas.height, heatLut256);\n  ctx.putImageData(imageData, 0, 0);\n}\n\n// --- Component ---\nexport default function LavaLamp(): ReactElement {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const ctxRef = useRef<CanvasRenderingContext2D | null>(null);\n\n  const rafRef = useRef<number | null>(null);\n\n  const particlesRef = useRef<Particle[]>([]);\n  const imageRef = useRef<ImageData | null>(null);\n  const neighborCountsRef = useRef<Uint16Array>(new Uint16Array(0));\n  const particleCountRef = useRef<number | null>(null);\n\n  const gridRef = useRef<SpatialGrid | null>(null);\n\n  // 5) Cache dimensions ONCE (read only on page load)\n  const sizeRef = useRef<{ w: number; h: number }>({ w: 1, h: 1 });\n\n  const gameMusic = useMemo(() => new PersonalAudio(musicAudioNoise, true), []);\n  const clickSound = useMemo(() => new PersonalAudio(clickAudioNoise, false), []);\n\n  const [hasStarted, setHasStarted] = useState(false);\n\n  const pointerDownRef = useRef(false);\n  const pointerPosRef = useRef<Vec2>({ x: 0, y: 0 });\n\n  // Speed slider state\n  const defaultSpeedIdx = useMemo(() => speedToNearestIndex(SPEED.DEFAULT), []);\n  const [speedIdx, setSpeedIdx] = useState<number>(defaultSpeedIdx);\n  const speedRef = useRef<number>(SPEED.DEFAULT);\n\n  useEffect(() => {\n    speedRef.current = indexToSpeed(speedIdx);\n  }, [speedIdx]);\n\n  const [menuOpen, setMenuOpen] = useState(false);\n  const toggleMenu = useCallback(() => setMenuOpen((v) => !v), []);\n\n  const [volume, setVolume] = useState(1.0);\n  useEffect(() => {\n    gameMusic.volume = volume;\n  }, [volume, gameMusic]);\n\n  const [audioSource, setAudioSource] = useState<AudioSource>(AUDIO_SOURCES.KEXP);\n  const [nowPlaying, setNowPlaying] = useState<{\n    song: string;\n    artist: string;\n  } | null>(null);\n\n  useEffect(() => {\n    const config = AUDIO_SOURCE_CONFIG[audioSource];\n    const wasPlaying = gameMusic.isPlaying();\n\n    gameMusic.src = config.url;\n    gameMusic.load();\n\n    if (wasPlaying) {\n      const onCanPlay = () => {\n        gameMusic.play().catch(() => {\n          // ignore autoplay errors\n        });\n        gameMusic.removeEventListener('canplaythrough', onCanPlay);\n      };\n      gameMusic.addEventListener('canplaythrough', onCanPlay);\n    }\n  }, [audioSource, gameMusic]);\n\n  // Fetch KEXP now playing info\n  useEffect(() => {\n    if (!hasStarted || audioSource !== AUDIO_SOURCES.KEXP) {\n      setNowPlaying(null);\n      return;\n    }\n\n    const fetchNowPlaying = async () => {\n      try {\n        const response = await fetch(\"https://api.kexp.org/v2/plays/?limit=5\");\n        const data = await response.json();\n\n        // Find the most recent trackplay (skip airbreaks)\n        const track = data.results?.find((play: any) => play.play_type === \"trackplay\");\n\n        if (track) {\n          setNowPlaying({\n            song: track.song || \"Unknown Track\",\n            artist: track.artist || \"Unknown Artist\",\n          });\n        }\n      } catch {\n        // ignore errors\n      }\n    };\n\n    fetchNowPlaying();\n    const interval = setInterval(fetchNowPlaying, 15000); // Poll every 15 seconds\n\n    return () => clearInterval(interval);\n  }, [hasStarted, audioSource]);\n\n  const lavaLowColorRef = useRef(DEFAULT_LOW);\n  const lavaHighColorRef = useRef(DEFAULT_HIGH);\n\n  const [lavaLowColor, setLavaLowColor] = useState(DEFAULT_LOW);\n  const [lavaHighColor, setLavaHighColor] = useState(DEFAULT_HIGH);\n\n  const heatLutRef = useRef<Uint32Array>(buildHeatLut256(DEFAULT_LOW, DEFAULT_HIGH));\n\n  // Rebuild LUT whenever colors change; redraw immediately if running.\n  useEffect(() => {\n    lavaLowColorRef.current = lavaLowColor;\n    lavaHighColorRef.current = lavaHighColor;\n    heatLutRef.current = buildHeatLut256(lavaLowColor, lavaHighColor);\n  }, [lavaLowColor, lavaHighColor, hasStarted]);\n\n  // 5) Cache canvas/context + dimensions (only read on initial mount)\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n    sizeRef.current = { w, h };\n\n    canvas.width = w;\n    canvas.height = h;\n\n    ctxRef.current = canvas.getContext(\"2d\");\n\n    // ensure image data matches cached size\n    imageRef.current = null;\n\n    // no resize listener by request\n  }, []);\n\n  const initializeParticlesOnce = useCallback(() => {\n    const { w, h } = sizeRef.current;\n\n    if (particleCountRef.current === null) {\n      particleCountRef.current = computeParticleCount(w, h);\n    }\n\n    const count = particleCountRef.current;\n    particlesRef.current = createParticles(w, h, count);\n    neighborCountsRef.current = new Uint16Array(count);\n\n    ensureGrid(gridRef, w, h, count, SIM.COHESION_RADIUS);\n  }, []);\n\n  const saveMusicPosition = useCallback(() => {\n    writeSavedMusicTimeSeconds(gameMusic.currentTime ?? 0);\n  }, [gameMusic]);\n\n  useEffect(() => {\n    if (!hasStarted) return;\n\n    const tick = () => saveMusicPosition();\n    const id = window.setInterval(tick, 1000);\n\n    const onPageHide = () => saveMusicPosition();\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"hidden\") saveMusicPosition();\n    };\n\n    window.addEventListener(\"pagehide\", onPageHide);\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n\n    return () => {\n      window.clearInterval(id);\n      window.removeEventListener(\"pagehide\", onPageHide);\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n    };\n  }, [hasStarted, saveMusicPosition]);\n\n  useEffect(() => {\n    return () => {\n      saveMusicPosition();\n\n      gameMusic.pause();\n      gameMusic.volume = 0;\n      gameMusic.reset();\n\n      clickSound.pause();\n      clickSound.volume = 0;\n      clickSound.reset();\n    };\n  }, [gameMusic, clickSound, saveMusicPosition]);\n\n  const updateOnce = useCallback(() => {\n    const g = gridRef.current;\n    if (!g) return;\n\n    const { w, h } = sizeRef.current;\n\n    stepSimulationOnePairPass(\n      particlesRef.current,\n      w,\n      h,\n      pointerDownRef.current,\n      pointerPosRef.current,\n      neighborCountsRef.current,\n      speedRef.current,\n      g\n    );\n  }, []);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    const ctx = ctxRef.current;\n    if (!canvas || !ctx) return;\n\n    renderFrame(ctx, canvas, particlesRef.current, imageRef, heatLutRef.current);\n  }, []);\n\n  // 0) Fixed update cadence: updates happen at FIXED_FPS regardless of render speed.\n  const clockRef = useRef<{ last: number; acc: number }>({ last: 0, acc: 0 });\n\n  const animate = useCallback((now: number) => {\n    const clock = clockRef.current;\n\n    if (clock.last === 0) clock.last = now;\n    const delta = now - clock.last;\n    clock.last = now;\n\n    // Clamp massive deltas (tab-switch etc.)\n    clock.acc += Math.min(250, Math.max(0, delta));\n\n    let steps = 0;\n    while (clock.acc >= FIXED_MS && steps < MAX_CATCHUP_STEPS) {\n      updateOnce();\n      clock.acc -= FIXED_MS;\n      steps++;\n    }\n\n    // Drop extra backlog to avoid death spiral\n    if (clock.acc >= FIXED_MS) clock.acc = 0;\n\n    draw();\n    rafRef.current = requestAnimationFrame(animate);\n  }, [draw, updateOnce]);\n\n  // Pointer handling\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const toLocal = (e: PointerEvent): Vec2 => {\n      const rect = canvas.getBoundingClientRect();\n      return { x: e.clientX - rect.left, y: e.clientY - rect.top };\n    };\n\n    const onDown = (e: PointerEvent) => {\n      pointerDownRef.current = true;\n      pointerPosRef.current = toLocal(e);\n    };\n    const onMove = (e: PointerEvent) => {\n      pointerPosRef.current = toLocal(e);\n    };\n    const onUp = () => {\n      pointerDownRef.current = false;\n    };\n\n    canvas.addEventListener(\"pointerdown\", onDown);\n    window.addEventListener(\"pointermove\", onMove);\n    window.addEventListener(\"pointerup\", onUp);\n    window.addEventListener(\"pointercancel\", onUp);\n\n    return () => {\n      canvas.removeEventListener(\"pointerdown\", onDown);\n      window.removeEventListener(\"pointermove\", onMove);\n      window.removeEventListener(\"pointerup\", onUp);\n      window.removeEventListener(\"pointercancel\", onUp);\n    };\n  }, []);\n\n  const playClick = useCallback(() => {\n    try {\n      clickSound.volume = 1.0;\n      clickSound.currentTime = 0;\n      clickSound.reset();\n      clickSound.play();\n    } catch {\n      // ignore\n    }\n  }, [clickSound]);\n\n  const resumeMusicFromSavedTime = useCallback(() => {\n    const t = readSavedMusicTimeSeconds();\n    try {\n      const duration = (gameMusic as any).duration as number | undefined;\n      if (typeof duration === \"number\" && Number.isFinite(duration) && duration > 0) {\n        gameMusic.currentTime = t % duration;\n      } else {\n        gameMusic.currentTime = t;\n      }\n    } catch {\n      // ignore\n    }\n  }, [gameMusic]);\n\n  const startLamp = useCallback(async () => {\n    playClick();\n\n    if (!hasStarted) {\n      setHasStarted(true);\n      initializeParticlesOnce();\n\n      // reset fixed-timestep clock\n      clockRef.current = { last: 0, acc: 0 };\n\n      // draw a first frame immediately\n      requestAnimationFrame(() => draw());\n\n      // start RAF loop\n      rafRef.current = requestAnimationFrame(animate);\n    }\n\n    resumeMusicFromSavedTime();\n    gameMusic.volume = 1.0;\n\n    try {\n      await gameMusic.play();\n    } catch (err) {\n      // If play fails, wait for canplaythrough then try again\n      const onCanPlay = async () => {\n        try {\n          await gameMusic.play();\n        } catch {\n          // ignore if still fails\n        }\n        gameMusic.removeEventListener('canplaythrough', onCanPlay);\n      };\n      gameMusic.addEventListener('canplaythrough', onCanPlay);\n    }\n  }, [\n    animate,\n    draw,\n    gameMusic,\n    hasStarted,\n    initializeParticlesOnce,\n    playClick,\n    resumeMusicFromSavedTime,\n  ]);\n\n  const initialCanvasSize = useMemo(\n    () => ({ w: window.innerWidth, h: window.innerHeight }),\n    []\n  );\n\n  const lastSpeedIdx = SPEED.STEPS - 1;\n\n  return (\n    <div className=\"lava-lamp-container\">\n      <canvas\n        ref={canvasRef}\n        className=\"lava-lamp-canvas\"\n        width={initialCanvasSize.w}\n        height={initialCanvasSize.h}\n      />\n\n      {nowPlaying && (\n        <div className=\"lava-lamp-now-playing\">\n          <div className=\"lava-lamp-now-playing-header\">\n            <div className=\"lava-lamp-now-playing-label\">KEXP</div>\n            <div className=\"lava-lamp-soundwave\">\n              <div className=\"lava-lamp-soundwave-bar\"></div>\n              <div className=\"lava-lamp-soundwave-bar\"></div>\n              <div className=\"lava-lamp-soundwave-bar\"></div>\n              <div className=\"lava-lamp-soundwave-bar\"></div>\n            </div>\n          </div>\n          <div className=\"lava-lamp-now-playing-song\">{nowPlaying.song}</div>\n          <div className=\"lava-lamp-now-playing-artist\">{nowPlaying.artist}</div>\n        </div>\n      )}\n\n      {!hasStarted ? (\n        <div className=\"lava-lamp-start-overlay\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-start\"\n            onClick={startLamp}\n            aria-label=\"Start lava lamp\"\n          >\n            START\n          </button>\n        </div>\n      ) : (\n        <div className=\"lava-lamp-controls\">\n          <button\n            type=\"button\"\n            className=\"lava-lamp-menu-toggle\"\n            onClick={toggleMenu}\n            aria-label={menuOpen ? \"Hide menu\" : \"Show menu\"}\n            aria-pressed={menuOpen}\n          >\n            {menuOpen ? \"✕\" : \"☰\"}\n          </button>\n\n          {menuOpen && (\n            <div className=\"lava-lamp-menu\">\n              {/* Speed */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">speed: {speedIdx}</div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={lastSpeedIdx}\n                    step={1}\n                    value={speedIdx}\n                    onChange={(e) =>\n                      setSpeedIdx(clampInt(Number(e.target.value), 0, lastSpeedIdx))\n                    }\n                    aria-label=\"Simulation speed\"\n                  />\n                </div>\n              </div>\n\n              {/* Volume */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">\n                    volume: {Math.round(volume * 100)}%\n                  </div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <input\n                    className=\"lava-lamp-slider\"\n                    type=\"range\"\n                    min={0}\n                    max={1}\n                    step={0.01}\n                    value={volume}\n                    onChange={(e) => setVolume(Number(e.target.value))}\n                    aria-label=\"Music volume\"\n                  />\n                </div>\n              </div>\n\n              {/* Audio Source */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">audio source</div>\n                </div>\n\n                <div className=\"lava-lamp-slider-wrap\">\n                  <select\n                    className=\"lava-lamp-slider\"\n                    value={audioSource}\n                    onChange={(e) => setAudioSource(e.target.value as AudioSource)}\n                    aria-label=\"Audio source\"\n                  >\n                    {Object.entries(AUDIO_SOURCE_CONFIG).map(([key, config]) => (\n                      <option key={key} value={key}>\n                        {config.label}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n\n              {/* Lava colors */}\n              <div className=\"lava-lamp-control-block\">\n                <div className=\"lava-lamp-control-header\">\n                  <div className=\"lava-lamp-control-title\">lava colors</div>\n                </div>\n\n                <div className=\"lava-lamp-color-row\">\n\n                  <label className=\"lava-lamp-color-label\">\n                    hot\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaHighColor}\n                      onChange={(e) => setLavaHighColor(e.target.value)}\n                      aria-label=\"Lava high color\"\n                    />\n                  </label>\n\n                  <label className=\"lava-lamp-color-label\">\n                    cool\n                    <input\n                      className=\"lava-lamp-color-input\"\n                      type=\"color\"\n                      value={lavaLowColor}\n                      onChange={(e) => setLavaLowColor(e.target.value)}\n                      aria-label=\"Lava low color\"\n                    />\n                  </label>\n\n                  <button\n                    type=\"button\"\n                    className=\"lava-lamp-color-reset\"\n                    onClick={() => {\n                      setLavaLowColor(DEFAULT_LOW);\n                      setLavaHighColor(DEFAULT_HIGH);\n                    }}\n                  >\n                    reset\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","export class PersonalAudio extends Audio {\n  constructor(src, loop=false) {\n    super(src);\n    this.loop = loop;\n  };\n\n  isPlayingSrc = (audioSrc) => {\n    return this.src?.includes(audioSrc)\n        && this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  isPlaying = () => {\n    return this.currentTime > 0\n        && !this.paused\n        && !this.ended\n        && this.readyState > 2;\n  };\n\n  timeLeft = () => this.duration - this.currentTime;\n\n  reset = () => {\n    this.pause();\n    this.currentTime = 0;\n  };\n}"],"names":["AUDIO_SOURCES","REDWOOD","KEXP","AUDIO_SOURCE_CONFIG","label","url","musicAudioNoise","DEFAULT_HIGH","DEFAULT_LOW","SIM","GRAVITY","BUOYANCY","FRICTION","HEAT_RATE","COOL_RATE","HEAT_CONDUCTION","HEAT_SOURCE_DISTANCE","COHESION_RADIUS","COHESION_STRENGTH","MOUSE_HEAT_RADIUS","RENDER","PARTICLE_RADIUS","PIXEL_SIZE","THRESHOLD","CLUMPS","COUNT","RADIUS","TOP_HALF_PROB","BASELINE","WIDTH","HEIGHT","PARTICLES","SPEED","MIN","MAX","DEFAULT","STEPS","FIXED_MS","MAX_CATCHUP_STEPS","MUSIC_TIME_KEY","clamp01","v","lerpInt","a","b","t","Math","round","randInCircle","radius","angle","random","PI","r","x","cos","y","sin","bounceInBounds","p","width","height","vx","vy","clampAllToBounds","particles","i","length","indexToSpeed","idx","steps","minPositive","targetMidSpeed","minLog","log","maxLog","exp","lerp","hexToRgb","hex","h","trim","replace","parseInt","g","slice","packRgba","buildHeatLut256","lowHex","highHex","lo","hi","lut","Uint32Array","gridIndex","cx","cy","cols","stepSimulationOnePairPass","pointerDown","pointerPos","neighborCounts","timeScale","grid","dt","max","min","applyBuoyancyAndGravity","applyFriction","integrate","applyPointerHeat","heat","heads","fill","invCell","cellSize","rows","cell","next","r2","p1","x0","x1","y0","y1","ny","nx","j","p2","dx","dy","d2","applyCohesionImpulse","sqrt","applyHeatConduction","applyBottomHeatOrAirCooling","buoyancy","f","pow","intensity","d","force","invD","fx","fy","conduction","neighborCount","distanceFromBottom","airExposure","renderFrame","ctx","canvas","imageRef","heatLut256","imageData","img","current","createImageData","ensureImageData","canvasWidth","canvasHeight","pixelSize","threshold","data32","data","buffer","black","w","influenceSum","heatWeightedSum","influence","rgba","py","yy","rowEnd","xx","drawMetaballs","putImageData","LavaLamp","canvasRef","useRef","ctxRef","rafRef","particlesRef","neighborCountsRef","Uint16Array","particleCountRef","gridRef","sizeRef","gameMusic","useMemo","PersonalAudio","clickSound","clickAudioNoise","hasStarted","setHasStarted","useState","pointerDownRef","pointerPosRef","defaultSpeedIdx","speed","last","best","bestErr","Infinity","target","s","err","abs","speedToNearestIndex","speedIdx","setSpeedIdx","speedRef","useEffect","menuOpen","setMenuOpen","toggleMenu","useCallback","volume","setVolume","audioSource","setAudioSource","nowPlaying","setNowPlaying","config","wasPlaying","isPlaying","src","load","onCanPlay","play","catch","removeEventListener","addEventListener","fetchNowPlaying","async","_data$results","response","fetch","track","json","results","find","play_type","song","artist","_unused3","interval","setInterval","clearInterval","lavaLowColorRef","lavaHighColorRef","lavaLowColor","setLavaLowColor","lavaHighColor","setLavaHighColor","heatLutRef","window","innerWidth","innerHeight","getContext","initializeParticlesOnce","baselineArea","currentArea","density","scaled","computeParticleCount","count","particlesPerClump","floor","centerX","centerY","clumpHeat","offset","push","createParticles","ceil","cells","Int32Array","ensureGrid","saveMusicPosition","_gameMusic$currentTim","seconds","Number","isFinite","localStorage","setItem","String","_unused2","writeSavedMusicTimeSeconds","currentTime","id","tick","onPageHide","onVisibilityChange","document","visibilityState","pause","reset","updateOnce","draw","clockRef","acc","animate","now","clock","delta","requestAnimationFrame","toLocal","e","rect","getBoundingClientRect","clientX","left","clientY","top","onDown","onMove","onUp","playClick","_unused4","resumeMusicFromSavedTime","raw","getItem","_unused","readSavedMusicTimeSeconds","duration","_unused5","startLamp","_unused6","initialCanvasSize","lastSpeedIdx","_jsxs","className","children","_jsx","ref","type","onClick","step","value","onChange","Object","entries","map","_ref","key","Audio","constructor","loop","arguments","undefined","super","isPlayingSrc","audioSrc","_this$src","this","includes","paused","ended","readyState","timeLeft"],"sourceRoot":""}